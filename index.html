<html lang="en"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible"content="IE=edge"><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css"><link rel="stylesheet"href="./dist/main.css"><title>TPM2 Command WIKI</title><div class="container"><div class="row"id="slogan"><div class="twelve columns"><h2><span>TPM commands search engine</span> <span>&nbsp; - &nbsp;</span> <small>Make your life easier.</small></h2></div></div><div class="row"><div class="twelve columns"><form id="form"><input type="text"class="u-full-width"id="input"placeholder="enter cmd: tpm2 ..."></form></div></div><div class="row"><div class="twelve columns"><ul id="candidates"class="candidates hidden"></ul></div></div><div class="row"><div class="twelve columns"><div id="doccontainer"class="doc-container hidden"></div></div></div></div><template id="activatecredential"><h1 id="name">NAME</h1><p><strong>tpm2_activatecredential</strong>(1) - Enables access to the credential qualifier to recover the credential secret.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_activatecredential</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_activatecredential</strong>(1) - Enables the association of a credential with an object in a way that ensures that the TPM has validated the parameters of the credentialed object. In an attestation scheme , this guarantees the registrar that the attestation key belongs to the TPM with a qualified parent key in the TPM.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--credentialedkey-context</strong>=<em>OBJECT</em>:<p>Object associated with the created certificate by CA.<li><p><strong>-C</strong>, <strong>--credentialkey-context</strong>=<em>OBJECT</em>:<p>The loaded object used to decrypt the random seed.<li><p><strong>-p</strong>, <strong>--credentialedkey-auth</strong>=<em>AUTH</em>:<p>The auth value of the credentialed object specified with <strong>-c</strong>.<li><p><strong>-P</strong>, <strong>--credentialkey-auth</strong>=<em>AUTH</em>:<p>The auth value of the credential object specified with <strong>-C</strong>.<li><p><strong>-i</strong>, <strong>--credential-blob</strong>=<em>FILE</em>:<p>The input file path containing the credential blob and secret created with the <strong>tpm2_makecredential</strong>(1) tool.<li><p><strong>-o</strong>, <strong>--certinfo-data</strong>=<em>FILE</em>:<p>The output file path to save the decrypted credential secret information.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">echo &quot;12345678&quot; &gt; secret.data

tpm2_createek -Q -c 0x81010001 -G rsa -u ek.pub

tpm2_createak -C 0x81010001 -c ak.ctx -G rsa -g sha256 -s rsassa -u ak.pub \
-n ak.name -p akpass&gt; ak.out

file_size=`stat --printf=&quot;%s&quot; ak.name`
loaded_key_name=`cat ak.name | xxd -p -c $file_size`

tpm2_makecredential -Q -e ek.pub  -s secret.data -n $loaded_key_name \
-o mkcred.out

tpm2_startauthsession --policy-session -S session.ctx

tpm2_policysecret -S session.ctx -c e

tpm2_activatecredential -Q -c ak.ctx -C 0x81010001 -i mkcred.out \
-o actcred.out -p akpass -P&quot;session:session.ctx&quot;

tpm2_flushcontext session.ctx
</code></pre></template><template id="certify"><h1 id="name">NAME</h1><p><strong>tpm2_certify</strong>(1) - Prove that an object is loaded in the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_certify</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_certify</strong>(1) - Proves that an object with a specific <em>NAME</em> is loaded in the TPM. By certifying that the object is loaded, the TPM warrants that a public area with a given <em>NAME</em> is self-consistent and associated with a valid sensitive area.<p>If a relying party has a public area that has the same <em>NAME</em> as a <em>NAME</em> certified with this command, then the values in that public area are correct. An object that only has its public area loaded cannot be certified.<h1 id="options">OPTIONS</h1><p>These options control the certification:<ul><li><p><strong>-c</strong>, <strong>--certifiedkey-context</strong>=<em>OBJECT</em>:<p>The object to be certified.<li><p><strong>-C</strong>, <strong>--signingkey-context</strong>=<em>OBJECT</em>:<p>The key used to sign the attestation structure.<li><p><strong>-p</strong>, <strong>--certifiedkey-auth</strong>=<em>AUTH</em>:<p>The authorization value provided for the object specified with -c.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm to use in signature generation.<li><p><strong>-P</strong>, <strong>--signingkey-auth</strong>=<em>AUTH</em>:<p>The authorization value for the signing key specified with -C.<li><p><strong>-o</strong>, <strong>--attestation</strong>=<em>FILE</em>:<p>Output file name for the attestation data.<li><p><strong>-s</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>Output file name for the signature data.<li><p><strong>-f</strong>, <strong>--format</strong>=<em>FORMAT</em>:<p>Format selection for the signature output file.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/signature.html">signature format specifiers</a> option used to configure signature <em>FORMAT</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Create a primary key and certify it with a signing key.<pre><code class="language-bash">tpm2_createprimary -Q -C e -g sha256 -G rsa -c primary.ctx

tpm2_create -Q -g sha256 -G rsa -u certify.pub -r certify.priv -C primary.ctx

tpm2_load -Q -C primary.ctx -u certify.pub -r certify.priv -n certify.name \
-c certify.ctx

tpm2_certify -Q -c primary.ctx -C certify.ctx -g sha256 -o attest.out -s sig.out
</code></pre></template><template id="certifyX509certutil"><h1 id="name">NAME</h1><p><strong>tpm2_certifyX509certutil</strong>(1) - Generate partial X509 certificate.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_certifyX509certutil</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_certifyX509certutil</strong>(1) - Generates a partial certificate that is suitable as the third input parameter for TPM2_certifyX509 command. The certificate data is written into a file in DER format and can be examined using openssl asn1parse tool as follows:<pre><code class="language-bash">openssl asn1parse -in partial_cert.der -inform DER
</code></pre><h1 id="options">OPTIONS</h1><p>These are the available options:<ul><li><p><strong>-o</strong>, <strong>--outcert</strong>=<em>STRING</em>: The output file where the certificate will be written to. The default is partial_cert.der Optional parameter.<li><p><strong>-d</strong>, <strong>--days</strong>=<em>NUMBER</em>: The number of days the certificate will be valid starting from today. The default is 3560 (10 years) Optional parameter.<li><p><strong>-i</strong>, <strong>--issuer</strong>=<em>STRING</em>: The ISSUER entry for the cert in the following format: --issuer=&quot;C=US;O=org;OU=Org unit;CN=cname&quot; Supported fields are:<ul><li>C - &quot;Country&quot;, max size = 2<li>O - &quot;Org&quot;, max size = 8<li>OU - &quot;Org Unit&quot;, max size = 8<li>CN - &quot;Common Name&quot;, max size = 8 The files need to be separated with semicolon. At list one supported field is required for the option to be valid. Optional parameter.</ul><li><p><strong>-s</strong>, <strong>--subject</strong>=<em>STRING</em>: The SUBJECT for the cert in the following format: --subject=&quot;C=US;O=org;OU=Org unit;CN=cname&quot; Supported fields are:<ul><li>C - &quot;Country&quot;, max size = 2<li>O - &quot;Org&quot;, max size = 8<li>OU - &quot;Org Unit&quot;, max size = 8<li>CN - &quot;Common Name&quot;, max size = 8 The files need to be separated with semicolon. At list one supported field is required for the option to be valid. Optional parameter.</ul><li><p><strong>ARGUMENT</strong> No arguments required.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2 certifyX509certutil -o partial_cert.der -d 356
</code></pre></template><template id="certifycreation"><h1 id="name">NAME</h1><p><strong>tpm2_certifycreation</strong>(1) - Attest the association between a loaded public area and the provided hash of the creation data.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_certifycreation</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_certifycreation</strong>(1) - Attest the association between a loaded public area and the provided hash of the creation data. The creation data and the creation ticket is produced when creating the object. The object itself is created with either <strong>TPM2_CreatePrimary</strong> or <strong>TPM2_Create</strong> commands.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--signingkey-context</strong>=<em>OBJECT</em>:<p>Context object pointing to the key used that signs the attestation.<li><p><strong>-P</strong>, <strong>--signingkey-auth</strong><em>AUTH</em>:<p>Optional authorization value to use for the key specified by <strong>-C</strong>.<li><p><strong>-c</strong>, <strong>--certifiedkey-context</strong>=<em>OBJECT</em>:<p>Context object pointing to the key that has to be certified.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm used to digest the creation data.<li><p><strong>-s</strong>, <strong>--scheme</strong>=<em>ALGORITHM</em>:<p>The signing scheme used to sign the attestation data.<li><p><strong>-d</strong>, <strong>--creation-hash</strong>=<em>FILE</em><p>File containing the digest of the creation data.<li><p><strong>-t</strong>, <strong>--ticket</strong>=<em>FILE</em>:<p>The ticket file to validate that the creation data was produced by the TPM.<li><p><strong>-o</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>File containing the signature of the attestation data for the certified key.<li><p><strong>-f</strong>, <strong>--format</strong>=<em>FORMAT</em>:<p>Output signature format selection.<li><p><strong>--attestation</strong>=<em>FILE</em>:<p>The attestation data of the type TPM2_CREATION_INFO signed with signing key.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>FILE_OR_HEX</em>:<p>Optional, the policy qualifier data that the signer can choose to include in the signature. Can either be a path or hex string.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules. <a href="./common/signature.html">signature format specifiers</a><h1 id="examples">EXAMPLES</h1><h2 id="certify-creation-data-of-a-primary-key">Certify creation data of a primary key.</h2><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx --creation-data create.dat \
-d create.dig -t create.ticket

tpm2_create -G rsa -u rsa.pub -r rsa.priv -C prim.ctx -c signing_key.ctx

tpm2_certifycreation -C signing_key.ctx -c prim.ctx -d create.dig \
-t create.ticket -g sha256 -o sig.nature --attestation attestat.ion -f plain \
-s rsassa
</code></pre></template><template id="changeauth"><h1 id="name">NAME</h1><p><strong>tpm2_changeauth</strong> - Changes authorization values for TPM objects.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_changeauth</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_changeauth</strong> - Configures authorization values for the various hierarchies, NV indices, transient and persistent objects.<p>Note: For non-permanent objects (Transient objects and Persistent objects), copies of the private information (files or persistent handles) created prior to changing auth are not invalidated.<h1 id="options">OPTIONS</h1><p>Passwords should follow the &quot;password authorization formatting standards&quot;, see section &quot;Authorization Formatting&quot;.<ul><li><p><strong>-c</strong>, <strong>--object-context</strong>=<em>OBJECT</em>:<p>The key context object to be used for the operation.<li><p><strong>-p</strong>, <strong>--object-auth</strong>=<em>AUTH</em>:<p>The old authorization value for the TPM object specified with <strong>-c</strong>.<li><p><strong>-C</strong>, <strong>--parent-context</strong>=<em>OBJECT</em>:<p>The parent object. This is required if the object for the operation is a transient or persistent object.<li><p><strong>-r</strong>, <strong>--private</strong>=<em>FILE</em>: The output file which contains the new sensitive portion of the object whose auth was being changed. <a href="common/protection-details.md">protection details</a><li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the <em>AUTH</em> to be set for the object specified with <strong>-c</strong>.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="set-owner-endorsement-and-lockout-authorizations-to-newpass">Set owner, endorsement and lockout authorizations to newpass</h2><pre><code class="language-bash">tpm2_changeauth -c owner newpass
tpm2_changeauth -c endorsement newpass
tpm2_changeauth -c lockout newpass
</code></pre><h2 id="change-owner-endorsement-and-lockout-authorizations">Change owner, endorsement and lockout authorizations</h2><pre><code class="language-bash">tpm2_changeauth -c o -p newpass newerpass
tpm2_changeauth -c e -p newpass newerpass
tpm2_changeauth -c l -p newpass newerpass
</code></pre><h2 id="set-owner-authorization-to-empty-password">Set owner authorization to empty password</h2><pre><code class="language-bash">tpm2_changeauth -c o -p oldpass
</code></pre><h2 id="modify-authorization-for-a-loadable-transient-object">Modify authorization for a loadable transient object</h2><pre><code class="language-bash">tpm2_createprimary -Q -C o -c prim.ctx

tpm2_create -Q -g sha256 -G aes -u key.pub -r key.priv -C prim.ctx

tpm2_load -C prim.ctx -u key.pub -r key.priv -n key.name -c key.ctx

tpm2_changeauth -c key.ctx -C prim.ctx -r key.priv newkeyauth
</code></pre><h2 id="modify-authorization-for-a-nv-index">Modify authorization for a NV Index</h2><p>Requires Extended Session Support.<pre><code class="language-bash">tpm2_startauthsession -S session.ctx

tpm2_policycommandcode -S session.ctx -L policy.nvchange TPM2_CC_NV_ChangeAuth
tpm2_flushcontext session.ctx

NVIndex=0x1500015
tpm2_nvdefine   $NVIndex -C o -s 32 -a &quot;authread|authwrite&quot; -L policy.nvchange
tpm2_startauthsession \--policy-session -S session.ctx

tpm2_policycommandcode -S session.ctx -L policy.nvchange TPM2_CC_NV_ChangeAuth

tpm2_changeauth -p session:session.ctx -c $NVIndex newindexauth
</code></pre></template><template id="changeeps"><h1 id="name">NAME</h1><p><strong>tpm2_changeeps</strong>(1) - Replaces the active endorsement primary seed with a new one generated off the TPM2 RNG.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_changeeps</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_changeeps</strong>(1) - Replaces the active endorsement primary seed with a new one generated off the TPM2 RNG. The Transient and Persistent objects under the endorsement hierarchy are lost. This command requires platform auth.<h1 id="options">OPTIONS</h1><ul><li><strong>-p</strong>, <strong>--auth</strong> specifies the <em>AUTH</em> for the platform. hierarchy.</ul><h2 id="references">References</h2><p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="change-the-endorsement-primary-seed-where-the-platform-auth-is-null">Change the endorsement primary seed where the platform auth is NULL.</h2><pre><code class="language-bash">tpm2_changeeps
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="changepps"><h1 id="name">NAME</h1><p><strong>tpm2_changepps</strong>(1) - Replaces the active platform primary seed with a new one generated off the TPM2 RNG.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_changepps</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_changepps</strong>(1) - Replaces the active platform primary seed with a new one generated off the TPM2 RNG. The Transient and Persistent objects under the platform hierarchy are lost whilst retaining the NV objects.<h1 id="options">OPTIONS</h1><ul><li><strong>-p</strong>, <strong>--auth</strong> specifies the <em>AUTH</em> for the platform. hierarchy.</ul><h2 id="references">References</h2><p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="change-the-platform-primary-seed-where-the-platform-auth-is-null">Change the platform primary seed where the platform auth is NULL.</h2><pre><code class="language-bash">tpm2_changepps
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="checkquote"><h1 id="name">NAME</h1><p><strong>tpm2_checkquote</strong>(1) - Validates a quote provided by a TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_checkquote</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_checkquote</strong>(1) - Uses the public portion of the provided key to validate a quote generated by a TPM. This will validate the signature against the quote message and, if provided, verify that the qualifying data and PCR values match those in the quote. The PCR values can be provided with or without the TPML_PCR_SELECTION information. An example of PCR values without the PCR selection information is the output from <strong>tpm2_pcrread</strong>. If PCR value is specified without the PCR selection information, then the PCR selection string must be specified using the <strong>-l</strong> option to interpret the PCR data.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>File input for the public portion of the signature verification key. Either the <em>pem</em> file or <em>tss</em> public format file.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm used to digest the message.<li><p><strong>-m</strong>, <strong>--message</strong>=<em>FILE</em>:<p>The quote message that makes up the data that is signed by the TPM.<li><p><strong>-s</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>The input signature file of the signature to be validated.<li><p><strong>-f</strong>, <strong>--pcr</strong>=<em>FILE</em>:<p>Optional PCR input file to save the list of PCR values that were included in the quote.<li><p><strong>-l</strong>, <strong>--pcr-list</strong>=<em>PCR</em>:<p>The list of PCR banks and selected PCRs&#39; ids for each bank.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>HEX_STRING_OR_PATH</em>:<p>Qualification data for the quote. Can either be a hex string or path. This is typically used to add a nonce against replay attacks.<li><p><strong>-F</strong>, <strong>--format</strong>=<em>FORMAT</em>:<p><strong>DEPRECATED</strong> and **IGNORED ** as it&#39;s superfluous.</ul><h2 id="references">References</h2><p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/signature.html">signature format specifiers</a> option used to configure signature <em>FORMAT</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="generate-a-quote-with-a-tpm-then-verify-it">Generate a quote with a TPM, then verify it</h2><pre><code class="language-bash">tpm2_createek -c 0x81010001 -G rsa -u ekpub.pem -f pem

tpm2_createak -C 0x81010001 -c ak.ctx -G rsa -s rsassa -g sha256 \
-u akpub.pem -f pem -n ak.name

tpm2_quote -c ak.ctx -l sha256:15,16,22 -q abc123 -m quote.msg -s quote.sig \
  -o quote.pcrs -g sha256

tpm2_checkquote -u akpub.pem -m quote.msg -s quote.sig -f quote.pcrs -g sha256 \
  -q abc123
</code></pre></template><template id="clear"><h1 id="name">NAME</h1><p><strong>tpm2_clear</strong>(1) - Clears lockout, endorsement and owner hierarchy authorization values.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_clear</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_clear</strong>(1) - Send a clear command to the TPM to clear the 3 hierarchy authorization values. As an argument takes the auth value for either platform or lockout hierarchy<p><strong>NOTE</strong>: All objects created under the respective hierarchies are lost.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--auth-hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy the tools should operate on. By default it operates on the lockout hierarchy.<p><strong>NOTE : Operating on platform hierarchy require platform authentication.</strong><li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the <em>AUTH</em> to be set for the object specified with <strong>-c</strong>.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="set-owner-endorsement-and-lockout-authorizations-to-an-empty-value">Set owner, endorsement and lockout authorizations to an empty value</h2><pre><code class="language-bash">tpm2_clear lockoutpasswd
</code></pre><h2 id="clear-the-authorization-values-on-the-platform-hierarchy">Clear the authorization values on the platform hierarchy</h2><pre><code class="language-bash">tpm2_clear -c p
</code></pre></template><template id="clearcontrol"><h1 id="name">NAME</h1><p><strong>tpm2_clearcontrol</strong>(1) - Set/ Clear TPMA_PERMANENT.disableClear attribute to effectively block/ unblock lockout authorization handle for issuing TPM clear.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_clearcontrol</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_clearcontrol</strong>(1) - Allows user with knowledge of either lockout auth and or platform hierarchy auth to set disableClear which prevents the lockout authorization&#39;s capability to execute tpm2_clear. Only user with authorization knowledge of the platform hierarchy can clear the disableClear. By default it attempts to clear the disableClear bit.<p>Note: Platform hierarchy auth handle can always be used to clear the TPM with tpm2_clear command.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies what auth handle, either platform hierarchy or lockout the tool should operate on. By default it operates on the platform hierarchy handle. Specify the handle as p|l|platform|lockout.<p><strong>NOTE : Operating on platform hierarchy require platform authentication.</strong><li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>The authorization value of the hierarchy specified with <strong>-C</strong>. This tool only respects the <em>Password</em> and <em>HMAC</em> options.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> ** Specify an integer 0|1 or string c|s to clear or set the disableClear attribute.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="set-the-disableclear-to-block-the-lockout-authorizations-access-to-tpm-clear">Set the disableClear to block the lockout authorization&#39;s access to TPM clear</h2><pre><code class="language-bash">tpm2_clearcontrol -C l s
</code></pre><h2 id="clear-the-disableclear-to-unblock-lockout-authorization-for-tpm-clear">Clear the disableClear to unblock lockout authorization for TPM clear</h2><pre><code class="language-bash">tpm2_clearcontrol -C p c
</code></pre></template><template id="clockrateadjust"><h1 id="name">NAME</h1><p><strong>tpm2_clockrateadjust</strong>(1) - Sets the clock rate period on the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_clockrateadjust</strong> [<em>OPTIONS</em>] <strong>ADJUSTER</strong><h1 id="description">DESCRIPTION</h1><p><strong>tpm2_clockrateadjust</strong>(1) - Adjusts the rate at which clock and time are updated on the TPM so one can better match real time. With no argument, the command is invoked but the clock rate is not altered. With an argument, the tool will adjust the clock and time period. The command can either increase or decrease the clock period via 3 distinct granularities: course, medium and fine. To specify this, the argument can be a string of 1 to 3 characters of <em>all</em> &#39;s&#39; or &#39;f&#39;.<h2 id="valid-adjuster-arguments">Valid Adjuster Arguments</h2><ul><li>s - slows down the clock period one fine increment.<li>ss - slows down the clock period one medium increment.<li>sss - slows down the clock period one course increment.<li>f - speeds up the clock period one fine increment.<li>ff - speeds up the clock period one medium increment.<li>fff - speeds up the clock period one course increment.</ul><h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>The hierarchy to use for authorization, either platform or owner. Defaults to the owner hierarchy if not specified.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy specified by option <strong>-c</strong>.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="set-the-clock">Set the clock</h2><p>Slow the clock one medium increment using the owner password.<pre><code class="language-bash">tpm2_clockrateadjust -p ownerpw ss
</code></pre><p>Speed up the clock one course increment using the platform password.<pre><code class="language-bash">tpm2_clockrateadjust -c p -p platformpw fff
</code></pre></template><template id="commit"><h1 id="name">NAME</h1><p><strong>tpm2_commit</strong>(1) - Performs the first part of an ECC anonymous signing operation.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_commit</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_commit</strong>(1) - Performs the first part of an ECC anonymous signing operation. The TPM will perform the point multiplications on the provided points and return intermediate signing values. The signing key is an ECC key. The key cannot be a sign+decrypt key and must have an anonymous signing scheme. TPM_ALG_ECDAA is the only supported anonymous scheme.<h1 id="options">OPTIONS</h1><ul><li><p><strong>ARGUMENT</strong>=<em>FILE</em>:<p>Specify the input data used to derive the x coordinate of the basepoint.<li><p><strong>--basepoint-y</strong>=<em>FILE</em>:<p>Specify the y coordinate of the basepoint.<li><p><strong>--eccpoint-P</strong>=<em>FILE</em>:<p>Specify a point on the curve used by sign handle.<li><p><strong>--eccpoint-K</strong>=<em>FILE</em>:<p>Output ECC point K ≔ [ds](x2, y2).<li><p><strong>--eccpoint-L</strong>=<em>FILE</em>:<p>Output ECC point L ≔ [r](x2, y2).<li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>Output ECC point E ≔ [r]P1.<li><p><strong>-t</strong>, <strong>--counter</strong>=<em>FILE</em><p>Specify file path to save the least-significant 16 bits of commit count.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>The authorization value for the created object.<li><p><strong>-c</strong>, <strong>--context</strong>=<em>FILE</em>:<p>Context object pointing to the the key used for signing. Either a file or a handle number. See section &quot;Context Object Format&quot;.</ul><h2 id="references">References</h2><p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx -Q

tpm2_create -C prim.ctx -c key.ctx -u key.pub -r key.priv -G ecc256:ecdaa

tpm2_commit -c key.ctx -t count.er \
--eccpoint-K K.bin --eccpoint-L L.bin -u E.bin
</code></pre></template><template id="create"><h1 id="name">NAME</h1><p><strong>tpm2_create</strong>(1) - Create a child object.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_create</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_create</strong>(1) - Create a child object. The object can either be a key or a sealing object. A sealing object allows to seal user data to the TPM, with a maximum size of 128 bytes. Additionally it will load the created object if the <strong>-c</strong> is specified.<h1 id="options">OPTIONS</h1><p>These options for creating the TPM entity:<ul><li><p><strong>-C</strong>, <strong>--parent-context</strong>=<em>OBJECT</em>:<p>The parent of the object to be created.<li><p><strong>-P</strong>, <strong>--parent-auth</strong>=<em>AUTH</em>:<p>The authorization value of the parent object specified with <strong>-C</strong>.<li><p><strong>-p</strong>, <strong>--key-auth</strong>=<em>AUTH</em>:<p>The authorization value for the created object.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm for generating the objects name. This is optional and defaults to sha256 when not specified.<li><p><strong>-G</strong>, <strong>--key-algorithm</strong>=<em>ALGORITHM</em>:<p>The key algorithm associated with this object. It defaults to &quot;rsa&quot; if not specified.<li><p><strong>-a</strong>, <strong>--attributes</strong>=<em>ATTRIBUTES</em>:<p>The object attributes, optional. The default for created objects is:<p><code>TPMA_OBJECT_SIGN_ENCRYPT|TPMA_OBJECT_DECRYPT|TPMA_OBJECT_FIXEDTPM| TPMA_OBJECT_FIXEDPARENT|TPMA_OBJECT_SENSITIVEDATAORIGIN| TPMA_OBJECT_USERWITHAUTH</code><p>When <strong>-i</strong> is specified for sealing, <code>TPMA_OBJECT_SIGN_ENCRYPT</code> and <code>TPMA_OBJECT_DECRYPT</code> are removed from the default attribute set. The algorithm is set in a way where the the object is only good for sealing and unsealing. I.e. one cannot use an object for sealing and cryptography operations.<p>When <strong>-L</strong> is specified for adding policy based authorization information AND no string password is specified, the attribute <code>TPMA_OBJECT_USERWITHAUTH</code> is cleared unless an explicit choice is made by setting of the attribute with <strong>-a</strong> option. This prevents creation of objects with inadvertant auth model where in user intended to enforce a policy but inadvertantly created an object with empty auth which can be used instead of policy authorization.<li><p><strong>-i</strong>, <strong>--sealing-input</strong>=<em>FILE</em> or <em>STDIN</em>:<p>The data file to be sealed, optional. If file is -, read from stdin. When sealing data only the <em>TPM_ALG_KEYEDHASH</em> algorithm with a NULL scheme is allowed. Thus, <strong>-G</strong> cannot be specified.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>The input policy file, optional.<li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>The output file which contains the public portion of the created object, optional.<li><p><strong>-r</strong>, <strong>--private</strong>=<em>FILE</em>:<p>The output file which contains the sensitive portion of the object, optional. <a href="common/protection-details.md">protection details</a></ul><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>FILE</em>:<p>The output file which contains the key context, optional. The key context is analogous to the context file produced by <strong>tpm2_load</strong>(1), however is generated via a <strong>tpm2_createloaded</strong>(1) command. This option can be used to avoid the normal <strong>tpm2_create</strong>(1) and <strong>tpm2_load</strong>(1) command sequences and do it all in one command, atomically.<li><p><strong>--creation-data</strong>=<em>FILE</em>:<p>An optional file output that saves the creation data for certification.<ul><li><strong>--template-data</strong>=<em>FILE</em>:</ul><p>An optional file output that saves the key template data (TPM2B_PUBLIC) to be used in <strong>tpm2_policytemplate</strong>.<li><p><strong>-t</strong>, <strong>--creation-ticket</strong>=<em>FILE</em>:<p>An optional file output that saves the creation ticket for certification.<li><p><strong>-d</strong>, <strong>--creation-hash</strong>=<em>FILE</em>:<p>An optional file output that saves the creation hash for certification.<li><p><strong>-q</strong>, <strong>--outside-info</strong>=<em>HEX_STR_OR_FILE</em>:<p>An optional hex string or path to add unique data to the creation data. Note that it does not contribute in creating statistically unique object.<li><p><strong>-l</strong>, <strong>--pcr-list</strong>=<em>PCR</em>:<p>The list of PCR banks and selected PCRs&#39; ids for each bank to be included in the creation data for certification.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The session created using <strong>tpm2_startauthsession</strong>. Multiple of these can be specified. For example, you can have one session for auditing and another for encryption/decryption of the parameters.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="common/obj-attrs.md">object attribute specifiers</a> details the options for specifying the object attributes <em>ATTRIBUTES</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="setup">Setup</h2><p>In order to create an object, we must first create a primary key as it&#39;s parent.<pre><code class="language-bash">tpm2_createprimary -c primary.ctx
</code></pre><h2 id="create-an-object">Create an Object</h2><p>This will create an object using all the default values and store the TPM sealed private and public portions to the paths specified via -u and -r respectively. The tool defaults to an RSA key.<pre><code class="language-bash">tpm2_create -C primary.ctx -u obj.pub -r obj.priv
</code></pre><h2 id="seal-data-to-the-tpm">Seal Data to the TPM</h2><p>Outside of key objects, the TPM allows for small amounts of user specified data to be sealed to the TPM.<pre><code class="language-bash">echo &quot;my sealed data&quot; &gt; seal.dat
tpm2_create -C primary.ctx -i seal.dat -u obj.pub -r obj.priv
</code></pre><h2 id="create-an-ec-key-object-and-load-it-to-the-tpm">Create an EC Key Object and Load it to the TPM</h2><p>Normally, when creating an object, only the public and private portions of the object are returned and the caller needs to use tpm2_load(1) to load those public and private portions to the TPM before being able to use the object. However, this can be accomplished within this command as well.<pre><code class="language-bash">tpm2_create -C primary.ctx -G ecc -u obj.pub -r obj.priv -c ecc.ctx
</code></pre></template><template id="createak"><h1 id="name">NAME</h1><p><strong>tpm2_createak</strong>(1) - Generate attestation key with given algorithm under the endorsement hierarchy.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_createak</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_createak</strong>(1) - Generate an attestation key (AK) with the given algorithm under the endorsement hierarchy. The context of the attestation key is specified via <strong>-c</strong>.<p>The tool outputs to stdout a YAML representation of the loaded key&#39;s name, for example:<pre><code>loaded-key:
  name: 000bac149518baa05540a0678bd9b624f8a98d042e46c60f4d098ba394d36fc49268
</code></pre><h1 id="options">OPTIONS</h1><ul><li><p><strong>-P</strong>, <strong>--eh-auth</strong>=<em>AUTH</em>:<p>The authorization value for the endorsement hierarchy.<li><p><strong>-p</strong>, <strong>--ak-auth</strong>=<em>AUTH</em><p>The authorization value for the attestation key object created.<li><p><strong>-C</strong>, <strong>--ek-context</strong>=<em>OBJECT</em>:<p>The endorsement key object.<li><p><strong>-c</strong>, <strong>--ak-context</strong>=<em>FILE</em>:<p>The file path to save the object context of the attestation key.<li><p><strong>-G</strong>, <strong>--key-algorithm</strong>=<em>ALGORITHM</em>:<p>Specifies the attestation key algorithm. Supports:<ul><li>ecc - An P256 key.<li>rsa - An RSA2048 key.<li>keyedhash - hmac key.</ul><li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>Specifies the digest algorithm used for signing.<li><p><strong>-s</strong>, <strong>--signing-algorithm</strong>=<em>ALGORITHM</em>:<p>The signing algorithm.<li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>The file to save the public portion of the attestation key.<li><p><strong>-n</strong>, <strong>--ak-name</strong>=<em>FILE</em>:<p>The file to save the attestation key name, optional.<li><p><strong>-r</strong>, <strong>--private</strong>=<em>FILE</em>:<p>The output file which contains the sensitive portion of the object, optional. <a href="common/protection-details.md">protection details</a></ul><p><a href="./common/pubkey.html">pubkey options</a><pre><code>Format selection for the signature output file.
</code></pre><ul><li><p><strong>-q</strong>, <strong>--ak-qualified-name</strong>=<em>FILE</em>:<p>The qualified name of the attestation key object. The qualified name is the qualified name of the parent object (the EK in this instance) and the name of the object itself. Thus, the qualified name of an object serves to bind it to its parents.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/signature.html">signature format specifiers</a> option used to configure signature <em>FORMAT</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h3 id="create-an-attestation-key-and-make-it-persistent">Create an Attestation Key and make it persistent</h3><pre><code class="language-bash">tpm2_createek -c ek.handle -G rsa -u ek.pub
tpm2_createak -C ek.handle -c ak.ctx -u ak.pub -n ak.name
tpm2_evictcontrol -C o -c ak.ctx 0x81010002
</code></pre></template><template id="createek"><h1 id="name">NAME</h1><p><strong>tpm2_createek</strong>(1) - Generate TCG profile compliant endorsement key.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_createek</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_createek</strong>(1) - Generate TCG profile compliant endorsement key (EK), which is the primary object of the endorsement hierarchy.<p>If a transient object is generated the tool outputs a context file specified with <strong>-c</strong>.<p>Refer to: <a href="http://www.trustedcomputinggroup.org/files/static_page_files/7CAA5687-1A4B-B294-D04080D058E86C5F">http://www.trustedcomputinggroup.org/files/static_page_files/7CAA5687-1A4B-B294-D04080D058E86C5F</a><h1 id="options">OPTIONS</h1><ul><li><p><strong>-P</strong>, <strong>--eh-auth</strong>=<em>AUTH</em>:<p>The authorization value for the endorsement hierarchy<li><p><strong>-w</strong>, <strong>--owner-auth</strong>=<em>AUTH</em><p>The authorization value for the owner hierarchy.<li><p><strong>-c</strong>, <strong>--ek-context</strong>=<em>OBJECT</em> or <em>FILE</em>:<p>Either a file path or a persistent handle value to save the endorsement key.<p>If a value of <strong>-</strong> is passed the tool will find a vacant persistent handle to use and print out the automatically selected handle.<p>If one saves the context file via this option and the public key via the <strong>-u</strong> option, the EK can be restored via a call to <strong>tpm2_loadexternal</strong>(1).<li><p><strong>-G</strong>, <strong>--key-algorithm</strong>=<em>ALGORITHM</em>:<p>The endorsement key algorithm. Supports:<ul><li><strong>ecc</strong> - An P256 key.<li><strong>rsa</strong> - An RSA2048 key.<li><strong>keyedhash</strong> - hmac key.</ul><li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>The optional input for a file to save the public portion of endorsement key.<li><p><strong>-t</strong>, <strong>--template</strong>:<p>The optional manufacturer defined endorsement key template and nonce from fixed NV Indices to populate the <strong>TPM2B_PUBLIC</strong> public area. See the TCG EK Credential Profile specification for more information: <a href="https://trustedcomputinggroup.org/wp-content/uploads/">https://trustedcomputinggroup.org/wp-content/uploads/</a> TCG_IWG_Credential_Profile_EK_V2.1_R13.pdf</ul><p><a href="./common/pubkey.html">pubkey options</a><pre><code>Public key format.
</code></pre><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h3 id="create-an-endorsement-key-and-make-it-persistent">Create an Endorsement Key and make it persistent</h3><pre><code class="language-bash">tpm2_createek -P abc123 -w abc123 -c 0x81010001 -G rsa -u ek.pub
</code></pre><h3 id="create-a-transient-endorsement-key-flush-it-and-reload-it">Create a transient Endorsement Key, flush it, and reload it.</h3><pre><code class="language-bash">tpm2_createek -G rsa -u ek.pub

# Check that it is loaded in transient memory
tpm2_getcap handles-transient
- 0x80000000

# Flush the handle
tpm2_flushcontext 0x80000000

# Note that it is flushed
tpm2_getcap handles-transient
&lt;null output&gt;

# Reload it via loadexternal
tpm2_loadexternal -C o -u ek.pub -c ek.ctx

# Check that it is re-loaded in transient memory
tpm2_getcap handles-transient
- 0x80000000
</code></pre></template><template id="createpolicy"><h1 id="name">NAME</h1><p><strong>tpm2_createpolicy</strong>(1) - Creates simple assertion authorization policies based on multiple PCR indices values across multiple enabled banks.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_createpolicy</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_createpolicy</strong>(1) - Creates simple assertion authorization policies based on multiple PCR indices values across multiple enabled banks. It can then be used with object creation and or tools using the object.<h1 id="options">OPTIONS</h1><p>These options control creating the policy authorization session:<ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>The file to save the policy digest.<li><p><strong>--policy-pcr</strong>:<p>Identifies the PCR policy type for policy creation.<li><p><strong>-g</strong>, <strong>--policy-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm used in computation of the policy digest.<li><p><strong>-l</strong>, <strong>--pcr-list</strong>=<em>PCR</em>:<p>The list of PCR banks and selected PCRs&#39; ids for each bank.<li><p><strong>-f</strong>, <strong>--pcr</strong>=<em>FILE</em>:<p>Optional Path or Name of the file containing expected PCR values for the specified index. Default is to read the current PCRs per the set list.<li><p><strong>--policy-session</strong>:<p>Start a policy session of type <strong>TPM_SE_POLICY</strong>. Defaults to <strong>TPM_SE_TRIAL</strong> if this option isn&#39;t specified.</ul><h2 id="references">References</h2><p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/pcr.html">common options</a> details options for specifying the pcr index and bank/algorithm <em>PCR</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="create-a-authorization-policy-tied-to-a-specific-pcr-index">Create a authorization policy tied to a specific PCR index</h2><pre><code class="language-bash">tpm2_createpolicy \--policy-pcr -l 0x4:0 -L policy.file -f pcr0.bin
</code></pre></template><template id="createprimary"><h1 id="name">NAME</h1><p><strong>tpm2_createprimary</strong>(1) - Create a primary key.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_createprimary</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_createprimary</strong>(1) - This command is used to create a primary object under one of the hierarchies: Owner, Platform, Endorsement, NULL. The command will create and load a Primary Object. The sensitive and public portions are not returned. A context file for the created object&#39;s handle is saved as a file for future interactions with the created primary.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>The hierarchy under which the object is created. This will also dictate which authorization secret (if any) must be supplied. Defaults to <strong>TPM_RH_OWNER</strong>, when no value specified. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong>e</strong> for <strong>TPM_RH_ENDORSEMENT</strong><li><strong>n</strong> for <strong>TPM_RH_NULL</strong><li><strong><code>&lt;num&gt;</code></strong> where a raw number can be used.</ul><li><p><strong>-P</strong>, <strong>--hierarchy-auth</strong>=<em>AUTH</em>:<p>The authorization value for the hierarchy specified with <strong>-C</strong>.<li><p><strong>-p</strong>, <strong>--key-auth</strong>=<em>AUTH</em>:<p>The authorization value for the primary object created.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm to use for generating the objects name. Defaults to sha256 if not specified.<li><p><strong>-G</strong>, <strong>--key-algorithm</strong>=<em>ALGORITHM</em>:<p>The algorithm type for the generated primary key. Defaults to rsa2048:null:aes128cfb.<li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>FILE</em>:<p>The file path to save the object context of the generated primary object.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>An optional file input that contains the policy digest for policy based authorization of the object.<li><p><strong>-a</strong>, <strong>--attributes</strong>=<em>ATTRIBUTES</em>:<p>The object attributes, optional. Defaults to: <code>TPMA_OBJECT_RESTRICTED|TPMA_OBJECT_DECRYPT|TPMA_OBJECT_FIXEDTPM| TPMA_OBJECT_FIXEDPARENT|TPMA_OBJECT_SENSITIVEDATAORIGIN| TPMA_OBJECT_USERWITHAUTH</code><li><p><strong>-u</strong>, <strong>--unique-data</strong>=<em>FILE</em> OR <em>STDIN</em>:<p>An optional file input that contains the unique field of <strong>TPMT_PUBLIC</strong> in little-endian format. Primary key creator may place information that causes the primary key generation scheme internal to the TPM to generate statistically unique values. The TPM v2.0 specification calls this field unique and overloads it so that it contains one value when the application provides this structure as input and another value when the applications receives this structure as output (like public portion of the rsa key).<p>If the data is specified as a file, the user is responsible for ensuring that this buffer is formatted per TPMU_PUBLIC_ID union.<p>The unique data can also be retrieved from stdin buffer by specifying <strong>&quot;-&quot;</strong> as the <strong>--unique-data</strong> option value and the tool will parse the key type and associate the input data with the unique data buffer associated with the key type.<p>NOTE:<ol><li>The maximum allowed bytes is dependent on key type and the TPM implementation. Eg. While TSS allows a value upto 512 for MAX_RSA_KEY_BYTES, however the ibmSwTPM implementation supports a value upto 256 bytes.<li>The unique input data specified on stdin for ECC is split for specifying the X coordinate and Y coordinate buffers.</ol><li><p><strong>--creation-data</strong>=<em>FILE</em>:<p>An optional file output that saves the creation data for certification.<li><p><strong>--template-data</strong>=<em>FILE</em>:<p>An optional file output that saves the key template data (TPM2B_PUBLIC) to be used in <strong>tpm2_policytemplate</strong>.<li><p><strong>-t</strong>, <strong>--creation-ticket</strong>=<em>FILE</em>:<p>An optional file output that saves the creation ticket for certification.<li><p><strong>-d</strong>, <strong>--creation-hash</strong>=<em>FILE</em>:<p>An optional file output that saves the creation hash for certification.<li><p><strong>-q</strong>, <strong>--outside-info</strong>=<em>FILE_OR_HEX</em>:<p>An optional file or hex string to add unique data to the creation data. Note that it does not contribute in creating statistically unique object.<li><p><strong>-l</strong>, <strong>--pcr-list</strong>=<em>PCR</em>:<p>The list of PCR banks and selected PCRs&#39; ids for each bank to be included in the creation data for certification.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="common/obj-attrs.md">object attribute specifiers</a> details the options for specifying the object attributes <em>ATTRIBUTES</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="create-an-ecc-primary-object">Create an ECC primary object</h2><pre><code class="language-bash">tpm2_createprimary -C o -g sha256 -G ecc -c context.out
</code></pre><h2 id="create-a-primary-object-that-follows-the-guidance-of-tcg-provisioning-guide">Create a primary object that follows the guidance of TCG Provisioning guide</h2><p>See : <a href="https://trustedcomputinggroup.org/wp-content/uploads/TCG-TPM-v2.0-Provisioning-Guidance-Published-v1r1.pdf">https://trustedcomputinggroup.org/wp-content/uploads/TCG-TPM-v2.0-Provisioning-Guidance-Published-v1r1.pdf</a><p>Where unique.dat contains the binary-formatted data: 0x00 0x01 (0x00 * 256)<pre><code class="language-bash">tpm2_createprimary -C o -G rsa2048:aes128cfb -g sha256 -c prim.ctx \
-a &#39;restricted|decrypt|fixedtpm|fixedparent|sensitivedataorigin|userwithauth|\
noda&#39; -u unique.dat
</code></pre></template><template id="dictionarylockout"><h1 id="name">NAME</h1><p><strong>tpm2_dictionarylockout</strong>(1) - Setup or clear dictionary-attack-lockout parameters.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_dictionarylockout</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_dictionarylockout</strong>(1) - Setup dictionary-attack-lockout parameters or clear dictionary-attack-lockout state.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-s</strong>, <strong>--setup-parameters</strong>:<p>Specifies the tool should operate to setup dictionary-attack-lockout parameters.<li><p><strong>-c</strong>, <strong>--clear-lockout</strong>:<p>Specifies the tool should operate to clear dictionary-attack-lockout state.<li><p><strong>-l</strong>, <strong>--lockout-recovery-time</strong>=<em>NATURAL_NUMBER</em>:<p>Specifies the wait time in seconds before another <strong>TPM_RH_LOCKOUT</strong> authentication attempt can be made after a failed authentication.<li><p><strong>-t</strong>, <strong>--recovery-time</strong>=<em>NATURAL_NUMBER</em>:<p>Specifies the wait time in seconds before another DA-protected-object authentication attempt can be made after max-tries number of failed authentications.<li><p><strong>-n</strong>, <strong>--max-tries</strong>=<em>NATURAL_NUMBER</em>:<p>Specifies the maximum number of allowed authentication attempts on DA-protected-object; after which DA is activated.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>The authorization value for the lockout handle.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_dictionarylockout -c -p passwd

tpm2_dictionarylockout -s -n 5 -t 6 -l 7 -p passwd
</code></pre></template><template id="duplicate"><h1 id="name">NAME</h1><p>tpm2_duplicate(1) - Duplicates a loaded object so that it may be used in a different hierarchy.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_duplicate</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_duplicate</strong>(1) - This tool duplicates a loaded object so that it may be used in a different hierarchy. The new parent key for the duplicate may be on the same or different TPM or TPM_RH_NULL.<h1 id="options">OPTIONS</h1><p>These options control the key importation process:<ul><li><p><strong>-G</strong>, <strong>--wrapper-algorithm</strong>=<em>ALGORITHM</em>:<p>The symmetric algorithm to be used for the inner wrapper. Supports:<ul><li>aes - AES 128 in CFB mode.<li>null - none</ul><li><p><strong>-i</strong>, <strong>--encryptionkey-in</strong>=<em>FILE</em>:<p>Specifies the filename of the symmetric key (128 bit data) to be used for the inner wrapper. Valid only when specified symmetric algorithm is not null<li><p><strong>-o</strong>, <strong>--encryptionkey-out</strong>=<em>FILE</em>:<p>Specifies the filename to store the symmetric key (128 bit data) that was used for the inner wrapper. Valid only when specified symmetric algorithm is not null and --input-key-file is not specified. The TPM generates the key in this case.<li><p><strong>-C</strong>, <strong>--parent-context</strong>=<em>OBJECT</em>:<p>The parent key object.<li><p><strong>-r</strong>, <strong>--private</strong>=<em>FILE</em>:<p>Specifies the file path to save the private portion of the duplicated object. <a href="common/protection-details.md">protection details</a><li><p><strong>-s</strong>, <strong>--encrypted-seed</strong>=<em>FILE</em>:<p>The file to save the encrypted seed of the duplicated object.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>The authorization value for the key, optional.<li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>The object to be duplicated.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>To duplicate a key, one needs the key to duplicate, created with a policy that<br>allows duplication and a new parent:<pre><code class="language-bash">tpm2_startauthsession -S session.dat
tpm2_policycommandcode -S session.dat -L policy.dat TPM2_CC_Duplicate
tpm2_flushcontext session.dat

tpm2_createprimary -C o -g sha256 -G rsa -c primary.ctxt
tpm2_create -C primary.ctxt -g sha256 -G rsa -r key.prv -u key.pub \
-L policy.dat -a &quot;sensitivedataorigin&quot;

tpm2_loadexternal -C o -u new_parent.pub -c new_parent.ctxt

tpm2_startauthsession \--policy-session -S session.dat
tpm2_policycommandcode -S session.dat -L policy.dat TPM2_CC_Duplicate
tpm2_duplicate -C new_parent.ctxt -c key.ctxt -G null -p &quot;session:session.dat&quot; \
-r duprv.bin -s seed.dat
tpm2_flushcontext session.dat
</code></pre><p>As an end-to-end example, the following will transfer an RSA key generated on <code>TPM-A</code> to <code>TPM-B</code><h2 id="on-tpm-b">On TPM-B</h2><p>Create a parent object that will be used to wrap/transfer the key.<pre><code>tpm2_createprimary -C o -g sha256 -G rsa -c primary.ctx

tpm2_create  -C primary.ctx -g sha256 -G rsa \
-r new_parent.prv  -u new_parent.pub \
-a &quot;restricted|sensitivedataorigin|decrypt|userwithauth&quot;
</code></pre><p>Copy <code>new_parent.pub</code> to <code>TPM-A</code>.<h2 id="on-tpm-a">On TPM-A</h2><p>Create root object and auth policy allows duplication only<pre><code>tpm2_createprimary -C o -g sha256 -G rsa -c primary.ctx

tpm2_startauthsession -S session.dat

tpm2_policycommandcode -S session.dat -L dpolicy.dat TPM2_CC_Duplicate

tpm2_flushcontext session.dat

rm session.dat
</code></pre><p>Generate an RSA keypair on TPM-A that will be duplicated (note the passphrase is &#39;foo&#39;)<pre><code>tpm2_create -C primary.ctx -g sha256 -G rsa -p foo -r key.prv \
-u key.pub  -L dpolicy.dat -a &quot;sensitivedataorigin|userwithauth|decrypt|sign&quot;

tpm2_load -C primary.ctx -r key.prv -u key.pub -c key.ctx

tpm2_readpublic -c key.ctx -o dup.pub
</code></pre><p>Test sign and encryption locally (so we can compare later that the same key was transferred).<pre><code>echo &quot;meet me at..&quot; &gt;file.txt
tpm2_rsaencrypt -c key.ctx  -o data.encrypted file.txt
tpm2_sign -c key.ctx -g sha256 -f plain -p foo -o sign.raw file.txt
</code></pre><p>Compare the signature hash (we will use this later to confirm the key was transferred to TPM-B):<pre><code>sha256sum sign.raw

a1b4e3fbaa29e6e46d95cff498150b6b8e7d9fd21182622e8f5a3ddde257879e
</code></pre><p>Start an auth session and policy command to allow duplication<pre><code>tpm2_startauthsession --policy-session -S session.dat

tpm2_policycommandcode -S session.dat -L dpolicy.dat TPM2_CC_Duplicate
</code></pre><p>Load the new_parent.pub file transferred from <code>TPM-B</code><pre><code>tpm2_loadexternal -C o -u new_parent.pub -c new_parent.ctx
</code></pre><p>Start the duplication<pre><code>tpm2_duplicate -C new_parent.ctx -c key.ctx -G null  \
-p &quot;session:session.dat&quot; -r dup.dpriv -s dup.seed
</code></pre><p>Copy the following files to TPM-B:<ul><li>dup.pub<li>dup.dpriv<li>dup.seed<li>(optionally data.encrypted just to test decryption)</ul><h2 id="on-tpm-b-1">On TPM-B</h2><p>Start an auth,policy session<pre><code>tpm2_startauthsession --policy-session -S session.dat

tpm2_policycommandcode -S session.dat -L dpolicy.dat TPM2_CC_Duplicate
</code></pre><p>Load the context we used to transfer<pre><code>tpm2_flushcontext --transient-object

tpm2_load -C primary.ctx -u new_parent.pub -r new_parent.prv -c new_parent.ctx
</code></pre><p>Import the duplicated context against the parent we used<pre><code>tpm2_import -C new_parent.ctx -u dup.pub -i dup.dpriv \
-r dup.prv -s dup.seed -L dpolicy.dat
</code></pre><p>Load the duplicated key context<pre><code>tpm2_flushcontext --transient-object

tpm2_load -C new_parent.ctx -u dup.pub -r dup.prv -c dup.ctx
</code></pre><p>Test the imported key matches<ul><li>Sign</ul><pre><code class="language-bash">echo &quot;meet me at..&quot; &gt;file.txt

tpm2_sign -c dup.ctx -g sha256 -o sig.rss -p foo file.txt

dd if=sig.rss of=sign.raw bs=1 skip=6 count=256
</code></pre><p>Compare the signature file hash:<pre><code class="language-bash">$ sha256sum sign.raw

a1b4e3fbaa29e6e46d95cff498150b6b8e7d9fd21182622e8f5a3ddde257879e
</code></pre><ul><li>Decryption</ul><pre><code>tpm2_flushcontext --transient-object

tpm2_rsadecrypt -p foo -c dup.ctx -o data.ptext data.encrypted

# cat data.ptext 
meet me at..
</code></pre></template><template id="ecdhkeygen"><h1 id="name">NAME</h1><p><strong>tpm2_ecdhkeygen</strong>(1) - Creates an ephemeral key and uses it to generate the shared secret value using the parameters from a ECC public key.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_ecdhkeygen</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_ecdhkeygen</strong>(1) - Creates an ephemeral key and uses it to generate the shared secret value using the parameters from a ECC public key.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--context</strong>=<em>FILE</em>:<p>Context object pointing to ECC public key. Either a file or a handle number. See section &quot;Context Object Format&quot;.<li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>Output ECC point Q.<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em><p>Specify file path to save the calculated ecdh secret or Z point.</ul><h2 id="references">References</h2><p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx -Q

tpm2_create -C prim.ctx -c key.ctx -u key.pub -r key.priv -G ecc256:ecdaa

tpm2_ecdhkeygen -u ecdh.pub -o ecdh.priv -c key.ctx
</code></pre></template><template id="ecdhzgen"><h1 id="name">NAME</h1><p><strong>tpm2_ecdhzgen</strong>(1) - Recovers the shared secret value (Z) from a public point and a specified private key.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_ecdhzgen</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_ecdhzgen</strong>(1) - Recovers the shared secret value (Z) from a public point and a specified private key. It will perform the multiplication of the provided inPoint (QB) with the private key (ds) and return the coordinates of the resultant point (Z = (xZ , yZ) ≔ [hds]QB; where h is the cofactor of the curve).<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>FILE</em>:<p>Context object pointing to ECC key. Either a file or a handle number. See section &quot;Context Object Format&quot;.<li><p><strong>-p</strong>, <strong>--key-auth</strong>=<em>AUTH</em>:<p>The authorization value for the ECC key object.<li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>Output ECC point Q.<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em><p>Specify file path to save the calculated ecdh secret or Z point.</ul><h2 id="references">References</h2><p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx -Q

tpm2_create -C prim.ctx -c key.ctx -u key.pub -r key.priv -G ecc256:ecdh

tpm2_ecdhkeygen -u ecdh.pub -o ecdh.priv -c key.ctx

tpm2_ecdhzgen -u ecdh.pub -o ecdh.dat -c key.ctx
</code></pre></template><template id="ecephemeral"><h1 id="name">NAME</h1><p><strong>tpm2_ecephemeral</strong>(1) - Creates an ephemeral key for use in a two-phase key exchange protocol.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_ecephemeral</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_ecephemeral</strong>(1) - Creates an ephemeral key for use in a two-phase key exchange protocol.<h1 id="options">OPTIONS</h1><ul><li><p><strong>ARGUMENT</strong>=<em>ALGORITHM</em>:<p>Specify the ECC curve. Example ecc521.<li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em><p>Specify the file path to save the ephemeral public point Q ≔ [r]G.<li><p><strong>-t</strong>, <strong>--counter</strong>=<em>FILE</em><p>Specify file path to save the least-significant 16 bits of commit count.</ul><h2 id="references">References</h2><p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_ecephemeral -u ecc.q -t ecc.ctr ecc256
</code></pre></template><template id="encryptdecrypt"><h1 id="name">NAME</h1><p><strong>tpm2_encryptdecrypt</strong>(1) - Performs symmetric encryption or decryption.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_encryptdecrypt</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_encryptdecrypt</strong>(1) - Performs symmetric encryption or decryption with a specified symmetric key on the contents of <em>FILE</em>. If <em>FILE</em> is not specified, defaults to <em>stdin</em>.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>The encryption key object.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>The authorization value for the encryption key object.<li><p><strong>-d</strong>, <strong>--decrypt</strong>:<p>Perform a decrypt operation. Defaults to encryption when this option is not specified.<li><p><strong>-e</strong>, <strong>--pad</strong>:<p>Enable pkcs7 padding for applicable AES encryption modes cfb/cbc/ecb. Applicable only to encryption and for input data with last block shorter than encryption block length.<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em> or <em>STDOUT</em>:<p>The output file path for either the encrypted or decrypted data. If not specified, defaults to <strong>stdout</strong>.<li><p><strong>-G</strong>, <strong>--mode</strong>=<em>ALGORITHM</em>:<p>The key algorithm associated with this object. Defaults to object properties or CFB if not defined.<li><p><strong>-t</strong>, <strong>--iv</strong>=<em>FILE</em>:<p>Optional initialization vector to use. Defaults to 0&#39;s. Syntax allows for an input file and output file source to be specified. The input file path is first, optionally followed by a colon &quot;:&quot; and the output iv path. This output iv can be saved for subsequent calls when chaining.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the input file path <em>FILE</em> of the data to encrypt or decrypt.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h1 id="create-an-aes-key">Create an AES key</h1><pre><code class="language-bash">tpm2_createprimary -c primary.ctx
tpm2_create -C primary.ctx -Gaes128 -u key.pub -r key.priv
tpm2_load -C primary.ctx -u key.pub -r key.priv -c key.ctx
</code></pre><h1 id="encrypt-and-decrypt-some-data">Encrypt and Decrypt some data</h1><pre><code class="language-bash">echo &quot;my secret&quot; &gt; secret.dat
tpm2_encryptdecrypt -c key.ctx -o secret.enc secret.dat
tpm2_encryptdecrypt -d -c key.ctx -o secret.dec secret.enc
cat secret.dec
my secret
</code></pre></template><template id="eventlog"><h1 id="name">NAME</h1><p><strong>tpm2_eventlog</strong>(1) - Display tpm2 event log.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_eventlog</strong> [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_eventlog</strong>(1) - Parse a binary TPM2 event log. The event log may be passed to the tool as the final positional parameter. If this parameter is omitted the tool will return an error. The format of this log documented in the &quot;TCG PC Client Platform Firmware Profile Specification&quot;.<h1 id="options">OPTIONS</h1><p>This tool takes no tool specific options.<ul><li><strong>ARGUMENT</strong> The command line argument is the path to a binary TPM2 eventlog.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash"># display eventlog from provided file
tpm2_eventlog eventlog.bin
</code></pre></template><template id="evictcontrol"><h1 id="name">NAME</h1><p><strong>tpm2_evictcontrol</strong>(1) - Make a transient object persistent or evict a persistent object.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_evictcontrol</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_evictcontrol</strong>(1) - Allows a transient object to be made persistent or a persistent object to be evicted. The <em>HANDLE</em> argument controls the index the handle will be assigned to. If the object specified via <strong>-c</strong> is transient, and a permanent <em>HANDLE</em> is specified, the object will be persisted at <em>HANDLE</em>. If <em>HANDLE</em> is a -, then the object will be persisted at the first available permanent handle location. If the object specified via <strong>-c</strong> is a permanent handle, then the object will be evicted from it&#39;s permenent handle location.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>The authorization hierarchy used to authorize the commands. Defaults to the &quot;owner&quot; hierarchy. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a raw number can be used.</ul><li><p><strong>-c</strong>, <strong>--object-context</strong>=<em>OBJECT</em>:<p>A context object specifier of a transient or persistent object. If <em>OBJECT</em> is a transient object it will be persisted, either to the handle specified by the argument or to first available vacant persistent handle. If the <em>OBJECT</em> is for a persistent object, then the object will be evicted from non-volatile memory.<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>The authorization value for the hierarchy specified with <strong>-C</strong>.<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em>:<p>Optionally output a serialized object representing the persistent handle. If untampered, these files are safer to use then raw persistent handles. A raw persistent handle should be verified that the object it points to is as expected.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the persistent handle to save the transient object to.</ul><h1 id="output">Output</h1><p>The tool outputs a YAML compliant dictionary with the fields: persistent-handle:<handle>action: evicted|persisted</handle><p>Where <em>persistent-handle</em> is the handle the action occurred to. Where <em>action</em> can either be one of <em>evicted</em> or <em>persisted</em>. If an object is <em>evicted</em> then the object is no longer resident at the <em>persistent-handle</em> address within the TPM. If an object is <em>persisted</em> then the object is resident at the <em>persistent-handle</em> address within the TPM.<h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="to-make-a-transient-handle-persistent-at-address-0x81010002">To make a transient handle persistent at address 0x81010002</h2><pre><code class="language-bash">tpm2_changeauth -c o ownerauth
tpm2_createprimary -c primary.ctx -P ownerauth
tpm2_evictcontrol -C o -c primary.ctx 0x81010002 -P ownerauth
</code></pre><h2 id="to-evict-a-persistent-handle">To evict a persistent handle</h2><pre><code class="language-bash">tpm2_evictcontrol -C o -c 0x81010002 -P ownerauth
</code></pre><h2 id="to-make-a-transient-handle-persistent-and-output-a-serialized-persistent-handle">To make a transient handle persistent and output a serialized persistent handle.</h2><pre><code class="language-bash">tpm2_evictcontrol -C o -c primary.ctx -o primary.handle -P ownerauth
</code></pre></template><template id="flushcontext"><h1 id="name">NAME</h1><p><strong>tpm2_flushcontext</strong>(1) - Remove a specified handle, or all contexts associated with a transient object, loaded session or saved session from the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_flushcontext</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_flushcontext</strong>(1) - Remove a specified handle, or all contexts associated with a transient object, loaded session or saved session from the TPM. The object to be flushed is specified as the first argument to the tool and is in one of the following forms:<ul><li>The handle of the object to be flushed from the TPM. Must be a valid handle number.<li>Flush a session via a session file. A session file is generated from <strong>tpm2_startauthsession</strong>(1)&#39;s <strong>-S</strong> option.</ul><h1 id="options">OPTIONS</h1><ul><li><p><strong>-t</strong>, <strong>--transient-object</strong>:<p>Remove all transient objects.<li><p><strong>-l</strong>, <strong>--loaded-session</strong>:<p>Remove all loaded sessions.<li><p><strong>-s</strong>, <strong>--saved-session</strong>:<p>Remove all saved sessions.<li><p><strong>ARGUMENT</strong> the command line argument specifies the <em>OBJECT</em> to be removed from the TPM resident memory.</ul><p><a href="./common/options.html">common options</a><p><a href="./common/tcti.html">common tcti options</a><h1 id="examples">EXAMPLES</h1><h2 id="flushing-a-transient-object">Flushing a Transient Object</h2><p>Typically, when using the TPM, the interactions occur through a resource manager, like tpm2-abrmd(8). When the process exits, transient object handles are flushed. Thus, flushing transient objects through the command line is not required. However, when interacting with the TPM directly, this scenario is possible. The below example assumes direct TPM access not brokered by a resource manager. Specifically we will use the simulator.<pre><code class="language-bash">tpm2_createprimary -Tmssim -c primary.ctx

tpm2_getcap -T mssim handles-transient
- 0x80000000

tpm2_flushcontext -T mssim 0x80000000
</code></pre><h2 id="flush-all-the-transient-objects">Flush All the Transient Objects</h2><pre><code class="language-bash">tpm2_flushcontext \--transient-object
</code></pre><h2 id="flush-a-session">Flush a Session</h2><pre><code class="language-bash">tpm2_startauthsession -S session.dat

tpm2_flushcontext session.dat
</code></pre></template><template id="getcap"><h1 id="name">NAME</h1><p><strong>tpm2_getcap</strong>(1) - Display TPM capabilities in a human readable form.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_getcap</strong> [<em>OPTIONS</em>] [<em>CAPABILITY</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_getcap</strong>(1) - Query the TPM for it&#39;s capabilities / properties and print them to the console. It takes a string form of the capability to query as an argument to the tool. Currently supported capability groups are:<ul><li><p><strong>algorithms</strong>: Display data about supported algorithms.<li><p><strong>commands</strong>: Display data about supported commands.<li><p><strong>pcrs</strong>: Display currently allocated PCRs.<li><p><strong>properties-fixed</strong>: Display fixed TPM properties.<li><p><strong>properties-variable</strong>: Display variable TPM properties.<li><p><strong>ecc-curves</strong>: Display data about elliptic curves.<li><p><strong>handles-transient</strong>: Display handles about transient objects.<li><p><strong>handles-persistent</strong>: Display handles about persistent objects.<li><p><strong>handles-permanent</strong>: Display handles about permanent objects.<li><p><strong>handles-pcr</strong>: Display handles about PCRs.<li><p><strong>handles-nv-index</strong>: Display handles about NV Indices.<li><p><strong>handles-loaded-session</strong>: Display handles about both loaded HMAC and policy sessions.<li><p><strong>handles-saved-session</strong>: Display handles about saved sessions.</ul><h1 id="options">OPTIONS</h1><ul><li><p><strong>-l</strong>, <strong>--list</strong>:<p>List known supported capability names. These names can be supplied as the argument to the <strong>-c</strong> option. Output is in a YAML compliant list to stdout.<p>For example:<pre><code>  - algorithms
  - commands
  - properties-fixed
  ...
</code></pre></ul><p><a href="./common/options.html">common options</a><p><a href="./common/tcti.html">common tcti options</a><h1 id="examples">EXAMPLES</h1><h2 id="to-list-the-fixed-properties-of-the-tpm">To list the fixed properties of the TPM</h2><pre><code class="language-bash">tpm2_getcap properties-fixed
</code></pre><h2 id="to-list-the-supported-capability-groups">To list the supported capability groups</h2><pre><code class="language-bash">tpm2_getcap -l
</code></pre></template><template id="getcommandauditdigest"><h1 id="name">NAME</h1><p><strong>tpm2_getcommandauditdigest</strong>(1) - Retrieve the command audit attestation data from the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_getcommandauditdigest</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_getcommandauditdigest</strong>(1) - Retrieve the command audit attestation data from the TPM. The attestation data includes the audit digest of the commands in the setlist setup using the command <strong>tpm2_setcommandauditstatus</strong>. Also the attestation data includes the digest of the list of commands setup for audit. The audit digest algorith is setup in the <strong>tpm2_setcommandauditstatus</strong>.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-P</strong>, <strong>--hierarchy-auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the endorsement hierarchy.<li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>Context object for the signing key that signs the attestation data.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for key specified by option <strong>-c</strong>.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>HEX_STRING_OR_PATH</em>:<p>Data given as a Hex string or binary file to qualify the quote, optional. This is typically used to add a nonce against replay attacks.<li><p><strong>-s</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>Signature output file, records the signature in the format specified via the <strong>-f</strong> option.<li><p><strong>-m</strong>, <strong>--message</strong>=<em>FILE</em>:<p>Message output file, records the quote message that makes up the data that is signed by the TPM. This is the command audit digest attestation data.<li><p><strong>-f</strong>, <strong>--format</strong>=<em>FORMAT</em>:<p>Format selection for the signature output file.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>:<p>Hash algorithm for signature. Defaults to sha256.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/signature.html">signature format specifiers</a> option used to configure signature <em>FORMAT</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_getcommandauditdigest -P ekpass -c key.ctx -p keypass -m att.data -s att.sig
</code></pre></template><template id="geteccparameters"><h1 id="name">NAME</h1><p><strong>tpm2_geteccparameters</strong>(1) - Retrieves the parameters of an ECC curve identified by its TCG-assigned curveID.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_geteccparameters</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_geteccparameters</strong>(1) - Retrieves the parameters of an ECC curve identified by its TCG-assigned curveID.<h1 id="options">OPTIONS</h1><ul><li><p><strong>ARGUMENT</strong>=<em>ALGORITHM</em>:<p>Specify the ECC curve. Example ecc521.<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em><p>Specify the file path to save the ECC parameters.</ul><h2 id="references">References</h2><p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_geteccparameters ecc256 -o ecc.params
</code></pre></template><template id="getekcertificate"><h1 id="name">NAME</h1><p><strong>tpm2_getekcertificate</strong>(1) - Retrieve the Endorsement key Certificate.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_getekcertificate</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_getekcertificate</strong>(1) - Retrieve the endorsement key certificate. The certificate is present either on the TCG specified TPM NV indices OR on the TPM manufacturer&#39;s endorsement certificate hosting server. Following are the conditions dictating the certificate location lookup.<ol><li><p>NV-Index:<p>Default search location when <strong>ARGUMENT</strong> is not specified.<li><p>Intel-EK-certificate-server:<p>Search location when EK certificate could not be found in the NV index AND tpmEPSgenerated bit is CLEAR AND manufacturer is INTC.<li><p>Intel-EK-Re-certification-server:<p>Search location when EK certificate could not be found in the NV index AND tpmEPSgenerated bit is SET AND manufacturer is INTC.<p>Note:<p>In this operation information is provided regarding additional software to be run as part of the re-provisioning/ re-certification service.<p>After re-provisioning/ recertification process is complete, EK certificates can be read from the NV indexes by running another instance of <strong>tpm2_getekcertificate</strong>.<li><p>Generic or other EK-certificate-server:<p>Search location when <strong>ARGUMENT</strong> specifies the EK certificate web hosting address.</ol><h1 id="options">OPTIONS</h1><ul><li><p><strong>-o</strong>, <strong>--ek-certificate</strong>=<em>FILE</em> or <em>STDOUT</em>:<p>The file to save the Endorsement key certificate. When EK certificates are found in the TPM NV indices, this option can be specified additional times to save the RSA and ECC EK certificates in order. The tool will warn if additional EK certificates are found on the TPM NV indices and only a single output file is specified. If the option isn&#39;t specified all the EK certificates retrieved either from the manufacturer web hosting or from the TPM NV indices, are output to stdout.<li><p><strong>-X</strong>, <strong>--allow-unverified</strong>:<p>Specifies to attempt connecting with the TPM manufacturer provisioning server without verifying server certificate. This option is irrelevant when EK certificates are found on the TPM NV indices.<p><strong>WARNING</strong>: This option should be used only on platforms with older CA certificates.<li><p><strong>-u</strong>, <strong>--ek-public</strong>=<em>FILE</em>:<p>Specifies the file path for the endorsement key public portion in tss format.<li><p><strong>-x</strong>, <strong>--offline</strong>:<p>This flags the tool to operate in an offline mode. In that the certificates can be retrieved for supplied EK public that do not belong to the platform the tool is run on. Useful in factory provisioning of multiple platforms that are not individually connected to the Internet. In such a scenario a single Internet facing provisioning server can utilize this tool in this mode. This forces the tool to not look for the EK certificates on the NV indices.<li><p><strong>--raw</strong>:<p>This flags the tool to output the EK certificate as is received from the source: NV/ Web-Hosting.<li><p><strong>ARGUMENT</strong> the command line argument specifies the URL address for the EK certificate portal. This forces the tool to not look for the EK certificates on the NV indices.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="notes">NOTES</h1><p>When the verbose option is specified, additional curl debugging information is provided by setting the curl mode verbose, see <a href="https://curl.haxx.se/libcurl/c/CURLOPT_VERBOSE.html">https://curl.haxx.se/libcurl/c/CURLOPT_VERBOSE.html</a> for more information.<h1 id="examples">EXAMPLES</h1><h2 id="retrieve-ek-certificate-from-tpm-manufacturer-backend-by-supplying-ek-public">Retrieve EK certificate from TPM manufacturer backend by supplying EK public.</h2><pre><code class="language-bash">tpm2_createek -G rsa -u ek.pub -c key.ctx

tpm2_getekcertificate -X -o ECcert.bin -u ek.pub \
https://tpm.manufacturer.com/ekcertserver/
</code></pre><h2 id="retrieve-ek-certificate-from-intel-backend-if-certificate-not-found-on-nv">Retrieve EK certificate from Intel backend if certificate not found on NV.</h2><pre><code class="language-bash">tpm2_createek -G rsa -u ek.pub -c key.ctx

tpm2_getekcertificate -X -o ECcert.bin -u ek.pub
</code></pre><h2 id="retrieve-ek-certificate-from-intel-backend-for-an-offline-platform">Retrieve EK certificate from Intel backend for an offline platform.</h2><pre><code class="language-bash">tpm2_getekcertificate -X -x -o ECcert.bin -u ek.pub
</code></pre><h2 id="retrieve-ek-certificate-from-tpm-nv-indices-only-fail-otherwise">Retrieve EK certificate from TPM NV indices only, fail otherwise.</h2><pre><code class="language-bash">tpm2_getekcertificate -o ECcert.bin
</code></pre><h2 id="retrieve-multiple-ek-certificates-from-tpm-nv-indices-only-fail-otherwise">Retrieve multiple EK certificates from TPM NV indices only, fail otherwise.</h2><pre><code class="language-bash">tpm2_getekcertificate -o RSA_EK_cert.bin -o ECC_EK_cert.bin
</code></pre></template><template id="getrandom"><h1 id="name">NAME</h1><p><strong>tpm2_getrandom</strong>(1) - Retrieves random bytes from the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_getrandom</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_getrandom</strong>(1) - Returns the next <em>SIZE</em> octets from the random number generator. The <em>SIZE</em> parameter is expected as the only argument to the tool.<p>Note that the TPM specification recommends that TPM&#39;s fix the number of available entry to the maximum size of a hash algorithm output in bytes.<p>Most TPMs do this, and thus the tool verifies that input size is bounded by property <strong>TPM2_PT_MAX_DIGEST</strong> and issues an error if it is too large.<p>Output defaults to <em>stdout</em> and binary format unless otherwise specified with <strong>-o</strong> and <strong>--hex</strong> options respectively.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em><p>Specifies the filename to output the raw bytes to. Defaults to stdout as a hex string.<li><p><strong>--hex</strong><p>Convert the output data to hex format without a leading &quot;0x&quot;.<li><p><strong>-f</strong>, <strong>--force</strong><p>Override checking that the:<ul><li>Requested size is within the hash size limit of the TPM.<li>Number of retrieved random bytes matches requested amount.</ul><li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The session created using <strong>tpm2_startauthsession</strong>. Multiple of these can be specified. For example, you can have one session for auditing and another for encryption of the parameters.<li><p><strong>--cphash</strong>=<em>FILE</em>:<p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, in absence of rphash option, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>--rphash</strong>=<em>FILE</em>:<p>File path to record the hash of the response parameters. This is commonly termed as rpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the size of the output.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="generate-a-random-20-bytes-and-output-the-binary-data-to-a-file">Generate a random 20 bytes and output the binary data to a file</h2><pre><code class="language-bash">tpm2_getrandom -o random.out 20
</code></pre><h2 id="generate-a-random-8-bytes-and-output-the-hex-formatted-data-to-stdout">Generate a random 8 bytes and output the hex formatted data to stdout</h2><pre><code class="language-bash">tpm2_getrandom 8
</code></pre></template><template id="getsessionauditdigest"><h1 id="name">NAME</h1><p><strong>tpm2_getsessionauditdigest</strong>(1) - Retrieve the command audit attestation data from the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_getsessionauditdigest</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_getsessionauditdigest</strong>(1) - Retrieve the session audit digest attestation data from the TPM. The attestation data includes the session audit digest and a signature over the session audit digest. The session itself is started with the <strong>tpm2_startauthsession</strong> command.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-P</strong>, <strong>--hierarchy-auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the endorsement hierarchy.<li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>Context object for the signing key that signs the attestation data.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for key specified by option <strong>-c</strong>.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>HEX_STRING_OR_PATH</em>:<p>Data given as a Hex string or binary file to qualify the quote, optional. This is typically used to add a nonce against replay attacks.<li><p><strong>-s</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>Signature output file, records the signature in the format specified via the <strong>-f</strong> option.<li><p><strong>-m</strong>, <strong>--message</strong>=<em>FILE</em>:<p>Message output file, records the quote message that makes up the data that is signed by the TPM. This is the command audit digest attestation data.<li><p><strong>-f</strong>, <strong>--format</strong>=<em>FORMAT</em>:<p>Format selection for the signature output file.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>:<p>Hash algorithm for signature. Defaults to sha256.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The path of the session that enables and records the audit digests.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/signature.html">signature format specifiers</a> option used to configure signature <em>FORMAT</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_createprimary -Q -C e -c prim.ctx

tpm2_create -Q -C prim.ctx -c signing_key.ctx -u signing_key.pub \
-r signing_key.priv

tpm2_startauthsession -S session.ctx --audit-session

tpm2_getrandom 8 -S session.ctx

tpm2_getsessionauditdigest -c signing_key.ctx -m att.data -s att.sig \
-S session.ctx
</code></pre></template><template id="gettestresult"><h1 id="name">NAME</h1><p><strong>tpm2_gettestresult</strong>(1) - Get the result of tests performed by the TPM<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_gettestresult</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_gettestresult</strong>(1) will return the result of the tests conducted by the TPM.<p>Error code will state if the test executed successfully or have failed.<p>If pending algorithms are scheduled to be tested, <strong>tpm2_gettestresult</strong> will return &quot;TESTING&quot;. Otherwise &quot;FAILED&quot; will be returned or &quot;SUCCESS&quot; depending on the result to the test.<p>Manufacturer-dependent information will also be printed in raw hex format.<h1 id="options">OPTIONS</h1><p>This tool accepts no tool specific options.<p><a href="./common/options.html">common options</a><p><a href="./common/tcti.html">common tcti options</a><h1 id="examples">EXAMPLES</h1><h2 id="get-the-result-of-the-tpm-testing">Get the result of the TPM testing</h2><pre><code class="language-bash">tpm2_gettestresult
</code></pre><h1 id="notes">NOTES</h1><p>This command is the one of the few commands authorized to be submitted to TPM when in failure mode.</template><template id="gettime"><h1 id="name">NAME</h1><p><strong>tpm2_gettime</strong>(1) - Get the current time and clock from the TPM in a signed form.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_gettime</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_gettime</strong>(1) - Provides a signed copy of the current time and clock from the TPM. It returns both a signature, and the data in the standard TPM attestation form, a TPMS_ATTEST structure.<p>It outputs to stdout, in YAML format, the TPMS_TIME_INFO structure from the TPM. The structure contains the current setting of Time, Clock, resetCount, and restartCount. The structure is output as YAML defined as:<pre><code class="language-yaml">time: 13673142     # 64 bit value of time since last _TPM_Init or TPM2_Startup
                   # in ms.
clock_info:
  clock: 13673142  # 64 bit value of time TPM has been powered on in ms.
  reset_count: 0   # 32 bit value of the number of TPM Resets since the last
                   # TPM2_Clear.
  restart_count: 0 # 32 bit value of the number of times that TPM2_Shutdown or
                   # _TPM_Hash_Start have occurred since the last TPM Reset or
                   # TPM2_Clear.
  safe: yes        # boolean yes|no value that no value of Clock greater than
                   # the current value of Clock has been previously reported by
                   # the TPM.
</code></pre><h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>Context object pointing to the the key used for signing. Either a file or a handle number. See section &quot;Context Object Format&quot;.<li><p><strong>-p</strong>, <strong>--auth</strong><em>AUTH</em>:<p>Optional authorization value to use the key specified by <strong>-c</strong>. Authorization values should follow the &quot;authorization formatting standards&quot;, see section &quot;Authorization Formatting&quot;.<li><p><strong>-P</strong>, <strong>--endorse-auth</strong><em>AUTH</em>:<p>Optional authorization value for the endorsement hierarchy. Authorization values should follow the &quot;authorization formatting standards&quot;, see section &quot;Authorization Formatting&quot;.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm used to digest the message. Algorithms should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;. Also, see section &quot;Supported Hash Algorithms&quot; for a list of supported hash algorithms.<li><p><strong>-s</strong>, <strong>--scheme</strong>=<em>ALGORITHM</em>:<p>The signing scheme used to sign the message. Optional. Signing schemes should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;. Also, see section &quot;Supported Signing Schemes&quot; for a list of supported signature schemes. If specified, the signature scheme must match the key type. If left unspecified, a default signature scheme for the key type will be used.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>FILE_OR_HEX_STR</em>:<p>Optional, the policy qualifier data that the signer can choose to include in the signature. Can be either a hex string or path.<li><p><strong>-o</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>The signature file, records the signature structure.<li><p><strong>-f</strong>, <strong>--format</strong>=<em>FORMAT</em>:<p>Format selection for the signature output file. See section &quot;Signature Format Specifiers&quot;.<li><p><strong>--attestation</strong>=<em>FILE</em>:<p>The attestation data of the type TPMS_ATTEST signed with signing key.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the file data for sign.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules. <a href="./common/signature.html">signature format specifiers</a><h1 id="examples">EXAMPLES</h1><h2 id="create-a-key-and-get-attested-tpm-time">Create a key and get attested TPM time</h2><pre><code class="language-bash">tpm2_createprimary -C e -c primary.ctx

tpm2_create -G rsa -u rsa.pub -r rsa.priv -C primary.ctx

tpm2_load -C primary.ctx -u rsa.pub -r rsa.priv -c rsa.ctx

tpm2_gettime -c rsa.ctx -o attest.sig --attestation attest.data
</code></pre></template><template id="hash"><h1 id="name">NAME</h1><p><strong>tpm2_hash</strong>(1) - Performs a hash operation with the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_hash</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em> OR <em>STDIN</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_hash</strong>(1) - Performs a hash operation on file and returns the results. If argument is not specified, then data is read from stdin. If the results of the hash will be used in a signing operation that uses a restricted signing key, then the ticket returned by this command can indicate that the hash is safe to sign.<p>Output defaults to <em>stdout</em> and binary format unless otherwise specified via <strong>-o</strong> and <strong>--hex</strong> options respectively.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Hierarchy to use for the ticket. Defaults to <strong>o</strong>, <strong>TPM_RH_OWNER</strong>, when no value has been specified. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong>e</strong> for <strong>TPM_RH_ENDORSEMENT</strong><li><strong>n</strong> for <strong>TPM_RH_NULL</strong></ul><li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hashing algorithm for the digest operation.<li><p><strong>--hex</strong><p>Convert the output hmac to hex format without a leading &quot;0x&quot;.<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em> or <em>STDOUT</em>:<p>Optional file to save the hash result. Defaults to stdout in hex form.<li><p><strong>-t</strong>, <strong>--ticket</strong>=<em>TICKET_FILE</em><p>Optional file record of the ticket result. Defaults to stdout in hex form.<li><p><strong>ARGUMENT</strong> or <strong>STDIN</strong> the command line argument specifies the <em>FILE</em> to hash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/alg.html">authorization formatting</a> details the methods for specifying the <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="hash-a-file-with-sha1-hash-algorithm-and-save-the-hash-and-ticket-to-a-file">Hash a file with sha1 hash algorithm and save the hash and ticket to a file</h2><pre><code class="language-bash">tpm2_hash -C e -g sha1 -o hash.bin -t ticket.bin data.txt
</code></pre></template><template id="hierarchycontrol"><h1 id="name">NAME</h1><p><strong>tpm2_hierarchycontrol</strong>(1) - Enable and disable use of a hierarchy and its associated NV storage.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_hierarchycontrol</strong> [<em>OPTIONS</em>] <em>VARIABLE</em> <em>OPERATION</em><h1 id="description">DESCRIPTION</h1><p><strong>tpm2_hierarchycontrol</strong>(1) - Allows user change phEnable, phEnableNV, shEnable and ehEnable when the proper authorization is provided. Authorization should be one out of owner hierarchy auth, endorsement hierarchy auth and platform hierarchy auth. <strong>As an argument the tool takes the <em>VARIABLE</em> as <em>TPMA_STARTUP_CLEAR</em> bit and _OPERATION_ as string clear|set to clear or set the <em>VARIABLE</em> bit.</strong><p>Note: If password option is missing, assume NULL.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the handle used to authorize. Defaults to the &quot;platform&quot; hierarchy. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a raw number can be used.</ul><li><p><strong>-P</strong>, <strong>--hierarchy-auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="set-phenablenv-with-platform-hierarchy-and-its-authorization">Set phEnableNV with platform hierarchy and its authorization</h2><pre><code class="language-bash">tpm2_hierarchycontrol -C p phEnableNV set -P pass
</code></pre><h2 id="clear-phenablenv-with-platform-hierarchy">clear phEnableNV with platform hierarchy</h2><pre><code class="language-bash">tpm2_hierarchycontrol -C p phEnableNV clear
</code></pre><h2 id="set-shenable-with-platform-hierarchy">Set shEnable with platform hierarchy</h2><pre><code class="language-bash">tpm2_hierarchycontrol -C p shEnable set
</code></pre><h2 id="set-shenable-with-owner-hierarchy">Set shEnable with owner hierarchy</h2><pre><code class="language-bash">tpm2_hierarchycontrol -C o shEnable set
</code></pre><h2 id="check-current-tpma_startup_clear-bits">Check current TPMA_STARTUP_CLEAR Bits</h2><pre><code class="language-bash">tpm2_getcap properties-variable
</code></pre></template><template id="hmac"><h1 id="name">NAME</h1><p><strong>tpm2_hmac</strong>(1) - Performs an HMAC operation with the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_hmac</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_hmac</strong>(1) - Performs an HMAC operation and returns the results. If argument file is not specified, then data is read from stdin.<p>The hashing algorithm defaults to the keys scheme or sha256 if the key has a NULL scheme.<p>Output defaults to <em>STDOUT</em> and binary format unless otherwise specified via <strong>-o</strong> and <strong>--hex</strong> options respectively.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>The context object of the symmetric signing key providing the HMAC key. Either a file or a handle number. See section &quot;Context Object Format&quot;.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Optional authorization value to use the key specified by <strong>-c</strong>.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm to use. Algorithms should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;. Also, see section &quot;Supported Hash Algorithms&quot; for a list of supported hash algorithms.<li><p><strong>--hex</strong><p>Convert the output hmac to hex format without a leading &quot;0x&quot;.<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em>:<p>Optional file record of the HMAC result. Defaults to <em>STDOUT</em>.<li><p><strong>-t</strong>, <strong>--ticket</strong>=<em>FILE</em>:<p>Optional file record of the ticket result.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the file path for the data to HMAC. Defaults to <em>STDIN</em> if not specified.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">authorization formatting</a> details the methods for specifying <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="setup">Setup</h2><pre><code class="language-bash"># create a primary object
tpm2_createprimary -c primary.ctx

# create an hmac key
tpm2_create -C primary.ctx -G hmac -c hmac.key
</code></pre><h3 id="perform-an-hmac-with-default-hash-algorithm">Perform an HMAC with Default Hash Algorithm</h3><p>Perform an hmac using the key&#39;s default scheme (hash algorithm) and output to stdout in hexidecimal format.<pre><code class="language-bash">tpm2_hmac -c hmac.key --hex data.in
e6eda48a53a9ddbb92f788f6d98e0372d63a408afb11aca43f522a2475a32805
</code></pre></template><template id="import"><h1 id="name">NAME</h1><p><strong>tpm2_import</strong>(1) - Imports an external key into the tpm as a TPM managed key object.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_import</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_import</strong>(1) - Imports an external generated key as TPM managed key object. It requires that the parent key object be a RSA key. Can also import a TPM managed key object created by the tpm2_duplicate tool.<h1 id="options">OPTIONS</h1><p>These options control the key importation process:<ul><li><p><strong>-G</strong>, <strong>--key-algorithm</strong>=<em>ALGORITHM</em>:<p>The algorithm used by the key to be imported. Supports:<ul><li><strong>aes</strong> - AES 128, 192 or 256 key.<li><strong>rsa</strong> - RSA 1024 or 2048 key.<li><strong>ecc</strong> - ECC NIST P192, P224, P256, P384 or P521 public and private key.</ul><li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm for generating the objects name. This is optional and defaults to <strong>sha256</strong> when not specified. Algorithms should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;. Also, see section &quot;Supported Hash Algorithms&quot; for a list of supported hash algorithms.<li><p><strong>-i</strong>, <strong>--input</strong>=<em>FILE</em>:<p>Specifies the filename of the key to be imported. For AES keys, this file is the raw key bytes. For assymetric keys in PEM or DER format. A typical file is generated with <code>openssl genrsa</code>.<li><p><strong>-C</strong>, <strong>--parent-context</strong>=<em>OBJECT</em>:<p>The parent key object.<li><p><strong>-U</strong>, <strong>--parent-public</strong>=<em>FILE</em>:<p>Optional. Specifies the parent key public data file input. This can be read with <strong>tpm2_readpublic</strong>(1) tool. If not specified, the tool invokes a tpm2_readpublic on the parent object.<li><p><strong>-k</strong>, <strong>--encryption-key</strong>=<em>FILE</em>:<p>Optional. Specifies the file containing the symmetric algorithm key that was used for the inner wrapper. If the file is specified the tool assumes the algorithm is AES 128 in CFB mode otherwise none.<li><p><strong>-r</strong>, <strong>--private</strong>=<em>FILE</em>:<p>Specifies the file path required to save the encrypted private portion of the object imported as key.<p>When importing a duplicated object this option specifies the file containing the private portion of the object to be imported. <a href="common/protection-details.md">protection details</a><li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>Specifies the file path required to save the public portion of the object imported as key<p>When importing a duplicated object this option specifies the file containing the public portion of the object to be imported.<li><p><strong>-a</strong>, <strong>--attributes</strong>=<em>ATTRIBUTES</em>:<p>The object attributes, optional.<li><p><strong>-P</strong>, <strong>--parent-auth</strong>=<em>AUTH</em>:<p>The authorization value for using the parent key specified with <strong>-C</strong>.<li><p><strong>-p</strong>, <strong>--key-auth</strong>=<em>AUTH</em>:<p>The authorization value for the imported key, optional.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>POLICY_FILE</em>:<p>The policy file.<li><p><strong>-s</strong>, <strong>--seed</strong>=<em>FILE</em>:<p>Specifies the file containing the encrypted seed of the duplicated object.<li><p><strong>--passin</strong>=<em>OSSL_PEM_FILE_PASSWORD</em><p>An optional password for an Open SSL (OSSL) provided input file. It mirrors the -passin option of OSSL and is known to support the pass, file, env, fd and plain password formats of openssl. (see <em>man(1) openssl</em>) for more.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="common/obj-attrs.md">object attribute specifiers</a> details the options for specifying the object attributes <em>ATTRIBUTES</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="to-import-a-key-one-needs-to-have-a-parent-key">To import a key, one needs to have a parent key</h2><pre><code class="language-bash">tpm2_createprimary -Grsa2048:aes128cfb -C o -c parent.ctx
</code></pre><p>Create your key and and import it. If you already have a key, just use that and skip creating it.<h2 id="import-an-aes-128-key">Import an AES 128 key</h2><pre><code class="language-bash">dd if=/dev/urandom of=sym.key bs=1 count=16

tpm2_import -C parent.ctx -i sym.key -u key.pub -r key.priv
</code></pre><h2 id="import-an-rsa-key">Import an RSA key</h2><pre><code class="language-bash">openssl genrsa -out private.pem 2048

tpm2_import -C parent.ctx -G rsa -i private.pem -u key.pub -r key.priv
</code></pre><h2 id="import-an-ecc-key">Import an ECC key</h2><pre><code class="language-bash">openssl ecparam -name prime256v1 -genkey -noout -out private.ecc.pem

tpm2_import -C parent.ctx -G ecc -i private.ecc.pem -u key.pub -r key.priv
</code></pre><h2 id="import-a-duplicated-key">Import a duplicated key</h2><pre><code class="language-bash">tpm2_import -C parent.ctx -i key.dup -u key.pub -r key.priv -L policy.dat
</code></pre><h1 id="limitations">LIMITATIONS</h1><ul><li>The TPM requires that the name algorithm of the child be smaller than the parent.</ul></template><template id="incrementalselftest"><h1 id="name">NAME</h1><p><strong>tpm2_incrementalselftest</strong>(1) - Request testing of specified algorithm list<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_incrementalselftest</strong> [<em>OPTIONS</em>] <em>ALG_SPEC_LIST</em><h1 id="description">DESCRIPTION</h1><p><strong>tpm2_incrementalselftest</strong>(1) Request the TPM to perform testing on specified algorithm and print a list of algorithm scheduled to be tested <em>OR</em> remain to be tested but not scheduled.<p>The main interest of this command is to reduce delays that might occur on cryptographic operations as TPM must test the algorithm prior using it.<h1 id="alg_spec_list">ALG_SPEC_LIST</h1><p>A space-separated list of algorithm suite to be tested. Algorithms should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;. Also, see section &quot;Supported Hash Algorithms&quot; for a list of supported hash algorithms.<p>If <em>ALG_SPEC_LIST</em> is left empty, <strong>tpm2_incrementalselftest</strong>(1) will return the list of algorithms left to be tested. Please note that in this case these algorithms are <strong>NOT</strong> scheduled to be tested.<p>If <em>ALG_SPEC_LIST</em> is not empty, <strong>tpm2_incrementalselftest</strong>(1) will return the list of algorithms that remains to be tested. This list contains algorithms scheduled for testing AND algorithms that remains to be tested and not yet scheduled. This can occur for instance if all AES mode have not been already tested yet.<h1 id="output">Output</h1><p>List of algorithms to be tested (implying scheduled) or remain to be tested (not scheduled) is also printed in YAML format.<p>If none of the specified algorithm is printed, that means both that they are already tested AND that these algorithms won&#39;t be tested again.<h1 id="options">OPTIONS</h1><p>This tool accepts no tool specific options.<h2 id="references">References</h2><p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="request-testing-of-rsa-algorithm">Request testing of RSA algorithm</h2><pre><code class="language-bash">tpm2_incrementalselftest rsa
</code></pre><h2 id="request-testing-of-multiple-algorithms">Request testing of multiple algorithms</h2><pre><code class="language-bash">tpm2_incrementalselftest rsa ecc xor aes cbc
</code></pre><h1 id="notes">NOTES</h1><p>Algorithm suite specified can imply either testing the combination or the complete suite, depending on TPM manufacturer implementation.<p>e.g : One TPM might only test AES with CTR mode if &quot;aes ctr&quot; is specified. An other might also test complete AES mode list AND test ctr mode.<p>If an algorithm has already been tested, this command won&#39;t permit re-executing the test. Only issuing <strong>tpm2_selftest</strong>(1) in full-test mode enabled will force re-testing.</template><template id="load"><h1 id="name">NAME</h1><p><strong>tpm2_load</strong>(1) - Load an object into the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_load</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_load</strong>(1) - Load both the private and public portions of an object into the TPM.<p>The tool outputs the name of the loaded object in a YAML dictionary format with the key <em>name</em> where the value for that key is the name of the object in hex format, for example:<pre><code class="language-yaml">name: 000bac25cb8743111c8e1f52f2ee7279d05d3902a18dd1af694db5d1afa7adf1c8b3
</code></pre><p>It also saves a context file for future interactions with the object.<p><strong>NOTE</strong>: Both private and public portions of the tpm key must be specified.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--parent-context</strong>=<em>OBJECT</em>:<p>The parent object.<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>The authorization value of the parent object specified by <strong>-C</strong>.<li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>A file containing the public portion of the object.<li><p><strong>-r</strong>, <strong>--private</strong>=<em>FILE</em>:<p>A file containing the sensitive portion of the object.<li><p><strong>-n</strong>, <strong>--name</strong>=<em>FILE</em>:<p>An optional file to save the name structure of the object.<li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>FILE</em>:<p>The file name of the saved object context, required.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="setup">Setup</h2><p>To load an object you first must create an object under a primary object. So the first step is to create the primary object.<pre><code class="language-bash">tpm2_createprimary -c primary.ctx
</code></pre><p>Step 2 is to create an object under the primary object.<pre><code class="language-bash">tpm2_create -C primary.ctx -u key.pub -r key.priv
</code></pre><p>This creates the private and public portions of the TPM object. With these object portions, it is now possible to load that object into the TPM for subsequent use.<h2 id="loading-an-object-into-the-tpm">Loading an Object into the TPM</h2><p>The final step, is loading the public and private portions of the object into the TPM.<pre><code class="language-bash">tpm2_load  -C primary.ctx -u key.pub -r key.priv -c key.ctx
name: 000bac25cb8743111c8e1f52f2ee7279d05d3902a18dd1af694db5d1afa7adf1c8b3
</code></pre></template><template id="loadexternal"><h1 id="name">NAME</h1><p><strong>tpm2_loadexternal</strong>(1) - Load an external object into the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_loadexternal</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_loadexternal</strong>(1) - This command loads an external object into the TPM, forgoing TPM protections. Ie, the key material is not protected by the parent object&#39;s seed. The command allows loading of just the public portion of an object or both the public and private portions of an object.<p>The tool outputs the name of the loaded object in a YAML dictionary format with the key <em>name</em> where the value for that key is the name of the object in hex format, for example:<pre><code class="language-yaml">name: 000bac25cb8743111c8e1f52f2ee7279d05d3902a18dd1af694db5d1afa7adf1c8b3
</code></pre><p>It also saves a context file for future interactions with the object.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Hierarchy to use for the ticket, optional. Defaults to <strong>n</strong>, <strong>null</strong>. Supported options are:<ul><li><strong>o</strong> for the <strong>owner</strong> hierarchy.<li><strong>p</strong> for the <strong>platform</strong> hierarchy.<li><strong>e</strong> for the <strong>endorsement</strong> hierarchy.<li><strong>n</strong> for the <strong>null</strong> hierarchy.</ul><li><p><strong>-G</strong>, <strong>--key-algorithm</strong>=<em>ALGORITHM</em>:<p>The algorithm used by the key to be imported. Supports:<ul><li><strong>aes</strong> - AES 128,192 or 256 key.<li><strong>rsa</strong> - RSA 1024 or 2048 key.<li><strong>ecc</strong> - ECC NIST P192, P224, P256, P384 or P521 public and private key.</ul><li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>The public portion of the object, this can be one of the following file formats:<ul><li>TSS - The TSS/TPM format. For example from option <code>-u</code> of command <strong>tpm2_create</strong>(1).<li>RSA - OSSL PEM formats. For example <code>public.pem</code> from the command <code>openssl rsa -in private.pem -out public.pem -pubout</code><li>ECC - OSSL PEM formats. For example <code>public.pem</code> from the command <code>openssl ec -in private.ecc.pem -out public.ecc.pem -pubout</code></ul><li><p><strong>-r</strong>, <strong>--private</strong>=<em>FILE</em>:<p>The sensitive portion of the object, optional. If one wishes to use the private portion of a key, this must be specified. Like option <strong>-u</strong>, this command takes files in the following format:<ul><li>RSA - OSSL PEM formats. For example <code>private.pem</code> from the command <code>openssl genrsa -out private.pem 2048</code> Since an RSA public key can be derived from the private PEM file, their is no need to specify -u for the public portion.</ul><p><em>Note</em>: The private portion does not respect TSS formats as it&#39;s impossible to get a <strong>TPM2B_SENSITIVE</strong> output from a previous command. They are always protected by the TPM as <strong>TPM2B_PRIVATE</strong> blobs.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>The authorization value for the key, optional.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>POLICY_FILE</em>:<p>The input policy file, optional. A file containing the hash of a policy derived from <code>tpm2_createpolicy</code>.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm for generating the objects name. This is optional and defaults to sha256 when not specified. However, load external supports having a <em>null</em> name algorithm. In this case, no cryptographic binding checks between the public and private portions are performed.<li><p><strong>-a</strong>, <strong>--attributes</strong>=<em>ATTRIBUTES</em>:<p>The object attributes, optional. The default for created objects is: <code>TPMA_OBJECT_SIGN_ENCRYPT|TPMA_OBJECT_DECRYPT</code>. Optionally, if -p is specified or no <code>-p</code> or <code>-L</code> is specified then <code>TPMA_OBJECT_USERWITHAUTH</code> is added to the default attribute set.<p><em>Note</em>: If specifying attributes, the TPM will reject certain attributes like <strong>TPMA_OBJECT_FIXEDTPM</strong>, as those guarantees cannot be made.<li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>FILE</em><p>The file name to save the object context, required.<li><p><strong>-n</strong>, <strong>--name</strong>=<em>FILE</em>:<p>An optional file to save the object name, which is in a binary hash format. The size of the hash is based on name algorithm or the <strong>-g</strong> option.<li><p><strong>--passin</strong>=<em>OSSL_PEM_FILE_PASSWORD</em><p>An optional password for an Open SSL (OSSL) provided input file. It mirrors the -passin option of OSSL and is known to support the pass, file, env, fd and plain password formats of openssl. (see <em>man(1) openssl</em>) for more.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="common/obj-attrs.md">object attribute specifiers</a> details the options for specifying the object attributes <em>ATTRIBUTES</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="notes">NOTES</h1><ul><li><p>If the hierarchy is <em>null</em> or the name hashing algorithm is <em>null</em>, tickets produced using the object will be NULL.<li><p>If the private portion of an object is specified, the hierarchy must be <em>null</em> or the TPM will reject loading it.</ul><h1 id="examples">EXAMPLES</h1><h2 id="load-a-tpm-generated-public-key-into-the-owner-hierarchy">Load a TPM generated public key into the <em>owner</em> hierarchy</h2><pre><code class="language-bash">tpm2_createprimary -c primary.ctx

tpm2_create -C primary.ctx -u pub.dat -r priv.dat

tpm2_loadexternal -C o -u pub.dat -c pub.ctx
name: 000b9be4d7c6193a57e1bfc86a42a6b03856a91d2f9e77c6cbdb796a783d52d4b3b9
</code></pre><h2 id="load-an-rsa-public-key-into-the-owner-hierarchy">Load an RSA public key into the <em>owner</em> hierarchy</h2><pre><code class="language-bash">openssl genrsa -out private.pem 2048

openssl rsa -in private.pem -out public.pem -outform PEM -pubout

tpm2_loadexternal -C o -Grsa -u public.pem -c key.ctx
name: 000b7b91d304d16995d42792b57d0fb25df7abe5fdd8afe9950730e00dc5b934ddbc
</code></pre><h2 id="load-an-rsa-key-pair-into-the-null-hierarchy">Load an RSA key-pair into the <em>null</em> hierarchy</h2><pre><code class="language-bash">openssl genrsa -out private.pem 2048

tpm2_loadexternal -C n -Grsa -r private.pem -c key.ctx
name: 000b635ea220b6c62ec1d02343859dd203c8ac5dad82ebc5b124e407d2502f88691f
</code></pre><h2 id="load-an-aes-key-into-the-null-hierarchy">Load an AES key into the <em>null</em> hierarchy</h2><pre><code class="language-bash">dd if=/dev/urandom of=sym.key bs=1 count=16

tpm2_loadexternal -C n -Gaes -r sym.key -c key.ctx
name: 000bfc4d8dd7e4f921bcc9dca4b04f49564243cd9def129a3740002bfd4b9e966d34
</code></pre></template><template id="makecredential"><h1 id="name">NAME</h1><p><strong>tpm2_makecredential</strong>(1) - Generate the encrypted-user-chosen-data and the wrapped-secret-data-encryption-key for the privacy-sensitive credentialing process of a TPM object.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_makecredential</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_makecredential</strong>(1) - The TPM supports a privacy preserving protocol for distributing credentials for keys on a TPM. The process guarantees that the credentialed-TPM-object(AIK) is loaded on the same TPM as a well-known public-key-object(EK) without knowledge of the specific public properties of the credentialed-TPM-object(AIK). The privacy is guaranteed due to the fact that only the name of the credentialed-TPM-object(AIK) is shared and not the credentialed-TPM-object&#39;s public key itself.<p>Make-credential is the first step in this process where in after receiving the public-key-object(EK) public key of the TPM and the name of the credentialed-TPM-object(AIK), an encrypted-user-chosen-data is generated and the secret-data-encryption-key is generated and wrapped using cryptographic processes specific to credential activation that guarantees that the credentialed-TPM-object(AIK) is loaded on the TPM with the well-known public-key-object(EK).<p><strong>tpm2_makecredential</strong> can be used to generate the encrypted-user-chosen-data and the wrapped secret-data-encryption-key without a TPM by using the <strong>none</strong> TCTI option.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-e</strong>, <strong>--encryption-key</strong>=<em>FILE</em>:<p><strong>DEPRECATED</strong>, use <strong>-u</strong> or <strong>--public</strong> instead.<li><p><strong>-u</strong>, <strong>--public</strong>=<em>FILE</em>:<p>A TPM public key which was used to wrap the seed. NOTE: This option is same as <strong>-e</strong> and is added to make it similar with other tools specifying the public key. The old option is retained for backwards compatibility.<li><p><strong>-G</strong>, <strong>--key-algorithm</strong>=<em>ALGORITHM</em>:<p>The key algorithm associated with TPM public key. Specify either RSA/ ECC. When this option is used, input public key is expected to be in PEM format and the default TCG EK template is used for the key properties.<li><p><strong>-s</strong>, <strong>--secret</strong>=<em>FILE</em> or <em>STDIN</em>:<p>The secret which will be protected by the key derived from the random seed. It can be specified as a file or passed from stdin.<li><p><strong>-n</strong>, <strong>--name</strong>=<em>FILE</em>:<p>The name of the key for which certificate is to be created.<li><p><strong>-o</strong>, <strong>--credential-blob</strong>=<em>FILE</em>:<p>The output file path, recording the encrypted-user-chosen-data and the wrapped secret-data-encryption-key.</ul><p><a href="./common/options.html">common options</a><p><a href="./common/tcti.html">common tcti options</a><h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2 createek -Q -c 0x81010009 -G rsa -u ek.pub

tpm2 createak -C 0x81010009 -c ak.ctx -G rsa -g sha256 -s rsassa -u ak.pub \
-n ak.name -p akpass&gt; ak.out

file_size=`ls -l ak.name | awk {&#39;print $5&#39;}`
loaded_key_name=`cat ak.name | xxd -p -c $file_size`

tpm2 readpublic -c 0x81010009 -o ek.pem -f pem -Q

echo &quot;12345678&quot; | tpm2 makecredential -Q -u ek.pem -s - -n $loaded_key_name \
-o mkcred.out -G rsa
</code></pre></template><template id="nvcertify"><h1 id="name">NAME</h1><p><strong>tpm2_nvcertify</strong>(1) - Provides attestation of the contents of an NV index.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvcertify</strong> [<em>OPTIONS</em>] [<em>ARGUMENTS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvcertify</strong>(1) - Provides attestation of the contents of an NV index. NOTE: As part of the attestation output, the NV index contents are revealed.<h1 id="options">OPTIONS</h1><p>These options control the certification:<ul><li><p><strong>-C</strong>, <strong>--signingkey-context</strong>=<em>OBJECT</em>:<p>The key object that signs the attestation structure.<li><p><strong>-P</strong>, <strong>--signingkey-auth</strong>=<em>AUTH</em>:<p>The authorization value provided for the object specified with -C.<li><p><strong>-c</strong>, <strong>--nvauthobj-context</strong>=<em>OBJECT</em>:<p>The object that is the authorization handle for the NV object. It is either the NV index handle itself or the platform/ owner hierarchy handle. If not specified it defaults to the NV index handle.<li><p><strong>-p</strong>, <strong>--nvauthobj-auth</strong>=<em>AUTH</em>:<p>The authorization value provided for the object specified with -c.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm to use in signature generation.<li><p><strong>-s</strong>, <strong>--scheme</strong>=<em>ALGORITHM</em>:<p>The signing scheme used to sign the attestation data.<li><p><strong>-f</strong>, <strong>--format</strong>=<em>FORMAT</em>:<p>Format selection for the signature output file.<li><p><strong>-o</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>Output file name for the signature data.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>FILE_OR_HEX_STR</em>:<p>Optional, the policy qualifier data that the signer can choose to include in the signature. Can be either a hex string or path.<li><p><strong>--size</strong>=<em>NATURAL_NUMBER</em>:<p>Specifies the size of data to be read in bytes, starting from 0 if offset is not specified. If not specified, the size of the data as reported by the public portion of the index will be used.<li><p><strong>--offset</strong>=<em>NATURAL_NUMBER</em>:<p>The offset within the NV index to start reading from.<li><p><strong>--attestation</strong>=<em>FILE</em>:<p>The attestation data of the type TPM2_CREATION_INFO signed with signing key.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the NV index or offset number.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/signature.html">signature format specifiers</a> option used to configure signature <em>FORMAT</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_nvdefine -s 32 -a &quot;authread|authwrite&quot; 1

dd if=/dev/urandom bs=1 count=32 status=none| \
tpm2_nvwrite 1 -i-

tpm2_createprimary -C o -c primary.ctx -Q

tpm2_create -G rsa -u rsa.pub -r rsa.priv -C primary.ctx -c signing_key.ctx -Q

tpm2_readpublic -c signing_key.ctx -f pem -o sslpub.pem -Q

tpm2_nvcertify -C signing_key.ctx -g sha256 -f plain -s rsassa \
-o signature.bin --attestation attestation.bin --size 32 1
</code></pre></template><template id="nvdefine"><h1 id="name">NAME</h1><p><strong>tpm2_nvdefine</strong>(1) - Define a TPM Non-Volatile (NV) index.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvdefine</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvdefine</strong>(1) - Define an NV index with given auth value. The index is specified as an argument. It can be specified as raw handle or an offset value to the nv handle range &quot;TPM2_HR_NV_INDEX&quot;. If an index isn&#39;t specified, the tool uses the first free index. The tool outputs the nv index defined on success.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the handle used to authorize. Defaults to <strong>o</strong>, <strong>TPM_RH_OWNER</strong>, when no value has been specified. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle or nv-index may be used.</ul><li><p><strong>-s</strong>, <strong>--size</strong>=<em>NATURAL_NUMBER</em>:<p>Specifies the size of data area in bytes. Defaults to <strong>MAX_NV_INDEX_SIZE</strong> which is typically 2048.<li><p><strong>-a</strong>, <strong>--attributes</strong>=<em>ATTRIBUTES</em><p>Specifies the attribute values for the nv region used when creating the entity. Either the raw bitfield mask or &quot;nice-names&quot; may be used. See section &quot;NV Attributes&quot; for more details. If not specified, the attributes default to various selections based on the hierarchy the index is defined in.<p>For the owner hiearchy the defaults are:<ul><li>TPMA_NV_OWNERWRITE<li>TPMA_NV_OWNERREAD</ul><p>For the platform hiearchy, the defaults are:<ul><li>TPMA_NV_PPWRITE<li>TPMA_NV_PPREAD</ul><p>If a policy file is specified, the hiearchy chosen default attributes are bitwise or&#39;d with:<ul><li>TPMA_NV_POLICYWRITE<li>TPMA_NV_POLICYREAD</ul><p>If a policy file is <strong>NOT</strong> specified, the hiearchy chosen default attributes are bitwise or&#39;d with:<ul><li>TPMA_NV_AUTHWRITE<li>TPMA_NV_AUTHREAD</ul><li><p><strong>-P</strong>, <strong>--hierarchy-auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy. Authorization values should follow the &quot;authorization formatting standards&quot;, see section &quot;Authorization Formatting&quot;.<li><p><strong>-p</strong>, <strong>--index-auth</strong>=<em>AUTH</em>:<p>Specifies the password of NV Index when created. HMAC and Password authorization values should follow the &quot;authorization formatting standards&quot;, see section &quot;Authorization Formatting&quot;.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>Specifies the policy digest file for policy based authorizations.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The session created using <strong>tpm2_startauthsession</strong>. Multiple of these can be specified. For example, you can have one session for auditing and another for encryption/decryption of the parameters.<li><p><strong>ARGUMENT</strong> the command line argument specifies the NV index or offset number.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="common/nv-attrs.md">object attribute specifiers</a> details the options for specifying the nv attributes <em>ATTRIBUTES</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_nvdefine   0x1500016 -C o -s 32 -a 0x2000A

tpm2_nvdefine   0x1500016 -C o -s 32 -a ownerread|ownerwrite|policywrite -p 1a1b
</code></pre></template><template id="nvextend"><h1 id="name">NAME</h1><p><strong>tpm2_nvextend</strong>(1) - Extend an Non-Volatile (NV) index like it was a PCR.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvextend</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvextend</strong>(1) - Extend an Non-Volatile (NV) index like it was a PCR. The NV index must be of type &quot;extend&quot; which is specified via the &quot;nt&quot; field when creating the NV space with tpm2_nvdefine(1). The index can be specified as raw handle or an offset value to the NV handle range &quot;TPM2_HR_NV_INDEX&quot; as an argument.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy used to authorize. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle or nv-index may be used.</ul><p>When <strong>-C</strong> isn&#39;t explicitly passed the index handle will be used to authorize against the index. The index auth value is set via the <strong>-p</strong> option to <strong>tpm2_nvdefine</strong>(1).<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>-i</strong>, <strong>--input</strong>=<em>FILE</em>:<p>Specifies the input file with data to extend to the NV index.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The session created using <strong>tpm2_startauthsession</strong>. Multiple of these can be specified. For example, you can have one session for auditing and another for encryption/decryption of the parameters.<li><p><strong>ARGUMENT</strong> the command line argument specifies the NV index or offset number.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="or-0xbadc0de-into-an-index-of-0s">OR 0xbadc0de into an index of 0&#39;s</h2><pre><code class="language-bash">tpm2_nvdefine -C o -a &quot;nt=extend|ownerread|policywrite|ownerwrite|writedefine&quot; 1

echo &#39;my data&#39; | tpm2_nvextend -C o -i- 1

tpm2_nvread -C o 1 | xxd -p -c32
db7472e3fe3309b011ec11565bce4ea6668cc8ecdef7e6fdcda5206687af3f43
</code></pre></template><template id="nvincrement"><h1 id="name">NAME</h1><p><strong>tpm2_nvincrement</strong>(1) - Increment counter in a Non-Volatile (NV) index.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvincrement</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvincrement</strong>(1) - Increment value of a Non-Volatile (NV) index setup as a counter. The index can be specified as raw handle or an offset value to the nv handle range &quot;TPM2_HR_NV_INDEX&quot;.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy used to authorize. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle or nv-index may be used.</ul><p>When <strong>-C</strong> isn&#39;t explicitly passed the index handle will be used to authorize against the index. The index auth value is set via the <strong>-p</strong> option to <strong>tpm2_nvdefine</strong>(1).<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the NV index or offset number.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="to-increment-the-counter-at-index-0x150016">To increment the counter at index <em>0x150016</em></h2><pre><code class="language-bash">tpm2_nvdefine -C o -s 8 -a &quot;ownerread|authread|authwrite|nt=1&quot; 0x1500016 -p index

tpm2_nvincrement -C 0x1500016  0x1500016 -P &quot;index&quot;

tpm2_nvread 0x1500016 -P index | xxd -p
</code></pre></template><template id="nvread"><h1 id="name">NAME</h1><p><strong>tpm2_nvread</strong>(1) - Read the data stored in a Non-Volatile (NV)s index.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvread</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvread</strong>(1) - Read the data stored in a Non-Volatile (NV)s index. The index can be specified as raw handle or an offset value to the nv handle range &quot;TPM2_HR_NV_INDEX&quot;.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy used to authorize. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle or nv-index may be used.</ul><p>When <strong>-C</strong> isn&#39;t explicitly passed the index handle will be used to authorize against the index. The index auth value is set via the <strong>-p</strong> option to <strong>tpm2_nvdefine</strong>(1).<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em>:<p>File to write data<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>-s</strong>, <strong>--size</strong>=<em>NATURAL_NUMBER</em>:<p>Specifies the size of data to be read in bytes, starting from 0 if offset is not specified. If not specified, the size of the data as reported by the public portion of the index will be used.<li><p><strong>--offset</strong>=<em>NATURAL_NUMBER</em>:<p>The offset within the NV index to start reading from.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the NV index or offset number.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.d)<h1 id="examples">EXAMPLES</h1><h2 id="read-32-bytes-from-an-index-starting-at-offset-0">Read 32 bytes from an index starting at offset 0</h2><pre><code class="language-bash">tpm2_nvdefine -C o -s 32 -a &quot;ownerread|policywrite|ownerwrite&quot; 1

echo &quot;please123abc&quot; &gt; nv.dat

tpm2_nvwrite -C o -i nv.dat 1

tpm2_nvread -C o -s 32 1
</code></pre></template><template id="nvreadlock"><h1 id="name">NAME</h1><p><strong>tpm2_nvreadlock</strong>(1) - Lock the Non-Volatile (NV) index for further reads.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvreadlock</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvreadlock</strong>(1) - Lock the Non-Volatile (NV) index for further reads. The lock on the NN index is unlocked when the TPM is restarted and the NV index becomes readable again. The index can be specified as raw handle or an offset value to the nv handle range &quot;TPM2_HR_NV_INDEX&quot;.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy used to authorize. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle or nv-index may be used.</ul><p>When <strong>-C</strong> isn&#39;t explicitly passed the index handle will be used to authorize against the index. The index auth value is set via the <strong>-p</strong> option to <strong>tpm2_nvdefine</strong>(1).<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the NV index or offset number.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="lock-an-index">Lock an index</h2><pre><code class="language-bash">tpm2_nvdefine -Q   1 -C o -s 32 \
-a &quot;ownerread|policywrite|ownerwrite|read_stclear&quot;

echo &quot;foobar&quot; &gt; nv.readlock

tpm2_nvwrite -Q   0x01000001 -C o -i nv.readlock

tpm2_nvread -Q   1 -C o -s 6 -o 0

tpm2_nvreadlock -Q   1 -C o
</code></pre></template><template id="nvreadpublic"><h1 id="name">NAME</h1><p><strong>tpm2_nvreadpublic</strong>(1) - Display all defined Non-Volatile (NV)s indices.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvreadpublic</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvreadpublic</strong>(1) - Display all defined Non-Volatile (NV)s indices to stdout in a YAML format.<p>Display metadata for all defined NV indices. Metadata includes:<ul><li>The size of the defined region.<li>The hash algorithm used to compute the name of the index.<li>The auth policy.<li>The NV attributes as defined in section &quot;NV Attributes&quot;.</ul><h2 id="example-output">Example Output</h2><pre><code>0x1500015:
  hash algorithm:
    friendly: sha256
    value: 0xB
  attributes:
    friendly: ownerwrite|ownerread
    value: 0x2000200
  size: 32
  authorization policy:

0x1500017:
  hash algorithm:
    friendly: sha256
    value: 0xB
  attributes:
    friendly: ownerwrite|ownerread
    value: 0x2000200
  size: 32
  authorization policy:
</code></pre><h1 id="options">OPTIONS</h1><p>This tool takes no tool specific options.<p><a href="./common/options.html">common options</a><p><a href="./common/tcti.html">common tcti options</a><p><a href="common/nv-attrs.md">nv attributes</a><h1 id="examples">EXAMPLES</h1><h2 id="list-the-defined-nv-indices-to-stdout">List the defined NV indices to stdout</h2><pre><code class="language-bash">tpm2_nvreadpublic
</code></pre></template><template id="nvsetbits"><h1 id="name">NAME</h1><p><strong>tpm2_nvsetbits</strong>(1) - Bitwise OR bits into a Non-Volatile (NV).<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvsetbits</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvsetbits</strong>(1) - Bitwise OR bits into a Non-Volatile (NV). The NV index must be of type &quot;bits&quot; which is specified via the &quot;nt&quot; field when creating the NV space with tpm2_nvdefine(1). The index can be specified as raw handle or an offset value to the NV handle range &quot;TPM2_HR_NV_INDEX&quot;.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy used to authorize. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle or nv-index may be used.</ul><p>When <strong>-C</strong> isn&#39;t explicitly passed the index handle will be used to authorize against the index. The index auth value is set via the <strong>-p</strong> option to <strong>tpm2_nvdefine</strong>(1).<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>-i</strong>, <strong>--bits</strong>=<em>BITS</em>:<p>Specifies the bit value as a number to bitwise OR into the current value of the NV index.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the NV index or offset number.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="or-0xbadc0de-into-an-index-of-0s">OR 0xbadc0de into an index of 0&#39;s</h2><pre><code class="language-bash">tpm2_nvdefine -C o -a &quot;nt=bits|ownerread|policywrite|ownerwrite|writedefine&quot; 1

tpm2_nvsetbits -C o -i 0xbadc0de 1

tpm2_nvread -C o 1 | xxd -p | sed s/&#39;^0*&#39;/0x/
0xbadc0de
</code></pre></template><template id="nvundefine"><h1 id="name">NAME</h1><p><strong>tpm2_nvundefine</strong>(1) - Delete a Non-Volatile (NV) index.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvundefine</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvundefine</strong>(1) - Deletes a Non-Volatile (NV) index that was previously defined with <strong>tpm2_nvdefine</strong>(1). The index is specified as an argument. It can be specified as raw handle or an offset value to the nv handle range &quot;TPM2_HR_NV_INDEX&quot;.<p>The tool is also capable of deleting NV indices with attribute <code>TPMA_NV_POLICY_DELETE</code>, and the tool uses this attribute for the default hierarchy to select when <code>-C</code> is missing. The default value for <code>-C</code> is the &quot;owner&quot; hierarchy when <code>TPMA_NV_POLICY_DELETE</code> is clear and &quot;platform&quot; when <code>TPMA_NV_POLICY_DELETE</code> is set.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy used to authorize. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle may be specified.</ul><li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>POLICY_SESSION</em>:<p>Specify a policy session to use when the NV index has attribute <code>TPMA_NV_POLICY_DELETE</code> set.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the NV index or offset number.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="define-an-ordinary-nv-index-and-delete-it">Define an ordinary NV index and delete it</h2><pre><code class="language-bash">tpm2_nvdefine 1

tpm2_nvundefine 1
</code></pre><h2 id="define-an-ordinary-nv-index-with-attribute-tpma_nv_policy_delete-and-delete-it">Define an ordinary NV index with attribute <code>TPMA_NV_POLICY_DELETE</code> and delete it</h2><pre><code class="language-bash">tpm2_startauthsession -S s.ctx

tpm2_policyauthvalue -S s.ctx

tpm2_policycommandcode -S s.ctx -L policy.dat TPM2_CC_NV_UndefineSpaceSpecial

tpm2_nvdefine -C p -s 32 \
  -a &quot;ppread|ppwrite|authread|authwrite|platformcreate|policydelete|write_stclear|read_stclear&quot; \
  -L policy.dat 1

tpm2_flushcontext s.ctx

tpm2_startauthsession --policy-session -S s.ctx

tpm2_policyauthvalue -S s.ctx

tpm2_policycommandcode -S s.ctx TPM2_CC_NV_UndefineSpaceSpecial

tpm2_nvundefine -S s.ctx 1
</code></pre></template><template id="nvwrite"><h1 id="name">NAME</h1><p><strong>tpm2_nvwrite</strong>(1) - Write data to a Non-Volatile (NV) index.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvwrite</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvwrite</strong>(1) - Write data specified via <em>FILE</em> to a Non-Volatile (NV) index. If <em>FILE</em> is not specified, it defaults to stdin. The index is specified as an argument and can be a raw handle or an offset value to the nv handle range &quot;TPM2_HR_NV_INDEX&quot;.<h1 id="options">OPTIONS</h1><ul><li><p><strong>ARGUMENT</strong>=<em>NUMBER</em><p>Specify the NV index to write to as an offset to the starting NV index range or an absolute index value. Example: tpm2_nvwrite 1 is same as tpm2_nvwrite 0x01000001<li><p><strong>-i</strong>, <strong>--input</strong>=<em>FILE</em>:<p>Specifies the input file with data to write to NV.<li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy used to authorize. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle or nv-index may be used.</ul><p>When <strong>-C</strong> isn&#39;t explicitly passed the index handle will be used to authorize against the index. The index auth value is set via the <strong>-p</strong> option to <strong>tpm2_nvdefine</strong>(1).<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>--offset</strong>=<em>NATURAL_NUMBER</em>:<p>The offset within the NV index to start writing at.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="write-the-file-nvdata-to-index-0x01000001">Write the file nv.data to index <em>0x01000001</em></h2><pre><code class="language-bash">tpm2_nvdefine -Q   1 -C o -s 32 -a &quot;ownerread|policywrite|ownerwrite&quot;

echo &quot;please123abc&quot; &gt; nv.test_w

tpm2_nvwrite -Q   1 -C o -i nv.test_w
</code></pre></template><template id="nvwritelock"><h1 id="name">NAME</h1><p><strong>tpm2_nvwritelock</strong>(1) - Lock the Non-Volatile (NV) index for further writes.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_nvwritelock</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_nvwritelock</strong>(1) - Lock the Non-Volatile (NV) index for further writes. The lock on the NV index is unlocked when the TPM is restarted and the NV index becomes writable again. The index can be specified as raw handle or an offset value to the nv handle range &quot;TPM2_HR_NV_INDEX&quot;.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy used to authorize. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle or nv-index may be used.</ul><p>When <strong>-C</strong> isn&#39;t explicitly passed the index handle will be used to authorize against the index. The index auth value is set via the <strong>-p</strong> option to <strong>tpm2_nvdefine</strong>(1).<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>--global</strong>:<p>Lock all NV indices with attribute TPMA_NV_GLOBALLOCK. This option does not require an NV index or offset as an argument.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the NV index or offset number.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="lock-an-index">Lock an index</h2><pre><code class="language-bash">tpm2_nvdefine -C o -s 32 \
  -a &quot;ownerread|policywrite|ownerwrite|writedefine&quot; 1

echo &quot;foobar&quot; &gt; nv.writelock

tpm2_nvwrite -C o -i nv.writelock 1

tpm2_nvwritelock -C o 1

# fails with &quot;NV access locked&quot;
tpm2_nvwrite -C o -i nv.writelock 1
</code></pre><h2 id="global-lock">Global Lock</h2><pre><code class="language-bash">tpm2_nvdefine -C o -s 32 \
  -a &quot;ownerread|policywrite|ownerwrite|globallock&quot; 1

tpm2_nvwritelock -C o --global

# this command fails with &quot;NV access locked&quot;.
echo foo | tpm2_nvwrite -C o -i- 1
</code></pre></template><template id="pcrallocate"><h1 id="name">NAME</h1><p><strong>tpm2_pcrallocate</strong>(1) - Configure PCRs and bank algorithms.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_pcrallocate</strong> [<em>OPTIONS</em>] [*ARGUMENT]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_pcrallocate</strong>(1) - Allow the user to specify a PCR allocation for the TPM. An allocation is the enabling or disabling of PCRs and it&#39;s banks. A PCR can have multiple banks, where each bank is associated with a specific hashing algorithm. Allocation is specified in the argument.<p>If no allocation is given, then SHA1 and SHA256 banks with PCRs 0 - 23 are allocated.<p>Allocation is a list of banks and selected pcrs. The values should follow the pcr bank specifiers standards, see section &quot;PCR Bank Specifiers&quot;.<p>The new allocations become effective after the next reboot.<p><strong>Note</strong>: This command requires platform authorization.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Optional authorization value. Authorization values should follow the &quot;authorization formatting standards&quot;, see section &quot;Authorization Formatting&quot;.<li><p><strong>ARGUMENT</strong> the command line argument specifies the PCR allocation.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="common/obj-attrs.md">object attribute specifiers</a> details the options for specifying the object attributes <em>ATTRIBUTES</em>.<p><a href="./common/pcr.html">pcr bank specifiers</a> details the syntax for specifying pcr list.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="to-allocate-the-two-default-banks-sha1-and-sha256">To allocate the two default banks (SHA1 and SHA256)</h2><pre><code class="language-bash">tpm2_pcrallocate
</code></pre><h2 id="to-make-a-custom-allocation-with-a-platform-authorization">To make a custom allocation with a platform authorization</h2><pre><code class="language-bash">tpm2_pcrallocate -P abc sha1:7,8,9,10,16,17,18,19+sha256:all
</code></pre></template><template id="pcrevent"><h1 id="name">NAME</h1><p><strong>tpm2_pcrevent</strong>(1) - Hashes a file and optionally extends a pcr.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_pcrevent</strong> [<em>OPTIONS</em>] <em>FILE</em> <em>PCR_INDEX</em><h1 id="description">DESCRIPTION</h1><p><strong>tpm2_pcrevent</strong>(1) - Hashes <em>FILE</em> if specified or stdin. It uses all of the hashing algorithms that the TPM supports.<p>Optionally, if a PCR index is specified, it extends that PCR for all supported algorithms with the hash digest. <em>FILE</em> and _PCR_INDEX_ arguments don&#39;t need to come in any particular order.<p>In either case, it outputs to stdout the hash algorithm used and the digest value, one per line:<p><em>alg</em>:<em>digest</em><p>Where <em>alg</em> is the algorithm used (like sha1) and <em>digest</em> is the digest resulting from the hash computation of <em>alg</em> on the data.<p>See sections 23.1 and sections 17 of the <a href="https://trustedcomputinggroup.org/wp-content/uploads/TPM-Rev-2.0-Part-3-Commands-01.38.pdf">TPM2.0 Specification</a><h1 id="options">OPTIONS</h1><p>These options control extending the pcr:<ul><li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for PCR.</ul><p><a href="./common/options.html">common options</a><p><a href="./common/tcti.html">common tcti options</a><p><a href="./common/authorizations.html">authorization formatting</a><h1 id="examples">EXAMPLES</h1><h2 id="hash-a-file">Hash a file</h2><pre><code class="language-bash">echo &quot;foo&quot; &gt; data
tpm2_pcrevent data
</code></pre><h2 id="hash-a-file-and-extend-pcr-8">Hash a file and extend PCR 8</h2><pre><code class="language-bash">echo &quot;foo&quot; &gt; data
tpm2_pcrevent 8 data
</code></pre></template><template id="pcrextend"><h1 id="name">NAME</h1><p><strong>tpm2_pcrextend</strong>(1) - Extends a PCR.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_pcrextend</strong> [<em>OPTIONS</em>] <em>PCR_DIGEST_SPEC</em><h1 id="description">DESCRIPTION</h1><p><strong>tpm2_pcrextend</strong>(1) - Extends the pcrs with values indicated by <em>PCR_DIGEST_SPEC</em>.<p>A <em>PCR_DIGEST_SPEC</em> is defined as follows:<ul><li>A numerical PCR identifier.<li>A colon followed by the algorithm hash specification.</ul><p>The algorithm hash specification is as follows:<ul><li>The algorithm friendly name or raw numerical.<li>An equals sign.<li>The hex hash value.</ul><h3 id="example-digest-specification">Example Digest Specification</h3><pre><code>4:sha1=f1d2d2f924e986ac86fdf7b36c94bcdf32beec15
</code></pre><p><strong>Note</strong>: Multiple specifications of PCR and hash are allowed. Multiple hashes cause the PCR to be extended with both hashes. Multiple same PCR values cause the PCR to be extended multiple times. Extension is done in order from left to right as specified. At most 5 hash extensions per PCR entry are supported. This is to keep the parser simple.<h1 id="options">OPTIONS</h1><p>This tool accepts no tool specific options.<p><a href="./common/options.html">common options</a><p><a href="./common/tcti.html">common tcti options</a><p><a href="./common/pcr.html">PCR bank specifiers</a><h1 id="examples">EXAMPLES</h1><h2 id="extend-pcr-4s-sha1-bank-with-a-hash">Extend PCR 4&#39;s SHA1 bank with a hash</h2><pre><code class="language-bash">tpm2_pcrextend 4:sha1=f1d2d2f924e986ac86fdf7b36c94bcdf32beec15
</code></pre><h2 id="extend-pcr-4s-sha1-and-sha256-banks-with-hashes">Extend PCR 4&#39;s SHA1 and SHA256 banks with hashes</h2><pre><code class="language-bash">tpm2_pcrextend 4:sha1=f1d2d2f924e986ac86fdf7b36c94bcdf32beec15,sha256:b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c
</code></pre><h2 id="extend-pcr-4s-sha1-and-pcr-7s-sha256-bank-with-hashes">Extend PCR 4&#39;s SHA1 and PCR 7&#39;s SHA256 bank with hashes</h2><pre><code class="language-bash">tpm2_pcrextend 4:sha1=f1d2d2f924e986ac86fdf7b36c94bcdf32beec15 7:sha256:b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c
</code></pre></template><template id="pcrread"><h1 id="name">NAME</h1><p><strong>tpm2_pcrread</strong>(1) - List PCR values.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_pcrread</strong> [<em>OPTIONS</em>] <em>PCR_LIST_OR_ALG</em><h1 id="description">DESCRIPTION</h1><p><strong>tpm2_pcrread</strong>(1) - Displays PCR values. Without any arguments, <strong>tpm2_pcrread</strong>(1) outputs all PCRs and their hash banks. One can use specify the hash algorithm or a pcr list as an argument to filter the output.<p>To only output PCR banks with a given algorithm, specify the hashing algorithm as the argument. Algorithms should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;. Also, see section &quot;Supported Hash Algorithms&quot; for a list of supported hash algorithms.<p>To output a list of PCR banks (sha1, sha256, etc) and ids (0, 1, 2 etc) specify a PCR selection list as the argument as specified via section &quot;PCR Bank Specifiers&quot;.<p>Also read <strong>NOTES</strong> section below.<p>Output is written in a YAML format to stdout, with each algorithm followed by a PCR index and its value. As a simple example assume just sha1 and sha256 support and only 1 PCR. The output would be:<pre><code>$ tpm2_pcrread sha1:0+sha256:0
sha1 :
  0  : 0000000000000000000000000000000000000003
sha256 :
  0  : 0000000000000000000000000000000000000000000000000000000000000003
</code></pre><h1 id="options">OPTIONS</h1><ul><li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em>:<p>The output file to write the PCR values in binary format, optional.</ul><p><a href="./common/options.html">common options</a><p><a href="./common/tcti.html">common tcti options</a><p><a href="./common/pcr.html">PCR bank specifiers</a><p><a href="./common/hash.html">supported hash algorithms</a><p><a href="./common/alg.html">algorithm specifiers</a><h1 id="examples">EXAMPLES</h1><h2 id="display-all-pcr-values">Display all PCR values</h2><pre><code class="language-bash">tpm2_pcrread
</code></pre><h2 id="display-the-pcr-values-with-a-specified-bank">Display the PCR values with a specified bank</h2><pre><code class="language-bash">tpm2_pcrread sha1
</code></pre><h2 id="display-the-pcr-values-with-specified-banks-and-store-in-a-file">Display the PCR values with specified banks and store in a file</h2><pre><code class="language-bash">tpm2_pcrread -o pcrs sha1:16,17,18+sha256:16,17,18
</code></pre><h2 id="display-the-supported-pcr-bank-algorithms-and-exit">Display the supported PCR bank algorithms and exit</h2><pre><code class="language-bash">tpm2_pcrread
</code></pre><h1 id="notes">NOTES</h1><p>The maximum number of PCR that can be dumped at once is associated with the maximum length of a bank.<p>On most TPMs, it means that this tool can dump up to 24 PCRs at once.</template><template id="pcrreset"><h1 id="name">NAME</h1><p><strong>tpm2_pcrreset</strong>(1) - Reset one or more PCR banks<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_pcrreset</strong> [<em>OPTIONS</em>] <em>PCR_INDEX</em> ...<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_pcrreset</strong>(1) - Reset PCR value in all banks for specified index. More than one PCR index can be specified.<p>The reset value is manufacturer-dependent and is either sequence of 00 or FF on the length of the hash algorithm for each supported bank.<p><em>PCR_INDEX</em> is a space separated list of PCR indexes to be reset when issuing the command.<h1 id="options">OPTIONS</h1><p>This tool accepts no tool specific options.<p><a href="./common/options.html">common options</a><p><a href="./common/tcti.html">common tcti options</a><h1 id="examples">EXAMPLES</h1><h2 id="reset-a-single-pcr">Reset a single PCR</h2><pre><code class="language-bash">tpm2_pcrreset 23
</code></pre><h2 id="reset-multiple-pcrs">Reset multiple PCRs</h2><pre><code class="language-bash">tpm2_pcrreset 16 23
</code></pre><h1 id="notes">NOTES</h1><p>On operating system&#39;s locality (generally locality 0), only PCR 23 can be reset. PCR-16 can also be reset on this locality, depending on TPM manufacturers which could define this PCR as resettable.<p>PCR 0 to 15 are not resettable (being part of SRTM). PCR 16 to 22 are mostly reserved for DRTM or dedicated to specific localities and might not be resettable depending on current TPM locality.</template><template id="policyauthorize"><h1 id="name">NAME</h1><p><strong>tpm2_policyauthorize</strong>(1) - Allows for mutable policies by tethering to a signing authority.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policyauthorize</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policyauthorize</strong>(1) - This command allows for policies to change by associating the policy to a signing authority and allowing the policy contents to change.<ol><li><p>If the input session is a trial session this tool generates a policy digest that associates a signing authority&#39;s public key name with the policy being authorized.<li><p>If the input session is real policy session <strong>tpm2_policyauthorize</strong>(1) looks for a verification ticket from the TPM to attest that the TPM has verified the signature on the policy digest before authorizing the policy in the policy digest.</ol><h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>-i</strong>, <strong>--input</strong>=<em>FILE</em>:<p>The policy digest that has to be authorized.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>FILE_OR_HEX</em>:<p>The policy qualifier data signed in conjunction with the input policy digest. This is unique data that the signer can choose to include in the signature and can either be a path or hex string.<li><p><strong>-n</strong>, <strong>--name</strong>=<em>FILE</em>:<p>File containing the name of the verifying public key. This ties the final policy digest with a signer. This can be retrieved with <strong>tpm2_readpublic</strong>(1)<li><p><strong>-t</strong>, <strong>--ticket</strong>=<em>FILE</em>:<p>The ticket file to record the validation structure. This is generated with <strong>tpm2_verifysignature</strong>(1).</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Starts a <em>trial</em> session, builds a PCR policy. This PCR policy digest is then an input to the <strong>tpm2_policyauthorize</strong>(1) along with policy qualifier data and a signer public. The resultant policy digest is then used in creation of objects.<p>Subsequently when the PCR change and so does the PCR policy digest, the actual policy digest from the <strong>tpm2_policyauthorize</strong>(1) used in creation of the object will not change. At runtime the new PCR policy needs to be satisfied along with verification of the signature on the PCR policy digest using <strong>tpm2_policyauthorize</strong>(1)<h2 id="create-a-signing-authority">Create a signing authority</h2><pre><code class="language-bash">openssl genrsa -out signing_key_private.pem 2048

openssl rsa -in signing_key_private.pem -out signing_key_public.pem -pubout

tpm2_loadexternal -G rsa -C o -u signing_key_public.pem -c signing_key.ctx -n signing_key.name
</code></pre><h2 id="create-a-policy-to-be-authorized-like-a-pcr-policy">Create a policy to be authorized like a PCR policy</h2><pre><code class="language-bash">tpm2_pcrread -opcr0.sha256 sha256:0

tpm2_startauthsession -S session.ctx

tpm2_policypcr -S session.ctx -l sha256:0 -f pcr0.sha256 -L pcr.policy

tpm2_flushcontext session.ctx
</code></pre><h2 id="sign-the-policy">Sign the policy</h2><pre><code class="language-bash">openssl dgst -sha256 -sign signing_key_private.pem -out pcr.signature pcr.policy
</code></pre><h2 id="authorize-the-policy-in-the-policy-digest">Authorize the policy in the policy digest</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx

tpm2_policyauthorize -S session.ctx -L authorized.policy -i pcr.policy -n signing_key.name

tpm2_flushcontext session.ctx
</code></pre><h2 id="create-a-tpm-object-like-a-sealing-object-with-the-authorized-policy-based-authentication">Create a TPM object like a sealing object with the authorized policy based authentication</h2><pre><code class="language-bash">tpm2_createprimary -C o -g sha256 -G rsa -c prim.ctx

tpm2_create -g sha256 -u sealing_pubkey.pub -r sealing_prikey.pub -i- -C prim.ctx -L authorized.policy &lt;&lt;&lt; &quot;secret to seal&quot;
</code></pre><h2 id="satisfy-policy-and-unseal-the-secret">Satisfy policy and unseal the secret</h2><pre><code class="language-bash">tpm2_verifysignature -c signing_key.ctx -g sha256 -m pcr.policy -s pcr.signature -t verification.tkt -f rsassa

tpm2_startauthsession \--policy-session -S session.ctx

tpm2_policypcr -S session.ctx -l sha256:0 -L pcr.policy

tpm2_policyauthorize -S session.ctx -L authorized.policy -i pcr.policy -n signing_key.name -t verification.tkt

tpm2_load -C prim.ctx -u sealing_pubkey.pub -r sealing_prikey.pub -c sealing_key.ctx

unsealed=$(tpm2_unseal -p&quot;session:session.ctx&quot; -c sealing_key.ctx)

echo $unsealed

tpm2_flushcontext session.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policyauthorizenv"><h1 id="name">NAME</h1><p><strong>tpm2_policyauthorizenv</strong>(1) - Allows for mutable policies by referencing to a policy from an NV index.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policyauthorizenv</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policyauthorizenv</strong>(1) - This command allows for policies to change by referencing the authorization policy written to an NV index. The NV index containing the authorization policy should remain readable even for trial session. The index can be specified as raw handle or an offset value to the nv handle range &quot;TPM2_HR_NV_INDEX&quot;.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy used to authorize. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle or nv-index may be used.</ul><p>When <strong>-C</strong> isn&#39;t explicitly passed the index handle will be used to authorize against the index. The index auth value is set via the <strong>-p</strong> option to <strong>tpm2_nvdefine</strong>(1).<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Create a policypassword and write the policy digest to an NV Index. Build a policyauthorizenv policy referencing the NV index in a <em>trial</em> session. The resultant policy digest is then used in creation of objects.<p>In a policy authorization session, first satisfy the policy written to the NV index. Then run the policyauthorizenv which satisfies the authorization for the object.<h2 id="define-the-test-nv-index-to-store-the-auth-policy">Define the test NV Index to store the auth policy</h2><pre><code class="language-bash">nv_test_index=0x01500001
tpm2_nvdefine -C o -p nvpass $nv_test_index -a &quot;authread|authwrite&quot; -s 34
</code></pre><h2 id="define-the-auth-policy">Define the auth policy</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx
tpm2_policypassword -S session.ctx -L policy.pass
tpm2_flushcontext session.ctx
</code></pre><h2 id="write-the-auth-policy-to-the-nv-index">Write the auth policy to the NV Index</h2><pre><code class="language-bash">echo &quot;000b&quot; | xxd -p -r | cat - policy.pass | \
tpm2_nvwrite -C $nv_test_index -P nvpass $nv_test_index -i-
</code></pre><h2 id="define-the-policyauthorizenv">Define the policyauthorizenv</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx
tpm2_policyauthorizenv -S session.ctx -C $nv_test_index -P nvpass \
-L policyauthorizenv.1500001 $nv_test_index
tpm2_flushcontext session.ctx
</code></pre><h2 id="create-and-load-a-sealing-object-with-auth-policy--policyauthorizenv">Create and load a sealing object with auth policy = policyauthorizenv</h2><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx

echo &quot;secretdata&quot; | \
tpm2_create -C prim.ctx -u key.pub -r key.priv \
-a &quot;fixedtpm|fixedparent|adminwithpolicy&quot; -L policyauthorizenv.1500001 -i-

tpm2_load -C prim.ctx -u key.pub -r key.priv -c key.ctx
</code></pre><h2 id="satisfy-the-auth-policy-stored-in-the-nv-index-and-thus-policyauthorizenv">Satisfy the auth policy stored in the NV Index and thus policyauthorizenv</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx --policy-session
tpm2_policypassword -S session.ctx
tpm2_policyauthorizenv -S session.ctx -C $nv_test_index -P nvpass $nv_test_index
tpm2_unseal -c key.ctx -p session:session.ctx
tpm2_flushcontext session.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policyauthvalue"><h1 id="name">NAME</h1><p><strong>tpm2_policyauthvalue</strong>(1) - Enables binding a policy to the authorization value of the authorized TPM object.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policyauthvalue</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policyauthvalue</strong>(1) - Enables a policy that requires the object&#39;s authentication passphrase be provided. This is equivalent to authenticating using the object passphrase in plaintext or HMAC. It enforces it as a policy. It provides a mechanism to allow for password authentication when an object only allows policy based authorization, ie object attribute &quot;userwithauth&quot; is 0.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the compounded policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>We want to authenticate using the TPM objects plaintext authentication value. While we could authenticate with an ephemeral password session, in this example we will authenticate with the plaintext passphrase in a policy session instead using the <strong>tpm2_policyauthvalue</strong>(1) tool.<h2 id="create-the-password-policy">Create the password policy</h2><pre><code class="language-bash">tpm2_startauthsession -S session.dat

tpm2_policyauthvalue -S session.dat -L policy.dat

tpm2_flushcontext session.dat
</code></pre><h2 id="create-the-object-with-a-passphrase-and-the-password-policy">Create the object with a passphrase and the password policy</h2><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx

tpm2_create -g sha256 -G aes -u key.pub -r key.priv -C prim.ctx -L policy.dat \
  -p testpswd
</code></pre><h2 id="authenticate-with-plaintext-passphrase-input">Authenticate with plaintext passphrase input</h2><pre><code class="language-bash">tpm2_load -C prim.ctx -u key.pub -r key.priv -n key.name -c key.ctx

echo &quot;plaintext&quot; &gt; plain.txt
tpm2_encryptdecrypt -c key.ctx -o encrypt.out plain.txt -p testpswd
</code></pre><h2 id="authenticate-with-password-and-the-policy">Authenticate with password and the policy</h2><pre><code class="language-bash">tpm2_startauthsession --policy-session -S session.dat

tpm2_policyauthvalue -S session.dat

tpm2_encryptdecrypt -c key.ctx -o encrypt.out -p session:session.dat+testpswd \
plain.txt

tpm2_flushcontext session.dat
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policycommandcode"><h1 id="name">NAME</h1><p><strong>tpm2_policycommandcode</strong>(1) - Restrict TPM object authorization to specific TPM commands.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policycommandcode</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policycommandcode</strong>(1) - Restricts TPM object authorization to specific TPM commands. Useful when you want to allow only specific commands to interact with the TPM object.<p>As an argument it takes the command as an integer or friendly string value. Friendly string to COMMAND CODE mapping can be found in section <em>COMMAND CODE MAPPINGS</em>.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>A session file from <strong>tpm2_startauthsession</strong>(1)&#39;s <strong>-S</strong> option.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the policy digest.<li><p><strong>ARGUMENT</strong> the command line argument specifies TPM2 command code.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="command-code-mappings">COMMAND CODE MAPPINGS</h1><p>The friendly strings below can be used en lieu of the raw integer values.<p>-TPM2_CC_AC_GetCapability: 0x194 -TPM2_CC_AC_Send: 0x195 -TPM2_CC_ActivateCredential: 0x147 -TPM2_CC_Certify: 0x148 -TPM2_CC_CertifyCreation: 0x14a -TPM2_CC_ChangeEPS: 0x124 -TPM2_CC_ChangePPS: 0x125 -TPM2_CC_Clear: 0x126 -TPM2_CC_ClearControl: 0x127 -TPM2_CC_ClockRateAdjust: 0x130 -TPM2_CC_ClockSet: 0x128 -TPM2_CC_Commit: 0x18b -TPM2_CC_ContextLoad: 0x161 -TPM2_CC_ContextSave: 0x162 -TPM2_CC_Create: 0x153 -TPM2_CC_CreateLoaded: 0x191 -TPM2_CC_CreatePrimary: 0x131 -TPM2_CC_DictionaryAttackLockReset: 0x139 -TPM2_CC_DictionaryAttackParameters: 0x13a -TPM2_CC_Duplicate: 0x14b -TPM2_CC_ECC_Parameters: 0x178 -TPM2_CC_ECDH_KeyGen: 0x163 -TPM2_CC_ECDH_ZGen: 0x154 -TPM2_CC_EC_Ephemeral: 0x18e -TPM2_CC_EncryptDecrypt: 0x164 -TPM2_CC_EncryptDecrypt2: 0x193 -TPM2_CC_EventSequenceComplete: 0x185 -TPM2_CC_EvictControl: 0x120 -TPM2_CC_FieldUpgradeData: 0x141 -TPM2_CC_FieldUpgradeStart: 0x12f -TPM2_CC_FirmwareRead: 0x179 -TPM2_CC_FlushContext: 0x165 -TPM2_CC_GetCapability: 0x17a -TPM2_CC_GetCommandAuditDigest: 0x133 -TPM2_CC_GetRandom: 0x17b -TPM2_CC_GetSessionAuditDigest: 0x14d -TPM2_CC_GetTestResult: 0x17c -TPM2_CC_GetTime: 0x14c -TPM2_CC_Hash: 0x17d -TPM2_CC_HashSequenceStart: 0x186 -TPM2_CC_HierarchyChangeAuth: 0x129 -TPM2_CC_HierarchyControl: 0x121 -TPM2_CC_HMAC: 0x155 -TPM2_CC_HMAC_Start: 0x15b -TPM2_CC_Import: 0x156 -TPM2_CC_IncrementalSelfTest: 0x142 -TPM2_CC_Load: 0x157 -TPM2_CC_LoadExternal: 0x167 -TPM2_CC_MakeCredential: 0x168 -TPM2_CC_NV_Certify: 0x184 -TPM2_CC_NV_ChangeAuth: 0x13b -TPM2_CC_NV_DefineSpace: 0x12a -TPM2_CC_NV_Extend: 0x136 -TPM2_CC_NV_GlobalWriteLock: 0x132 -TPM2_CC_NV_Increment: 0x134 -TPM2_CC_NV_Read: 0x14e -TPM2_CC_NV_ReadLock: 0x14f -TPM2_CC_NV_ReadPublic: 0x169 -TPM2_CC_NV_SetBits: 0x135 -TPM2_CC_NV_UndefineSpace: 0x122 -TPM2_CC_NV_UndefineSpaceSpecial: 0x11f -TPM2_CC_NV_Write: 0x137 -TPM2_CC_NV_WriteLock: 0x138 -TPM2_CC_ObjectChangeAuth: 0x150 -TPM2_CC_PCR_Allocate: 0x12b -TPM2_CC_PCR_Event: 0x13c -TPM2_CC_PCR_Extend: 0x182 -TPM2_CC_PCR_Read: 0x17e -TPM2_CC_PCR_Reset: 0x13d -TPM2_CC_PCR_SetAuthPolicy: 0x12c -TPM2_CC_PCR_SetAuthValue: 0x183 -TPM2_CC_Policy_AC_SendSelect: 0x196 -TPM2_CC_PolicyAuthorize: 0x16a -TPM2_CC_PolicyAuthorizeNV: 0x192 -TPM2_CC_PolicyAuthValue: 0x16b -TPM2_CC_PolicyCommandCode: 0x16c -TPM2_CC_PolicyCounterTimer: 0x16d -TPM2_CC_PolicyCpHash: 0x16e -TPM2_CC_PolicyDuplicationSelect: 0x188 -TPM2_CC_PolicyGetDigest: 0x189 -TPM2_CC_PolicyLocality: 0x16f -TPM2_CC_PolicyNameHash: 0x170 -TPM2_CC_PolicyNV: 0x149 -TPM2_CC_PolicyNvWritten: 0x18f -TPM2_CC_PolicyOR: 0x171 -TPM2_CC_PolicyPassword: 0x18c -TPM2_CC_PolicyPCR: 0x17f -TPM2_CC_PolicyPhysicalPresence: 0x187 -TPM2_CC_PolicyRestart: 0x180 -TPM2_CC_PolicySecret: 0x151 -TPM2_CC_PolicySigned: 0x160 -TPM2_CC_PolicyTemplate: 0x190 -TPM2_CC_PolicyTicket: 0x172 -TPM2_CC_PP_Commands: 0x12d -TPM2_CC_Quote: 0x158 -TPM2_CC_ReadClock: 0x181 -TPM2_CC_ReadPublic: 0x173 -TPM2_CC_Rewrap: 0x152 -TPM2_CC_RSA_Decrypt: 0x159 -TPM2_CC_RSA_Encrypt: 0x174 -TPM2_CC_SelfTest: 0x143 -TPM2_CC_SequenceComplete: 0x13e -TPM2_CC_SequenceUpdate: 0x15c -TPM2_CC_SetAlgorithmSet: 0x13f -TPM2_CC_SetCommandCodeAuditStatus: 0x140 -TPM2_CC_SetPrimaryPolicy: 0x12e -TPM2_CC_Shutdown: 0x145 -TPM2_CC_Sign: 0x15d -TPM2_CC_StartAuthSession: 0x176 -TPM2_CC_Startup: 0x144 -TPM2_CC_StirRandom: 0x146 -TPM2_CC_TestParms: 0x18a -TPM2_CC_Unseal: 0x15e -TPM2_CC_Vendor_TCG_Test: 0x20000000 -TPM2_CC_VerifySignature: 0x177 -TPM2_CC_ZGen_2Phase: 0x18d<h1 id="examples">EXAMPLES</h1><p>Start a <em>policy</em> session and extend it with a specific command like unseal. Attempts to perform other operations would fail.<h2 id="create-an-unseal-only-policy">Create an unseal-only policy</h2><pre><code class="language-bash">tpm2_startauthsession -S session.dat

tpm2_policycommandcode -S session.dat -L policy.dat TPM2_CC_Unseal

tpm2_flushcontext session.dat
</code></pre><h2 id="create-the-object-with-unseal-only-auth-policy">Create the object with unseal-only auth policy</h2><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx

tpm2_create -C prim.ctx -u sealkey.pub -r sealkey.priv -L policy.dat \
  -i- &lt;&lt;&lt; &quot;SEALED-SECRET&quot;
</code></pre><h2 id="try-unseal-operation">Try unseal operation</h2><pre><code class="language-bash">tpm2_load -C prim.ctx -u sealkey.pub -r sealkey.priv -n sealkey.name \
  -c sealkey.ctx

tpm2_startauthsession --policy-session -S session.dat

tpm2_policycommandcode -S session.dat -L policy.dat TPM2_CC_Unseal

tpm2_unseal -p session:session.dat -c sealkey.ctx
SEALED-SECRET

tpm2_flushcontext session.dat
</code></pre><h2 id="try-any-other-operation">Try any other operation</h2><pre><code class="language-bash">echo &quot;Encrypt Me&quot; &gt; plain.txt

tpm2_encryptdecrypt plain.txt -o enc.txt -c sealkey.ctx plain.txt
ERROR: Esys_EncryptDecrypt2(0x12F) - tpm:error(2.0): authValue or authPolicy is
not available for selected entity
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policycountertimer"><h1 id="name">NAME</h1><p><strong>tpm2_policycountertimer</strong>(1) - Enables policy authorization by evaluating the comparison operation on the TPM parameters time, clock, reset count, restart count and TPM clock safe flag.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policycountertimer</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policycountertimer</strong>(1) - Enables policy authorization by evaluating the comparison operation on the TPM parameters time, clock, reset count, restart count and TPM clock safe flag. If time/clock, it is input as milliseconds value. The parameter and the value is given as a command line argument as below:<pre><code>tpm2_policycountertimer -S session.ctx safe
tpm2_policycountertimer -S session.ctx clock=&lt;N ms&gt;
tpm2_policycountertimer -S session.ctx time=&lt;N ms&gt;
tpm2_policycountertimer -S session.ctx resets=&lt;N&gt;
tpm2_policycountertimer -S session.ctx restarts=&lt;N&gt;
</code></pre><p>By default comparison tests for equality and also by default it tests for time.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong> or saved off of a previous tool run.<li><p><strong>--eq</strong><p>if value of current time in the TPM = value of specified input time.<li><p><strong>--neq</strong></ul><p>if value of current time in the TPM != value of specified input time.<ul><li><strong>--sgt</strong></ul><p>if signed value of current time in the TPM &gt; signed value of specified input time.<ul><li><strong>--ugt</strong></ul><p>if unsigned value of current time in the TPM &gt; unsigned value of specified input time.<ul><li><strong>--slt</strong></ul><p>if signed value of current time in the TPM &lt; signed value of specified input time.<ul><li><strong>--ult</strong></ul><p>if unsigned value of current time in the TPM &lt; unsigned value of specified input time.<ul><li><strong>--sge</strong></ul><p>if signed value of current time in the TPM &gt;= signed value of specified input time.<ul><li><strong>--uge</strong></ul><p>if unsigned value of current time in the TPM &gt;= unsigned value of specified input time.<ul><li><strong>--sle</strong></ul><p>if signed value of current time in the TPM &lt;= unsigned value of specified input time.<ul><li><strong>--ule</strong></ul><p>if unsigned value of current time in the TPM &lt;= unsigned value of specified input time.<ul><li><p><strong>--bs</strong><p>if all bits set in value of current time in the TPM are set in value of specified input time.<li><p><strong>--bc</strong><p>if all bits set in value of current time in the TPM are clear in value of specified input time.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Create a sealing object with an authorization policy that evaluates only for first minute of TPM restart.<h2 id="create-the-policy-and-the-sealing-object">Create the policy and the sealing object</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx

tpm2_policycountertimer -S session.ctx -L policy.countertimer --ult 60000

tpm2_flushcontext session.ctx

tpm2_createprimary -C o -c prim.ctx -Q

echo &quot;SUPERSECRET&quot; | \
tpm2_create -Q -u key.pub -r key.priv -i- -C prim.ctx \
-L policy.countertimer -a &quot;fixedtpm|fixedparent&quot; -c key.ctx
</code></pre><h2 id="unsealing-should-work-in-the-first-minute-after-tpm-restart">Unsealing should work in the first minute after TPM restart</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx --policy-session

tpm2_policycountertimer -S session.ctx --ult 60000

tpm2_unseal -c key.ctx -p session:session.ctx

tpm2_flushcontext session.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policycphash"><h1 id="name">NAME</h1><p><strong>tpm2_policycphash</strong>(1) - Couples a policy with command parameters of the command.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policycphash</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policycphash</strong>(1) - Couples a policy with command parameters of the command. This is a deferred assertion where the hash of the command parameters in a TPM command is checked against the one specified in the policy.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the compounded policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>--cphash-input</strong>=<em>FILE</em>:<p>The file containing the command parameter hash of the command.<li><p><strong>--cphash</strong>=<em>FILE</em>:<p><strong>DEPRECATED</strong>, use <strong>--cphash-input</strong> instead.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Restrict the value that can be set through tpm2_nvsetbits.<h2 id="define-nv-index-object-with-authorized-policy">Define NV index object with authorized policy</h2><pre><code class="language-bash">openssl genrsa -out signing_key_private.pem 2048
openssl rsa -in signing_key_private.pem -out signing_key_public.pem -pubout
tpm2_loadexternal -G rsa -C o -u signing_key_public.pem -c signing_key.ctx \
-n signing_key.name
tpm2_startauthsession -S session.ctx -g sha256
tpm2_policyauthorize -S session.ctx -L authorized.policy -n signing_key.name
tpm2_flushcontext session.ctx
tpm2_nvdefine 1 -a &quot;policywrite|authwrite|ownerread|nt=bits&quot; -L authorized.policy
</code></pre><h2 id="create-policycphash">Create policycphash</h2><pre><code class="language-bash">tpm2_nvsetbits 1 -i 1 --cphash cp.hash
tpm2_startauthsession -S session.ctx -g sha256
tpm2_policycphash -S session.ctx -L policy.cphash --cphash cp.hash
tpm2_flushcontext session.ctx
</code></pre><h2 id="sign-and-verify-policycphash">Sign and verify policycphash</h2><pre><code class="language-bash">openssl dgst -sha256 -sign signing_key_private.pem \
-out policycphash.signature policy.cphash
tpm2_verifysignature -c signing_key.ctx -g sha256 -m policy.cphash \
-s policycphash.signature -t verification.tkt -f rsassa
</code></pre><h2 id="satisfy-policycphash-and-execute-nvsetbits">Satisfy policycphash and execute nvsetbits</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx --policy-session -g sha256
tpm2_policycphash -S session.ctx --cphash cp.hash
tpm2_policyauthorize -S session.ctx -i policy.cphash -n signing_key.name \
-t verification.tkt
tpm2_nvsetbits 1 -i 1 -P &quot;session:session.ctx&quot;
tpm2_flushcontext session.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policyduplicationselect"><h1 id="name">NAME</h1><p><strong>tpm2_policyduplicationselect</strong>(1) - Restricts duplication to a specific new parent.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policyduplicationselect</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policyduplicationselect</strong>(1) - Restricts duplication to a specific new parent.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>-n</strong>, <strong>--object-name</strong>=<em>FILE</em>:<p>Input name file of the object to be duplicated.<li><p><strong>-N</strong>, <strong>--parent-name</strong>=<em>FILE</em>:<p>Input name file of the new parent.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the policy digest.<li><p><strong>--include-object</strong>:<p>If exists, the object name will be included in the value in policy digest.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="setup-a-duplication-role-policy-to-restricted-new-parent">Setup a duplication role policy to restricted new parent</h2><h3 id="create-source-parent-and-destinationor-new-parent">Create source parent and destination(or new) parent</h3><pre><code class="language-bash">tpm2_createprimary -C n -g sha256 -G rsa -c dst_n.ctx -Q
tpm2_createprimary -C o -g sha256 -G rsa -c src_o.ctx -Q
</code></pre><h3 id="create-the-restricted-parent-policy">Create the restricted parent policy</h3><pre><code class="language-bash">tpm2_readpublic -c dst_n.ctx -n dst_n.name -Q
tpm2_startauthsession -S session.ctx
tpm2_policyduplicationselect -S session.ctx  -N dst_n.name \
-L policydupselect.dat -Q
tpm2_flushcontext session.ctx
rm session.ctx
</code></pre><h3 id="create-the-object-to-be-duplicated-using-the-policy">Create the object to be duplicated using the policy</h3><pre><code class="language-bash">tpm2_create -C src_o.ctx -g sha256 -G rsa -r dupkey.priv -u dupkey.pub \
-L policydupselect.dat  -a &quot;sensitivedataorigin|sign|decrypt&quot; -c dupkey.ctx -Q
tpm2_readpublic -c dupkey.ctx -n dupkey.name -Q
</code></pre><h3 id="satisfy-the-policy-and-duplicate-the-object">Satisfy the policy and duplicate the object</h3><pre><code class="language-bash">tpm2_startauthsession -S session.ctx --policy-session
tpm2_policyduplicationselect -S session.ctx  -N dst_n.name -n dupkey.name -Q
tpm2_duplicate -C dst_n.ctx -c dupkey.ctx -G null -p session:session.ctx \
-r new_dupkey.priv -s dupseed.dat
tpm2_flushcontext  session.ctx
rm session.ctx
</code></pre><h1 id="notes">NOTES</h1><ul><li><p>This command usually cooperates with <strong>tpm2_duplicate</strong>(1), so referring to the man page of <strong>tpm2_duplicate</strong>(1) is recommended.<li><p>This command will set the policy session&#39;s command code to<li><p><em>TPM_CC_Duplicate</em>* which enables duplication role of the policy.</ul><p><a href="common/policy-limitations.md">limitations</a></template><template id="policylocality"><h1 id="name">NAME</h1><p><strong>tpm2_policylocality</strong>(1) - Restrict TPM object authorization to specific localities.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policylocality</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policylocality</strong>(1) - Restricts TPM object authorization to specific TPM locality. Useful when you want to allow only specific locality with the TPM object. A locality indicates the source of the command, for example it could be from the application layer or the driver layer, each would have it&#39;s own locality integer. Localities are hints to the TPM and are enforced by the software communicating to the TPM. Thus they are <strong>not trusted</strong> inputs on their own and are implemented in platform specific ways.<p>As an argument it takes the <em>LOCALITY</em> as an integer or friendly name.<p>Localities are fixed to a byte in size and have two representations, locality and extended locality.<p>Localities 0 through 4 are the normal locality representation and are represented as set bit indexes. Thus locality 0 is indicated by <code>1&lt;&lt;0</code> and locality 4 is indicated by <code>1&lt;&lt;4</code>. Rather then using raw numbers, these localities can also be specified by the friendly names of:<ul><li>zero: locality 0 or <code>1&lt;&lt;0</code><li>one: locality 1 or <code>1&lt;&lt;1</code><li>two: locality 2 or <code>1&lt;&lt;2</code><li>three: locality 3 or <code>1&lt;&lt;3</code><li>four: locality 4 or <code>1&lt;&lt;4</code></ul><p>Anything from the range 32 - 255 are extended localities.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>A session file from <strong>tpm2_startauthsession</strong>(1)&#39;s <strong>-S</strong> option.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the policy digest.<li><p><strong>ARGUMENT</strong> the command line argument specifies the locality number.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Start a <em>policy</em> session and extend it with a specific locality number (like 3). Attempts to perform other operations would fail.<h2 id="create-an-policy-restricted-by-locality-3">Create an policy restricted by locality 3</h2><pre><code class="language-bash">tpm2_startauthsession -S session.dat

tpm2_policylocality -S session.dat -L policy.dat three

tpm2_flushcontext session.dat
</code></pre><h2 id="create-the-object-with-auth-policy">Create the object with auth policy</h2><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx

tpm2_create -C prim.ctx -u sealkey.pub -r sealkey.priv -L policy.dat \
-i- &lt;&lt;&lt; &quot;SEALED-SECRET&quot;
</code></pre><h2 id="try-unseal-operation">Try unseal operation</h2><pre><code class="language-bash">tpm2_load -C prim.ctx -u sealkey.pub -r sealkey.priv -n sealkey.name \
-c sealkey.ctx

tpm2_startauthsession \--policy-session -S session.dat

tpm2_policylocality -S session.dat -L policy.dat three

# Change to locality 3, Note: this operation varies on different platforms

tpm2_unseal -p session:session.dat -c sealkey.ctx

tpm2_flushcontext session.dat
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policynamehash"><h1 id="name">NAME</h1><p><strong>tpm2_policynamehash</strong>(1) - Couples a policy with names of specific objects.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policynamehash</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policynamehash</strong>(1) - Couples a policy with names of specific objects. This is a deferred assertion where the hash of the names of all object handles in a TPM command is checked against the one specified in the policy.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the compounded policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>-n</strong>, <strong>--name</strong>=<em>FILE</em>:<p>The file containing the name hash of the referenced objects.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Restrict key duplication to specific new parent and specific duplicable key.<h1 id="generate-a-duplicable-object">Generate a duplicable object</h1><pre><code class="language-bash">
openssl genrsa -out signing_key_private.pem 2048

openssl rsa -in signing_key_private.pem -out signing_key_public.pem -pubout

tpm2_loadexternal -G rsa -C o -u signing_key_public.pem -c signing_key.ctx \
-n signing_key.name

tpm2_startauthsession -S session.ctx -g sha256

tpm2_policyauthorize -S session.ctx -L authorized.policy -n signing_key.name

tpm2_policycommandcode -S session.ctx -L policy.dat TPM2_CC_Duplicate

tpm2_flushcontext session.ctx

tpm2_createprimary -C o -g sha256 -G rsa -c primary.ctx -Q

## The duplicable key
tpm2_create -Q -C primary.ctx -g sha256 -G rsa -r key.prv -u key.pub \
-L policy.dat -a &quot;sensitivedataorigin|sign|decrypt&quot;

tpm2_load -Q -C primary.ctx -r key.prv -u key.pub -c key.ctx
</code></pre><h1 id="create-the-new-parent">Create the new parent</h1><pre><code class="language-bash">
tpm2_create -Q -C primary.ctx -g sha256 -G rsa -r new_parent.prv \
-u new_parent.pub \
-a &quot;decrypt|fixedparent|fixedtpm|restricted|sensitivedataorigin&quot;

tpm2_loadexternal -Q -C o -u new_parent.pub -c new_parent.ctx
</code></pre><h1 id="modify-the-duplicable-key-policy-to-namehash-policy-to-restrict-parent-and-key">Modify the duplicable key policy to namehash policy to restrict parent and key</h1><pre><code class="language-bash">tpm2_readpublic -Q -c new_parent.ctx -n new_parent.name

tpm2_readpublic -Q -c key.ctx -n key.name

cat key.name new_parent.name | openssl dgst -sha256 -binary &gt; name.hash

tpm2_startauthsession -S session.ctx -g sha256

tpm2_policynamehash -L policy.namehash -S session.ctx -n name.hash

tpm2_flushcontext session.ctx

openssl dgst -sha256 -sign signing_key_private.pem \
-out policynamehash.signature policy.namehash

tpm2_startauthsession -S session.ctx -g sha256

tpm2_policyauthorize -S session.ctx -L authorized.policy -i policy.namehash \
-n signing_key.name

tpm2_policycommandcode -S session.ctx -L policy.dat TPM2_CC_Duplicate

tpm2_flushcontext session.ctx
</code></pre><h1 id="satisfy-the-policy-and-attempt-key-duplication">Satisfy the policy and attempt key duplication</h1><pre><code class="language-bash">tpm2_verifysignature -c signing_key.ctx -g sha256 -m policy.namehash \
-s policynamehash.signature -t verification.tkt -f rsassa

tpm2_startauthsession -S session.ctx --policy-session -g sha256

tpm2_policynamehash -S session.ctx -n name.hash

tpm2_policyauthorize -S session.ctx -i policy.namehash -n signing_key.name \
-t verification.tkt

tpm2_policycommandcode -S session.ctx TPM2_CC_Duplicate

tpm2_duplicate -C new_parent.ctx -c key.ctx -G null -p &quot;session:session.ctx&quot; \
-r dupprv.bin -s dupseed.dat

tpm2_flushcontext session.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policynv"><h1 id="name">NAME</h1><p><strong>tpm2_policynv</strong>(1) - Evaluates policy authorization by comparing a specified value against the contents in the specified NV Index.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policynv</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policynv</strong>(1) - This command evaluates policy authorization by comparing the contents written to an NV index against the one specified in the tool options. The tool takes two arguments - (1) The NV index specified as raw handle or an offset value to the nv handle range &quot;TPM2_HR_NV_INDEX&quot; and (2) Comparison operator for magnitude comparison and or bit test operations. In the specification the NV index holding the data is called operandA and the data that the user specifies to compare is called operandB. The comparison operator can be specified as follows:<ul><li>&quot;eq&quot; if operandA = operandB<li>&quot;neq&quot; if operandA != operandB<li>&quot;sgt&quot; if signed operandA &gt; signed operandB<li>&quot;ugt&quot; if unsigned operandA &gt; unsigned operandB<li>&quot;slt&quot; if signed operandA &lt; signed operandB<li>&quot;ult&quot; if unsigned operandA &lt; unsigned operandB<li>&quot;sge&quot; if signed operandA &gt;= signed operandB<li>&quot;uge&quot; if unsigned operandA &gt;= unsigned operandB<li>&quot;sle&quot; if signed operandA &lt;= unsigned operandB<li>&quot;ule&quot; if unsigned operandA &lt;= unsigned operandB<li>&quot;bs&quot; if all bits set in operandA are set in operandB<li>&quot;bc&quot; if all bits set in operandA are clear in operandB</ul><h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy used to authorize. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong><li><strong><code>&lt;num&gt;</code></strong> where a hierarchy handle or nv-index may be used.</ul><p>When <strong>-C</strong> isn&#39;t explicitly passed the index handle will be used to authorize against the index. The index auth value is set via the <strong>-p</strong> option to <strong>tpm2_nvdefine</strong>(1).<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong> or saved off of a previous tool run.<li><p><strong>--offset</strong>=<em>NATURAL_NUMBER</em>:<p>The offset within the NV index to start comparing at. The size of the data starting at offset and ending at size of NV index shall not exceed the size of the operand specified in the options.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>-i</strong>, <strong>--input</strong>=<em>FILE</em>:<p>Specifies the input file with data to compare to NV Index contents. In the standard specification, this is termed as operand or operandB more specifically . It can be specified as a file input or stdin if option value is a &quot;-&quot;.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Test if NV index content value is equal to an input number. To do this we first create an NV index of size 1 byte and write a value. Eg. 0xAA. Next we attempt to create a policy that becomes valid if the equality comparison operation of the NV index content against the one specified in the tool options.<h2 id="define-the-test-nv-index-and-write-the-value-0xaa-to-it">Define the test NV Index and write the value 0xAA to it</h2><pre><code class="language-bash">nv_test_index=0x01500001
tpm2_nvdefine -C o -p nvpass $nv_test_index -a &quot;authread|authwrite&quot; -s 1
echo &quot;aa&quot; | xxd -r -p | tpm2_nvwrite -P nvpass -i- $nv_test_index
</code></pre><h2 id="attempt-defining-policynv-with-wrong-comparison-value-specified-in-options">Attempt defining policynv with wrong comparison value specified in options.</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx --policy-session
### This should fail
echo 0xBB | tpm2_policynv -S session.ctx -L policy.nv -i- 0x1500001 eq -P nvpass
tpm2_flushcontext session.ctx
</code></pre><h2 id="attempt-defining-policynv-with-right-comparison-value-specified-in-options">Attempt defining policynv with right comparison value specified in options.</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx --policy-session
### This should pass
echo 0xAA | tpm2_policynv -S session.ctx -L policy.nv -i- 0x1500001 eq -P nvpass
tpm2_flushcontext session.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policynvwritten"><h1 id="name">NAME</h1><p><strong>tpm2_policynvwritten</strong>(1) - Restrict TPM object authorization to the written state of an NV index.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policynvwritten</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policynvwritten</strong>(1) - Restricts TPM object authorization to the written state of an NV index. Useful when creating write once NV indexes.<p>As an [<em>ARGUMENT</em>] it takes the expected written state of the NV index. It can be specified as s|c|0|1.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>A session file from <strong>tpm2_startauthsession</strong>(1)&#39;s <strong>-S</strong> option.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the policy digest.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Create a write once NV index. To do this the NV index is defined with a write policy that is valid only if the NV index attribute &quot;TPMA_NV_WRITTEN&quot; was never set.<h2 id="define-the-nv-index-write-policy">Define the NV index write policy</h2><pre><code class="language-bash">tpm2_startauthsession -S session.dat
tpm2_policycommandcode -S session.dat TPM2_CC_NV_Write
tpm2_policynvwritten -S session.dat -L nvwrite.policy c
tpm2_flushcontext session.dat
</code></pre><h2 id="define-the-nv-index-with-the-policy">Define the NV index with the policy</h2><pre><code class="language-bash"> tpm2_nvdefine -s 1 -a &quot;authread|policywrite&quot; -p nvrdpass -L nvwrite.policy
</code></pre><h2 id="write-the-nv-index-by-satisfying-the-policy">Write the NV index by satisfying the policy</h2><pre><code class="language-bash">tpm2_startauthsession -S session.dat --policy-session
tpm2_policycommandcode -S session.dat TPM2_CC_NV_Write
tpm2_policynvwritten -S session.dat c
echo 0xAA | xxd -r -p | tpm2_nvwrite 0x01000000 -i- -P session:session.dat
tpm2_flushcontext session.dat
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policyor"><h1 id="name">NAME</h1><p><strong>tpm2_policyor</strong>(1) - logically OR&#39;s two policies together.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policyor</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policyor</strong>(1) - Generates a policy_or event with the TPM. It expects a session to be already established via <strong>tpm2_startauthsession</strong>(1). If the input session is a trial session this tool generates a policy digest that compounds two or more input policy digests such that the resulting policy digest requires at least one of the policy events being true. If the input session is real policy session <strong>tpm2_policyor</strong>(1) authenticates the object successfully if at least one of the policy events are true.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the compounded policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>ARGUMENT</strong> the command line argument specifies the list of files for the policy digests that has to be compounded resulting in individual policies being added to final policy digest that can authenticate the object. The list begins with the policy digest hash alg. Example sha256:policy1,policy2<li><p><strong>-l</strong>, <strong>--policy-list</strong>=<em>POLICY_FILE</em>_LIST:<p>This option is retained for backwards compatibility. Use the argument method instead.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Create an authorization policy for a sealing object that compounds a pcr policy and a policypassword in an OR fashion and show satisfying either policies could unseal the secret.<h2 id="create-policypcr-as-first-truth-value-for-compounding-the-policies">Create policypcr as first truth value for compounding the policies</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx
tpm2_policypcr -S session.ctx -L policy.pcr -l sha256:0,1,2,3
tpm2_flushcontext session.ctx
</code></pre><h2 id="create-policypassword-as-second-truth-value-for-compounding-the-policies">Create policypassword as second truth value for compounding the policies</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx
tpm2_policypassword -S session.ctx -L policy.pass
tpm2_flushcontext session.ctx
</code></pre><h2 id="compound-the-two-policies-in-an-or-fashion-with-tpm2_policyor-command">Compound the two policies in an OR fashion with tpm2_policyor command</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx
tpm2_policyor -S session.ctx -L policy.or sha256:policy.pass,policy.pcr
tpm2_flushcontext session.ctx
</code></pre><h2 id="create-a-sealing-object-and-attach-the-auth-policy-from-tpm2_policyor-command">Create a sealing object and attach the auth policy from tpm2_policyor command</h2><pre><code class="language-bash">tpm2_createprimary -c prim.ctx -Q
echo &quot;secret&quot; | tpm2_create -C prim.ctx -c key.ctx -u key.pub -r key.priv \
-L policy.or -i-
</code></pre><h2 id="satisfy-auth-policy-using-password-and-unseal-the-secret">Satisfy auth policy using password and unseal the secret</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx --policy-session
tpm2_policypassword -S session.ctx
tpm2_policyor -S session.ctx sha256:policy.pass,policy.pcr
tpm2_unseal -c key.ctx -p session:session.ctx
tpm2_flushcontext session.ctx
</code></pre><h2 id="satisfy-auth-policy-using-pcr-and-unseal-the-secret">Satisfy auth policy using pcr and unseal the secret</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx --policy-session
tpm2_policypcr -S session.ctx -l sha256:0,1,2,3
tpm2_policyor -S session.ctx sha256:policy.pass,policy.pcr
tpm2_unseal -c key.ctx -p session:session.ctx
tpm2_flushcontext session.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policypassword"><h1 id="name">NAME</h1><p><strong>tpm2_policypassword</strong>(1) - Enables binding a policy to the authorization value of the authorized TPM object.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policypassword</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policypassword</strong>(1) - Enables a policy that requires the object&#39;s authentication passphrase be provided. This is equivalent to authenticating using the object passphrase in plaintext, only this enforces it as a policy. It provides a mechanism to allow for password authentication when an object only allows policy based authorization, ie object attribute &quot;userwithauth&quot; is 0.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the compounded policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>We want to authenticate using the TPM objects plaintext authentication value. While we could authenticate with an ephemeral password session, in this example we will authenticate with the plaintext passphrase in a policy session instead using the <strong>tpm2_policypassword</strong>(1) tool.<h2 id="create-the-password-policy">Create the password policy</h2><pre><code class="language-bash">tpm2_startauthsession -S session.dat

tpm2_policypassword -S session.dat -L policy.dat

tpm2_flushcontext session.dat
</code></pre><h2 id="create-the-object-with-a-passphrase-and-the-password-policy">Create the object with a passphrase and the password policy</h2><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx

tpm2_create -g sha256 -G aes -u key.pub -r key.priv -C prim.ctx -L policy.dat \
  -p testpswd
</code></pre><h2 id="authenticate-with-plaintext-passphrase-input">Authenticate with plaintext passphrase input</h2><pre><code class="language-bash">tpm2_load -C prim.ctx -u key.pub -r key.priv -n key.name -c key.ctx

echo &quot;plaintext&quot; &gt; plain.txt
tpm2_encryptdecrypt -c key.ctx -o encrypt.out plain.txt -p testpswd plain.txt
</code></pre><h2 id="authenticate-with-password-and-the-policy">Authenticate with password and the policy</h2><pre><code class="language-bash">tpm2_startauthsession \--policy-session -S session.dat

tpm2_policypassword -S session.dat -L policy.dat

tpm2_encryptdecrypt -c key.ctx -o encrypt.out \
  -p session:session.dat+testpswd plain.txt

tpm2_flushcontext session.dat
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policypcr"><h1 id="name">NAME</h1><p><strong>tpm2_policypcr</strong>(1) - Create a policy that includes specific PCR values.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policypcr</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policypcr</strong>(1) - Generates a PCR policy event with the TPM. A PCR policy event creates a policy bound to specific PCR values and is useful within larger policies constructed using policyor and policyauthorize events. See <strong>tpm2_policyor(1)</strong> and <strong>tpm2_policyauthorize(1)</strong> respectively for their usages. The PCR data factored into the policy can be specified in one of 3 ways:<ol><li>A file containing a concatenated list of PCR values as in the output from <strong>tpm2_pcrread</strong>.<li>Requiring the PCR values be read off the TPM by not specifying a PCR file input.<li>The digest of all the PCR values directly specified as an <strong>argument</strong>.</ol><h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the policy digest.<li><p><strong>-f</strong>, <strong>--pcr</strong>=<em>FILE</em>:<p>Optional Path or Name of the file containing expected PCR values for the specified index. Default is to read the current PCRs per the set list.<li><p><strong>-l</strong>, <strong>--pcr-list</strong>=<em>PCR</em>:<p>The list of PCR banks and selected PCRs&#39; ids for each bank.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>ARGUMENT</strong>: The calculated digest of all PCR values specified as a hex byte stream. Eg: <code>openssl dgst -sha256 -binary pcr.bin | xxd -p -c 32</code></ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/pcr.html">pcr bank specifiers</a> details the syntax for specifying pcr list <em>PCR</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Starts a <em>trial</em> session, builds a PCR policy and uses that policy in the creation of an object. Then, it uses a <em>policy</em> session to unseal some data stored in the object.<h2 id="step-1-create-a-policy">Step 1: create a policy</h2><pre><code class="language-bash">tpm2_createprimary -C e -g sha256 -G ecc -c primary.ctx

tpm2_pcrread -o pcr.dat &quot;sha1:0,1,2,3&quot;

tpm2_startauthsession -S session.dat

tpm2_policypcr -S session.dat -l &quot;sha1:0,1,2,3&quot; -f pcr.dat -L policy.dat

tpm2_flushcontext session.dat
</code></pre><h1 id="step-2-create-an-object-using-that-policy">Step 2: create an object using that policy</h1><pre><code class="language-bash">tpm2_create -Q -u key.pub -r key.priv -C primary.ctx -L policy.dat \
-i- &lt;&lt;&lt; &quot;12345678&quot;

tpm2_load -C primary.ctx -u key.pub -r key.priv -n unseal.key.name \
-c unseal.key.ctx
</code></pre><h2 id="step-3-satisfy-the-policy">Step 3: Satisfy the policy</h2><pre><code class="language-bash">tpm2_startauthsession --policy-session -S session.dat

tpm2_policypcr -S session.dat -l &quot;sha1:0,1,2,3&quot; -f pcr.dat -L policy.dat
</code></pre><h2 id="step-4-use-the-policy">Step 4: Use the policy</h2><pre><code class="language-bash">tpm2_unseal -psession:session.dat -c unseal.key.ctx
12345678

tpm2_flushcontext session.dat
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policyrestart"><h1 id="name">NAME</h1><p><strong>tpm2_policyrestart</strong>(1) - Restart an existing session with the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policyrestart</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policyrestart</strong>(1) - Restarts a session with the TPM back to it&#39;s initial state. This is useful when the TPM gives one a <strong>TPM_RC_PCR_CHANGED</strong> (<code>0x00000128</code>) error code when using a PCR policy session.<p>This will be returned if a PCR state affecting policy is altered during the session. One could restart the session and try again, however, the PCR state would still need to satisfy the policy.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>Optional, A session file from <strong>tpm2_startauthsession</strong>(1)&#39;s <strong>-S</strong> option. This session is used in lieu of starting a session and using the PCR policy options.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="start-a-policy-session-and-restart-it-unsealing-some-data">Start a <em>policy</em> session and restart it, unsealing some data.</h2><pre><code class="language-bash"># create a policy and bind it to an object
tpm2_startauthsession -S session.dat

tpm2_policypcr -S session.dat -l &quot;sha1:0,1,2,3&quot; -L policy.dat

tpm2_createprimary -c primary.ctx

tpm2_create -Cprimary.ctx -u key.pub -r key.priv -L policy.dat -i- &lt;&lt;&lt; &quot;secret&quot;

tpm2_load -C primary.ctx -c key.ctx -u key.pub -r key.priv

tpm2_flushcontext session.dat

# satisfy the policy and use the object
tpm2_startauthsession --policy -S session.dat

tpm2_policypcr -S session.dat -l &quot;sha1:0,1,2,3&quot;

# PCR event occurs here causing unseal to fail
tpm2_pcrevent 0 &lt;&lt;&lt; &quot;event data&quot;

tpm2_unseal -psession:session.dat -c key.ct
ERROR: Esys_Unseal(0x128) - tpm:error(2.0): PCR have changed since checked

# Clear the policy digest to initial state, note access to object no longer allowed by
# policy so policyor would be useful here.
tpm2_policyrestart -S session.dat
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policysecret"><h1 id="name">NAME</h1><p><strong>tpm2_policysecret</strong>(1) - Couples the authorization of an object to that of an existing object.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policysecret</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policysecret</strong>(1) - Couples the authorization of an object to that of an existing object without requiring exposing the existing secret until time of object use.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--object-context</strong>=<em>OBJECT</em>:<p>A context object specifier of a transient/permanent/persistent object. Either a file path of a object context blob or a loaded/persistent/permanent handle id. See section &quot;Context Object Format&quot;. As an argument, it takes the auth value of the associated TPM object, a single dash - can be used to read the auth value from stdin. The argument follows the &quot;authorization formatting standards&quot;, see section &quot;Authorization Formatting&quot;.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the policy digest.<li><p><strong>-t</strong>, <strong>--expiration</strong>=<em>NATURAL_NUMBER</em>:<p>Set the expiration time of the policy in seconds. In absence of nonceTPM the expiration time is the policy timeout value. If expiration value is 0 then the policy does not have a time limit on the authorization.<li><p><strong>--ticket</strong>=<em>FILE</em>:<p>The ticket file to record the authorization ticket structure.<li><p><strong>--timeout</strong>=<em>FILE</em>:<p>The file path to record the timeout structure returned.<li><p><strong>-x</strong>, <strong>--nonce-tpm</strong>:<p>Enable the comparison of the current session&#39;s nonceTPM to ensure the validity of the policy authorization is limited to the current session.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>FILE_OR_HEX_STR</em>:<p>Optional, the policy qualifier data that the signer can choose to include in the signature. Can be either a hex string or path.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash to be used in an audit or a policycphash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the <em>AUTH</em> to be set for the object specified with <strong>-c</strong>.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Associate auth value of a sealing object to the owner hierarchy password.<ul><li>Start a trial auth session and run <strong>tpm2_policysecret</strong>(1) to create policy that can only be satisfied if owner hierarchy auth value is supplied.<li>Start a real policy session and provide the owner hierarchy auth value.<li>Provide the session input where in the policysecret for owner hierarchy auth was satisfied to the unseal tool.<li>If the policy was satisfied unsealing should succeed.</ul><h2 id="generate-a-policy-that-binds-to-the-secret-of-the-owner-hiearchy">Generate a policy that binds to the secret of the owner hiearchy</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx

tpm2_policysecret -S session.ctx -c o -L secret.policy

tpm2_flushcontext session.ctx
</code></pre><h2 id="create-a-tpm-object-using-the-policy">Create a TPM object using the policy</h2><pre><code class="language-bash">tpm2_createprimary -Q -C o -g sha256 -G rsa -c prim.ctx

tpm2_create -Q -g sha256 -u sealing_key.pub -r sealing_key.priv -i- \
  -C prim.ctx -L secret.policy &lt;&lt;&lt; &quot;SEALED-SECRET&quot;

tpm2_load -C prim.ctx -u sealing_key.pub -r sealing_key.priv \
  -c sealing_key.ctx
</code></pre><h2 id="satisfy-the-policy-and-unseal-the-secret">Satisfy the policy and unseal the secret</h2><pre><code class="language-bash">tpm2_startauthsession --policy-session -S session.ctx

tpm2_policysecret -S session.ctx -c o -L secret.policy

tpm2_unseal -p &quot;session:session.ctx&quot; -c sealing_key.ctx
SEALED-SECRET

tpm2_flushcontext session.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policysigned"><h1 id="name">NAME</h1><p><strong>tpm2_policysigned</strong>(1) - Enables policy authorization by verifying signature of optional TPM2 parameters. The signature is generated by a signing authority.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policysigned</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policysigned</strong>(1) - Enables policy authorization by verifying signature of optional TPM2 parameters. The signature is generated by a signing authority. The optional TPM2 parameters being cpHashA, nonceTPM, policyRef and expiration.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the compounded policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>Context object for the key context used for the operation. Either a file or a handle number. See section &quot;Context Object Format&quot;.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm used to digest the message.<li><p><strong>-s</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>The input signature file of the signature to be validated.<li><p><strong>-f</strong>, <strong>--format</strong>=<em>FORMAT</em>:<p>Set the input signature file to a specified format. The default is the tpm2.0 TPMT_SIGNATURE data format, however different schemes can be selected if the data came from an external source like OpenSSL. The tool currently supports rsassa and ecdsa.<li><p><strong>-t</strong>, <strong>--expiration</strong>=<em>NATURAL_NUMBER</em>:<p>Set the expiration time of the policy in seconds. In absence of nonceTPM the expiration time is the policy timeout value. If expiration is a negative value an authorization ticket is additionally returned. If expiration value is 0 then the policy does not have a time limit on the authorization.<li><p><strong>--cphash-input</strong>=<em>FILE</em>:<p>The command parameter hash (cpHash), enforcing the TPM command to be authorized as well as its handle and parameter values.<li><p><strong>--ticket</strong>=<em>FILE</em>:<p>The ticket file to record the authorization ticket structure.<li><p><strong>--timeout</strong>=<em>FILE</em>:<p>The file path to record the timeout structure returned.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>FILE_OR_HEX_STR</em>:<p>Optional, the policy qualifier data that the signer can choose to include in the signature. Can be either a hex string or path.<li><p><strong>-x</strong>, <strong>--nonce-tpm</strong>:<p>Enable the comparison of the current session&#39;s nonceTPM to ensure the validity of the policy authorization is limited to the current session.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Authorize a TPM operation on an object whose authorization is bound to specific signing authority.<h2 id="create-the-signing-authority">Create the signing authority</h2><pre><code class="language-bash">openssl genrsa -out private.pem 2048

openssl rsa -in private.pem -outform PEM -pubout -out public.pem
</code></pre><h2 id="generate-signature-with-noncetpm-cphasha-policyref-and-expiration-set-to-0">Generate signature with nonceTPM, cpHashA, policyRef and expiration set to 0</h2><pre><code class="language-bash">echo &quot;00 00 00 00&quot; | xxd -r -p | \
openssl dgst -sha256 -sign private.pem -out signature.dat
</code></pre><h2 id="load-the-verification-key-and-create-the-policysigned-policy">Load the verification key and Create the policysigned policy</h2><pre><code class="language-bash">tpm2_loadexternal -C o -G rsa -u public.pem -c signing_key.ctx

tpm2_startauthsession -S session.ctx

tpm2_policysigned -S session.ctx -g sha256 -s signature.dat -f rsassa \
-c signing_key.ctx -L policy.signed

tpm2_flushcontext session.ctx
</code></pre><h2 id="create-a-sealing-object-to-use-the-policysigned">Create a sealing object to use the policysigned</h2><pre><code class="language-bash">echo &quot;plaintext&quot; &gt; secret.data

tpm2_createprimary -C o -c prim.ctx

tpm2_create -u key.pub -r sealing_key.priv -c sealing_key.ctx -C prim.ctx \
-i secret.data -L policy.signed
</code></pre><h2 id="satisfy-the-policy-and-unseal-secret">Satisfy the policy and unseal secret</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx --policy-session

tpm2_policysigned -S session.ctx -g sha256 -s signature.dat -f rsassa \
-c signing_key.ctx -L policy.signed

tpm2_unseal -p session:session.ctx -c sealing_key.ctx

tpm2_flushcontext session.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policytemplate"><h1 id="name">NAME</h1><p><strong>tpm2_policytemplate</strong>(1) - Couples a policy with public template data digest of an object.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_policytemplate</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_policytemplate</strong>(1) - Couples a policy with public template data digest of an object. This is a deferred assertion where the hash of the public template data of an object is checked against the one specified in the policy.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the compounded policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>--template-hash</strong>=<em>FILE</em>:<p>The file containing the hash of the public template of the object.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h1 id="restrict-the-primary-object-type-created-under-a-hierarchy">Restrict the primary object type created under a hierarchy</h1><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx --template-data template.data

cat template.data | openssl dgst -sha256 -binary -out template.hash

tpm2_startauthsession -S session.ctx -g sha256
tpm2_policytemplate -S session.ctx -L policy.template \
--template-hash template.hash
tpm2_flushcontext session.ctx

tpm2_setprimarypolicy -C o -g sha256 -L policy.template

tpm2_startauthsession -S session.ctx -g sha256 --policy-session
tpm2_policytemplate -S session.ctx --template-hash template.hash
tpm2_createprimary -C o -c prim2.ctx -P session:session.ctx
tpm2_flushcontext session.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="policyticket"><h1 id="name">NAME</h1><p><strong>tpm2_ticket</strong>(1) - Enables policy authorization by verifying a ticket that represents a validated authorization that had an expiration time associated with it.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_ticket</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_ticket</strong>(1) - Enables policy authorization by verifying a ticket that represents a validated authorization that had an expiration time associated with it.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>File to save the compounded policy digest.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The policy session file generated via the <strong>-S</strong> option to <strong>tpm2_startauthsession</strong>(1).<li><p><strong>-n</strong>, <strong>--name</strong>=<em>FILE</em>:<p>Name of the object that validated the authorization.<li><p><strong>--ticket</strong>=<em>FILE</em>:<p>The ticket file to record the authorization ticket structure.<li><p><strong>--timeout</strong>=<em>FILE</em>:<p>The file path to record the timeout structure returned.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>FILE_OR_HEX_STR</em>:<p>Optional, the policy qualifier data that the signer can choose to include in the signature. Can be either a hex string or path.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><p>Authorize a TPM operation on an object whose authorization is bound to specific signing authority.<h2 id="create-the-signing-authority-and-load-the-verification-key">Create the signing authority and load the verification key</h2><pre><code class="language-bash">openssl genrsa -out private.pem 2048

openssl rsa -in private.pem -outform PEM -pubout -out public.pem

tpm2_loadexternal -C o -G rsa -u public.pem -c signing_key.ctx \
-n signing_key.name
</code></pre><h2 id="generate-signature-with-the-expiry-time">Generate signature with the expiry time</h2><pre><code class="language-bash">EXPIRYTIME=&quot;FFFFFE0C&quot;

echo $EXPIRYTIME | xxd -r -p | \
openssl dgst -sha256 -sign private.pem -out signature.dat
</code></pre><h2 id="create-the-policy">Create the policy</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx

tpm2_policysigned -S session.ctx -g sha256 -s signature.dat -f rsassa \
-c signing_key.ctx -L policy.signed

tpm2_flushcontext session.ctx
</code></pre><h2 id="create-a-sealing-object">Create a sealing object</h2><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx -Q

echo &quot;plaintext&quot; &gt; secret.dat

tpm2_create -u sealing_key.pub -r sealing_key.priv -c sealing_key.ctx \
-C prim.ctx -i secret.dat -L policy.signed -Q
</code></pre><h2 id="create-ticket-able-policy">Create ticket-able policy</h2><pre><code class="language-bash">tpm2_startauthsession -S session.ctx --nonce-tpm=nonce.test --policy-session

{ cat nonce.test &amp; echo $EXPIRYTIME | xxd -r -p; } | \
openssl dgst -sha256 -sign private.pem -out signature.dat

tpm2_policysigned -S session.ctx -g sha256 -s signature.dat -f rsassa \
-c signing_key.ctx -x nonce.test --ticket tic.ket --timeout time.out \
-t 0xFFFFFE0C

tpm2_flushcontext session.ctx
</code></pre><p>##Test with policyticket instead of policysigned<pre><code class="language-bash">tpm2_startauthsession -S session.ctx --policy-session

tpm2_policyticket -S session.ctx -n signing_key.name --ticket tic.ket \
--timeout time.out

tpm2_unseal -p session:session.ctx -c sealing_key.ctx
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="print"><h1 id="name">NAME</h1><p><strong>tpm2_print</strong>(1) - Prints TPM data structures<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_print</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em> or <em>STDIN</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_print</strong>(1) - Decodes a TPM data structure and prints enclosed elements to stdout as YAML. A file path containing a TPM object may be specified as the path argument. Reads from stdin if unspecified.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-t</strong>, <strong>--type</strong>:<p>Required. Type of data structure. The option supports the following arguments:<ul><li><strong>TPMS_ATTEST</strong><li><strong>TPMS_CONTEXT</strong><li><strong>TPM2B_PUBLIC</strong><li><strong>TPMT_PUBLIC</strong></ul><li><p><strong>ARGUMENT</strong> the command line argument specifies the path of the TPM data.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h2 id="references-1">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="print-a-tpm-quote">Print a TPM Quote</h2><h3 id="setup-a-key-to-generate-a-qoute-from">Setup a key to generate a qoute from</h3><pre><code class="language-bash">tpm2_createprimary -C e -c primary.ctx
tpm2_create -C primary.ctx -u key.pub -r key.priv
tpm2_load -C primary.ctx -u key.pub -r key.priv -c key.ctx
tpm2_quote -c key.ctx -l 0x0004:16,17,18+0x000b:16,17,18 -g sha256 -m msg.dat
</code></pre><h3 id="print-a-quote">Print a Quote</h3><pre><code class="language-bash">tpm2_print -t TPMS_ATTEST msg.dat
</code></pre><h3 id="print-a-public-file">Print a public file</h3><pre><code class="language-bash">tpm2_print -t TPM2B_PUBLIC key.pub
</code></pre><h3 id="print-a-tpmt-public-file">Print a tpmt public file</h3><pre><code class="language-bash">tpm2_readpublic -c key.ctx -f tpmt -o key.tpmt
tpm2_print -t TPMT_PUBLIC key.tpmt
</code></pre></template><template id="quote"><h1 id="name">NAME</h1><p><strong>tpm2_quote</strong>(1) - Provide a quote and signature from the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_quote</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_quote</strong>(1) - Provide quote and signature for given list of PCRs in given algorithm/banks.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>Context object for the quote signing key.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for AK specified by option <strong>-C</strong>.<li><p><strong>-l</strong>, <strong>--pcr-list</strong>=<em>PCR</em>:<p>The list of PCR banks and selected PCRs&#39; ids for each bank. Also see <strong>NOTES</strong> section below.<li><p><strong>-m</strong>, <strong>--message</strong>=<em>FILE</em>:<p>Message output file, records the quote message that makes up the data that is signed by the TPM.<li><p><strong>-s</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>Signature output file, records the signature in the format specified via the <strong>-f</strong> option.<li><p><strong>-f</strong>, <strong>--format</strong>=<em>FORMAT</em>:<p>Format selection for the signature output file.<li><p><strong>-o</strong>, <strong>--pcr</strong>=<em>FILE</em>.<p>PCR output file, optional, records the list of PCR values as defined by <strong>-l</strong>.<li><p><strong>-q</strong>, <strong>--qualification</strong>=<em>HEX_STRING_OR_PATH</em>:<p>Data given as a Hex string or binary file to qualify the quote, optional. This is typically used to add a nonce against replay attacks.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>:<p>Hash algorithm for signature. Defaults to sha256.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/signature.html">signature format specifiers</a> option used to configure signature <em>FORMAT</em>.<p><a href="./common/pcr.html">pcr bank specifiers</a> details the syntax for specifying pcr list.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_createprimary -C e -c primary.ctx

tpm2_create -C primary.ctx -u key.pub -r key.priv

tpm2_load -C primary.ctx -u key.pub -r key.priv -c key.ctx

tpm2_quote -Q -c key.ctx -l 0x0004:16,17,18+0x000b:16,17,18
</code></pre><h1 id="notes">NOTES</h1><p>The maximum number of PCR that can be quoted at once is associated with the maximum length of a bank.<p>On most TPMs, it means that this tool can quote up to 24 PCRs at once.<p>That this performs a detached signature.</template><template id="rc"><h1 id="name">NAME</h1><p><strong>tpm2_rc_decode</strong>(1) - Decode TPM2 error codes to a human readable format.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_rc_decode</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_rc_decode</strong>(1) - Converts an <em>RC_CODE</em> from the TPM or TSS2 software stack into human readable errors. Analogous to <strong>strerror</strong>(3), but for the TPM2 stack.<h1 id="options">OPTIONS</h1><p>This tool takes no tool specific options.<ul><li><strong>ARGUMENT</strong> the command line argument specifies the error code to be parsed.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_rc_decode 0x1d5
tpm:parameter(1):structure is the wrong size
</code></pre></template><template id="readclock"><h1 id="name">NAME</h1><p><strong>tpm2_readclock</strong>(1) - Retrieves the time information from the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_readclock</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_readclock</strong>(1) -Reads the current TPMS_TIME_INFO structure from the TPM. The structure contains the current setting of Time, Clock, resetCount, and restartCount. The structure is output as YAML to stdout. The YAML output is defined as:<pre><code class="language-yaml">time: 13673142     # 64 bit value of time since last _TPM_Init or TPM2_Startup
                   # in ms.
clock_info:
  clock: 13673142  # 64 bit value of time TPM has been powered on in ms.
  reset_count: 0   # 32 bit value of the number of TPM Resets since the last
                   # TPM2_Clear.
  restart_count: 0 # 32 bit value of the number of times that TPM2_Shutdown or
                   # _TPM_Hash_Start have occurred since the last TPM Reset or
                   # TPM2_Clear.
  safe: yes        # boolean yes|no value that no value of Clock greater than
                   # the current value of Clock has been previously reported by
                   # the TPM.
</code></pre><p>This tool takes no arguments and no tool specific options.<h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="read-the-clock">Read the clock</h2><pre><code class="language-bash">tpm2_readclock
time: 13673142
clock_info:
  clock: 13673142
  reset_count: 0
  restart_count: 0
  safe: yes
</code></pre></template><template id="readpublic"><h1 id="name">NAME</h1><p><strong>tpm2_readpublic</strong>(1) - Read the public area of a loaded object.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_readpublic</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_readpublic</strong>(1) - Reads the public area of a loaded object.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--object-context</strong>=<em>OBJECT</em>:<p>Context object for the object to read.<li><p><strong>-n</strong>, <strong>--name</strong>=<em>FILE</em>:<p>An optional file to save the name structure of the object.</ul><p><a href="./common/pubkey.html">pubkey options</a><pre><code>Public key format.
</code></pre><ul><li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em>:<p>The output file path, recording the public portion of the object.<li><p><strong>-t</strong>, <strong>--serialized-handle</strong>=<em>HANDLE</em>:<p>If the object to be read is a persistent object specified by a raw handle, optionally save the serialized handle for use later. This routine does NOT verify the name of the object being read. Callers should ensure that the contents of name match the expected objects name.<li><p><strong>-q</strong>, <strong>--qualified-name</strong>=<em>FILE</em>:<p>Saves the qualified name of the object to <em>FILE</em>. The qualified name of the object is the name algorithm hash of the parents qualified and the objects name. Thus the qualified name of the object serves as proof of the objects parents.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="create-a-primary-object-and-read-the-public-structure-in-an-openssl-compliant-format">Create a primary object and read the public structure in an openssl compliant format</h2><pre><code class="language-bash">tpm2_createprimary -c primary.ctx
tpm2_readpublic -c primary.ctx -o output.dat -f pem
</code></pre><h2 id="serialize-an-existing-persistent-object-handle-to-disk-for-later-use">Serialize an existing persistent object handle to disk for later use</h2><p>This work-flow is primarily intended for existing persistent TPM objects. This work-flow does not verify that the name of the serialized object matches the expected, and thus the serialized handle could be pointing to an attacker controlled object if no verification is done. If you are creating an object from scratch, save the serialized handle when making the object persistent.<p>We assume that an object has already been persisted, for example via:<pre><code class="language-bash"># We assume that an object has already been persisted, for example
tpm2_createprimary -c primary.ctx

# context files have all the information for the TPM to verify the object
tpm2_evictcontrol -c primary.ctx
persistent-handle: 0x81000001
action: persisted
</code></pre><p>Next use the persistent handle to get a serialized handle:<pre><code class="language-bash"># The persistent handle output could be at an attacker controlled object,
# best practice is to use the option &quot;-o: for tpm2_evictcontrol to get a
# serialized handle instead.

tpm2_readpublic -c 0x81000001 -o output.dat -f pem -t primary.handle

# use this verified handle in an encrypted session with the tpm
tpm2_startauthsession --policy-session -S session.ctx -c primary.handle
</code></pre><p>For new objects, its best to use all serialized handles.</template><template id="rsadecrypt"><h1 id="name">NAME</h1><p><strong>tpm2_rsadecrypt</strong>(1) - Performs an RSA decryption operation using the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_rsadecrypt</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_rsadecrypt</strong>(1) - Performs RSA decryption on the contents of file using the indicated padding scheme according to IETF RFC 3447 (PKCS#1). Command line argument defaults to <em>stdin</em> if not specified.<p>The key referenced by key-context is <strong>required</strong> to be:<ol><li>An RSA key<li>Have the attribute <em>decrypt</em> <strong>SET</strong> in it&#39;s attributes.</ol><h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>Context object pointing to the the public portion of RSA key to use for decryption. Either a file or a handle number. See section &quot;Context Object Format&quot;.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Optional authorization value to use the key specified by <strong>-c</strong>.<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em>:<p>Optional output file path to record the decrypted data to. The default is to print the binary encrypted data to <em>STDOUT</em>.<li><p><strong>-s</strong>, <strong>--scheme</strong>=<em>FORMAT</em>:<p>Optional, set the padding scheme (defaults to rsaes).<ul><li>null - TPM_ALG_NULL uses the key&#39;s scheme if set.<li>rsaes - TPM_ALG_RSAES which is RSAES_PKCSV1.5.<li>oaep - TPM_ALG_OAEP which is RSAES_OAEP.</ul><li><p><strong>-l</strong>, <strong>--label</strong>=<em>FILE</em> OR <em>STRING</em>:<p>Optional, set the label data.The TPM requires the last byte of the label to be zero, this is handled internally to the tool. No other embedded 0 bytes can exist or the TPM will truncate your label.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>ARGUMENT</strong> the command line argument specifies the file containing data to be decrypted.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="create-an-rsa-key-and-load-it">Create an RSA key and load it</h2><pre><code class="language-bash">tpm2_createprimary -c primary.ctx
tpm2_create -C primary.ctx -Grsa2048 -u key.pub -r key.priv
tpm2_load -C primary.ctx -u key.pub -r key.priv -c key.ctx
</code></pre><h2 id="encrypt-using-rsa">Encrypt using RSA</h2><pre><code class="language-bash">echo &quot;my message&quot; &gt; msg.dat
tpm2_rsaencrypt -c key.ctx -o msg.enc msg.dat
</code></pre><h2 id="decrypt-using-rsa">Decrypt using RSA</h2><pre><code class="language-bash">tpm2_rsadecrypt -c key.ctx -o msg.ptext msg.enc
cat msg.ptext
my message
</code></pre></template><template id="rsaencrypt"><h1 id="name">NAME</h1><p><strong>tpm2_rsaencrypt</strong>(1) - Performs an RSA encryption operation using the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_rsaencrypt</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_rsaencrypt</strong>(1) - Performs RSA encryption on the contents of file data using the indicated padding scheme according to IETF RFC 3447 (PKCS#1). Input defaults to <em>STDIN</em> if not specified.<p>The key referenced by key-context is <strong>required</strong> to be:<ol><li>An RSA key<li>Have the attribute <em>encrypt</em> <strong>SET</strong> in it&#39;s attributes.</ol><h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>Context object pointing to the the public portion of RSA key to use for encryption.<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em>:<p>Optional output file path to record the encrypted data to. The default is to print the binary encrypted data to stdout.<li><p><strong>-s</strong>, <strong>--scheme</strong>=<em>FORMAT</em>:<p>Optional, set the padding scheme (defaults to rsaes).<ul><li>null - TPM_ALG_NULL uses the key&#39;s scheme if set.<li>rsaes - TPM_ALG_RSAES which is RSAES_PKCSV1.5.<li>oaep - TPM_ALG_OAEP which is RSAES_OAEP.</ul><li><p><strong>-l</strong>, <strong>--label</strong>=<em>FILE</em> or <em>STRING</em>:<p>Optional, set the label data. Can either be a string or file path. The TPM requires the last byte of the label to be zero, this is handled internally to the tool. No other embedded 0 bytes can exist or the TPM will truncate your label.<li><p><strong>ARGUMENT</strong> the command line argument specifies the path of the file with data to be encrypted.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="create-an-rsa-key-and-load-it">Create an RSA key and load it</h2><pre><code class="language-bash">tpm2_createprimary -c primary.ctx
tpm2_create -C primary.ctx -Grsa2048 -u key.pub -r key.priv
tpm2_load -C primary.ctx -u key.pub -r key.priv -c key.ctx
</code></pre><h2 id="encrypt-using-rsa">Encrypt using RSA</h2><pre><code class="language-bash">echo &quot;my message&quot; &gt; msg.dat
tpm2_rsaencrypt -c key.ctx -o msg.enc msg.dat
</code></pre><h2 id="decrypt-using-rsa">Decrypt using RSA</h2><pre><code class="language-bash">tpm2_rsadecrypt -c key.ctx -o msg.ptext msg.enc
cat msg.ptext
my message
</code></pre></template><template id="selftest"><h1 id="name">NAME</h1><p><strong>tpm2_selftest</strong>(1) - Run TPM&#39;s self-test internal routines<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_selftest</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_selftest</strong>(1) - Cause the TPM to execute self-test of its capabilities.<p>Self-test can be executed in two modes :<ul><li>Simple test - TPM will test functions that require testing<li>Full test - TPM will test all functions regardless of what has already been tested</ul><p>Once the TPM receives this request, the TPM will return TPM_RC_TESTING for any command that requires a test. If a test fails, the TPM will return TPM_RC_FAILURE for any command other than TPM2_GetTestResult() and TPM2_GetCapability() during this time. The TPM will remain in failure mode until the next TPM initialization.<h1 id="options">OPTIONS</h1><ul><li><strong>-f</strong>, <strong>--fulltest</strong> : Run self-test in full mode</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="perform-a-simple-tpm-self-test">Perform a simple TPM self-test</h2><pre><code class="language-bash">tpm2_selftest
</code></pre><h2 id="perform-a-complete-tpm-self-test">Perform a complete TPM self-test</h2><pre><code class="language-bash">tpm2_selftest -f
</code></pre></template><template id="send"><h1 id="name">NAME</h1><p><strong>tpm2_send</strong>(1) - Send a raw command buffer to the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_send</strong> [<em>OPTIONS</em>] [<em>STDIN</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_send</strong>(1) - Sends a TPM command to the TPM. The command is read from a file as a binary stream and transmitted to the TPM using the TCTI specified by the caller. The response received from the TPM is written to the output file.<p>Likely the caller will want to redirect this to a file or into a program to decode and display the response in a human readable form.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em>:<p>Output file to send response buffer to. Defaults to <em>STDOUT</em>.<li><p><strong>_STDIN</strong> the file containing the TPM2 command.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="send-and-receive-raw-commands-to-tpm">Send and receive raw commands to TPM</h2><p>Send the contents of <em>tpm2-command.bin</em> to a device and collect the response as <em>tpm2-response.bin</em>.<pre><code class="language-bash">tpm2_send &lt; tpm2-command.bin &gt; tpm2-response.bin

tpm2_send &lt; tpm2-command.bin -o tpm2-response.bin
</code></pre></template><template id="sessionconfig"><h1 id="name">NAME</h1><p><strong>tpm2_sessionconfig</strong>(1) - Configure session attributes and print session info from a session file.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_sessionconfig</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_sessionconfig</strong>(1) - Configure session attributes and print session info from a session file. The session file used in the tpm2-tools has useful info about the session in addition to the encrypted-session-blob created by the TPM. This meta-information is added by esys library and the tpm2_session lib.<p>The tool operates in one of two modes:<ol><li>Configure/ modify the session attributes.<li>Print the session information. This is the default behavior.</ol><h1 id="options">OPTIONS</h1><ul><li><p><strong>--enable-continuesession</strong>:<p>Enable continueSession in the session-attributes.<li><p><strong>--disable-continuesession</strong><p>Disable continuesession in the session-attributes.<li><p><strong>--enable-auditexclusive</strong><p>Enable auditexclusive in the session-attributes.<li><p><strong>--disable-auditexclusive</strong><p>Disable auditexclusive in the session-attributes.<li><p><strong>--enable-auditreset</strong><p>Enable auditreset in the session-attributes.<li><p><strong>--disable-auditreset</strong><p>Disable auditreset in the session-attributes.<li><p><strong>--enable-decrypt</strong><p>Enable decrypt in the session-attributes.<li><p><strong>--disable-decrypt</strong><p>Disable decrypt in the session-attributes.<li><p><strong>--enable-encrypt</strong><p>Enable encrypt in the session-attributes.<li><p><strong>--disable-encrypt</strong><p>Disable encrypt in the session-attributes.<li><p><strong>--enable-audit</strong><p>Enable audit in the session-attributes.<li><p><strong>--disable-audit</strong><p>Disable audit in the session-attributes.<li><p><strong>ARGUMENT</strong> the session context file.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="start-a-bounded--salted-session-disable-continuesession-and-display-session">Start a bounded &amp; salted session, disable continuesession and display session</h2><pre><code class="language-bash">
tpm2 createprimary -c prim.ctx
tpm2 startauthsession -S session.ctx --policy-session -c prim.ctx

### Session info before changing attributes
tpm2 sessionconfig session.ctx

### Session info after changing attributes
tpm2 sessionconfig --disable-continuesession
tpm2 sessionconfig session.ctx
</code></pre></template><template id="setclock"><h1 id="name">NAME</h1><p><strong>tpm2_setclock</strong>(1) - Sets the time on the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_setclock</strong> [<em>OPTIONS</em>] <strong>TIME</strong><h1 id="description">DESCRIPTION</h1><p><strong>tpm2_setclock</strong>(1) - Sets the clock on the TPM to a time in the <strong>future</strong>. The sole argument is the clock time as a number to set.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>The hierarchy to use for authorization, either platform or owner. Defaults to the owner hierarchy if not specified.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy specified by option <strong>-c</strong>.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="set-the-clock">Set the clock</h2><p>Set the clock using the owner password.<pre><code class="language-bash">tpm2_setclock -p ownerpw 13673142
</code></pre></template><template id="setcommandauditstatus"><h1 id="name">NAME</h1><p><strong>tpm2_setcommandauditstatus</strong>(1) - Add or remove TPM2 commands to the audited commands list.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_setcommandauditstatus</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_setcommandauditstatus</strong>(1) - Add or remove TPM2 commands to the audited commands list.<p>As an argument it takes the command as an integer or friendly string value. Friendly string to COMMAND CODE mapping can be found in section <em>COMMAND CODE MAPPINGS</em>.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specify either owner or platform hierarchy. Defaults to <strong>TPM_RH_OWNER</strong>, when no value has been specified. Supported options are:<ul><li><strong>o</strong> for <strong>TPM_RH_OWNER</strong><li><strong>p</strong> for <strong>TPM_RH_PLATFORM</strong></ul><li><p><strong>-P</strong>, <strong>--hierarchy-auth</strong>=<em>AUTH</em>: Specifies the authorization value for the hierarchy. Authorization values should follow the &quot;authorization formatting standards&quot;, see section &quot;Authorization Formatting&quot;.<li><p><strong>-c</strong>, <strong>--clear-list</strong>: Specifies that the TPM command specified has to be taken off the audit list. When not specified, the default behaviour is to add the TPM command to the audit list.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>Sets up the hashing algorithm for the audit digest. When not specified, the default audit digest algorithm is set to SHA256.<li><p><strong>ARGUMENT</strong> the command line argument specifies TPM2 command code.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<p><a href="./common/hash.html">hash algorithm options</a> collection of options to specify hash algorithm.<h1 id="command-code-mappings">COMMAND CODE MAPPINGS</h1><p>The friendly strings below can be used en lieu of the raw integer values.<p>-TPM2_CC_AC_GetCapability: 0x194 -TPM2_CC_AC_Send: 0x195 -TPM2_CC_ActivateCredential: 0x147 -TPM2_CC_Certify: 0x148 -TPM2_CC_CertifyCreation: 0x14a -TPM2_CC_ChangeEPS: 0x124 -TPM2_CC_ChangePPS: 0x125 -TPM2_CC_Clear: 0x126 -TPM2_CC_ClearControl: 0x127 -TPM2_CC_ClockRateAdjust: 0x130 -TPM2_CC_ClockSet: 0x128 -TPM2_CC_Commit: 0x18b -TPM2_CC_ContextLoad: 0x161 -TPM2_CC_ContextSave: 0x162 -TPM2_CC_Create: 0x153 -TPM2_CC_CreateLoaded: 0x191 -TPM2_CC_CreatePrimary: 0x131 -TPM2_CC_DictionaryAttackLockReset: 0x139 -TPM2_CC_DictionaryAttackParameters: 0x13a -TPM2_CC_Duplicate: 0x14b -TPM2_CC_ECC_Parameters: 0x178 -TPM2_CC_ECDH_KeyGen: 0x163 -TPM2_CC_ECDH_ZGen: 0x154 -TPM2_CC_EC_Ephemeral: 0x18e -TPM2_CC_EncryptDecrypt: 0x164 -TPM2_CC_EncryptDecrypt2: 0x193 -TPM2_CC_EventSequenceComplete: 0x185 -TPM2_CC_EvictControl: 0x120 -TPM2_CC_FieldUpgradeData: 0x141 -TPM2_CC_FieldUpgradeStart: 0x12f -TPM2_CC_FirmwareRead: 0x179 -TPM2_CC_FlushContext: 0x165 -TPM2_CC_GetCapability: 0x17a -TPM2_CC_GetCommandAuditDigest: 0x133 -TPM2_CC_GetRandom: 0x17b -TPM2_CC_GetSessionAuditDigest: 0x14d -TPM2_CC_GetTestResult: 0x17c -TPM2_CC_GetTime: 0x14c -TPM2_CC_Hash: 0x17d -TPM2_CC_HashSequenceStart: 0x186 -TPM2_CC_HierarchyChangeAuth: 0x129 -TPM2_CC_HierarchyControl: 0x121 -TPM2_CC_HMAC: 0x155 -TPM2_CC_HMAC_Start: 0x15b -TPM2_CC_Import: 0x156 -TPM2_CC_IncrementalSelfTest: 0x142 -TPM2_CC_Load: 0x157 -TPM2_CC_LoadExternal: 0x167 -TPM2_CC_MakeCredential: 0x168 -TPM2_CC_NV_Certify: 0x184 -TPM2_CC_NV_ChangeAuth: 0x13b -TPM2_CC_NV_DefineSpace: 0x12a -TPM2_CC_NV_Extend: 0x136 -TPM2_CC_NV_GlobalWriteLock: 0x132 -TPM2_CC_NV_Increment: 0x134 -TPM2_CC_NV_Read: 0x14e -TPM2_CC_NV_ReadLock: 0x14f -TPM2_CC_NV_ReadPublic: 0x169 -TPM2_CC_NV_SetBits: 0x135 -TPM2_CC_NV_UndefineSpace: 0x122 -TPM2_CC_NV_UndefineSpaceSpecial: 0x11f -TPM2_CC_NV_Write: 0x137 -TPM2_CC_NV_WriteLock: 0x138 -TPM2_CC_ObjectChangeAuth: 0x150 -TPM2_CC_PCR_Allocate: 0x12b -TPM2_CC_PCR_Event: 0x13c -TPM2_CC_PCR_Extend: 0x182 -TPM2_CC_PCR_Read: 0x17e -TPM2_CC_PCR_Reset: 0x13d -TPM2_CC_PCR_SetAuthPolicy: 0x12c -TPM2_CC_PCR_SetAuthValue: 0x183 -TPM2_CC_Policy_AC_SendSelect: 0x196 -TPM2_CC_PolicyAuthorize: 0x16a -TPM2_CC_PolicyAuthorizeNV: 0x192 -TPM2_CC_PolicyAuthValue: 0x16b -TPM2_CC_PolicyCommandCode: 0x16c -TPM2_CC_PolicyCounterTimer: 0x16d -TPM2_CC_PolicyCpHash: 0x16e -TPM2_CC_PolicyDuplicationSelect: 0x188 -TPM2_CC_PolicyGetDigest: 0x189 -TPM2_CC_PolicyLocality: 0x16f -TPM2_CC_PolicyNameHash: 0x170 -TPM2_CC_PolicyNV: 0x149 -TPM2_CC_PolicyNvWritten: 0x18f -TPM2_CC_PolicyOR: 0x171 -TPM2_CC_PolicyPassword: 0x18c -TPM2_CC_PolicyPCR: 0x17f -TPM2_CC_PolicyPhysicalPresence: 0x187 -TPM2_CC_PolicyRestart: 0x180 -TPM2_CC_PolicySecret: 0x151 -TPM2_CC_PolicySigned: 0x160 -TPM2_CC_PolicyTemplate: 0x190 -TPM2_CC_PolicyTicket: 0x172 -TPM2_CC_PP_Commands: 0x12d -TPM2_CC_Quote: 0x158 -TPM2_CC_ReadClock: 0x181 -TPM2_CC_ReadPublic: 0x173 -TPM2_CC_Rewrap: 0x152 -TPM2_CC_RSA_Decrypt: 0x159 -TPM2_CC_RSA_Encrypt: 0x174 -TPM2_CC_SelfTest: 0x143 -TPM2_CC_SequenceComplete: 0x13e -TPM2_CC_SequenceUpdate: 0x15c -TPM2_CC_SetAlgorithmSet: 0x13f -TPM2_CC_SetCommandCodeAuditStatus: 0x140 -TPM2_CC_SetPrimaryPolicy: 0x12e -TPM2_CC_Shutdown: 0x145 -TPM2_CC_Sign: 0x15d -TPM2_CC_StartAuthSession: 0x176 -TPM2_CC_Startup: 0x144 -TPM2_CC_StirRandom: 0x146 -TPM2_CC_TestParms: 0x18a -TPM2_CC_Unseal: 0x15e -TPM2_CC_Vendor_TCG_Test: 0x20000000 -TPM2_CC_VerifySignature: 0x177 -TPM2_CC_ZGen_2Phase: 0x18d<h1 id="examples">EXAMPLES</h1><p>Add TPM2_CC_Unseal to the list of audited commands.<pre><code class="language-bash">tpm2_setcommandauditstatus TPM2_CC_Unseal
</code></pre><p><a href="common/policy-limitations.md">limitations</a></template><template id="setprimarypolicy"><h1 id="name">NAME</h1><p><strong>tpm2_setprimarypolicy</strong>(1) - Sets the authorization policy for the lockout (lockoutPolicy), the platform hierarchy (platformPolicy), the storage hierarchy (ownerPolicy), and the endorsement hierarchy (endorsementPolicy).<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_setprimarypolicy</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_setprimarypolicy</strong>(1) - Sets the authorization policy for the lockout (lockoutPolicy), the platform hierarchy (platformPolicy), the storage hierarchy (ownerPolicy), and the endorsement hierarchy (endorsementPolicy).<h1 id="options">OPTIONS</h1><p>These options control creating the policy authorization session:<ul><li><p><strong>-C</strong>, <strong>--hierarchy</strong>=<em>OBJECT</em>:<p>Specifies the hierarchy whose authorization policy is to be setup. It can be specified as o|p|e|l<li><p><strong>-P</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Specifies the authorization value for the hierarchy.<li><p><strong>-L</strong>, <strong>--policy</strong>=<em>FILE</em>:<p>The file path of the authorization policy data.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm used in computation of the policy digest.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="set-a-blank-authorization-policy-for-endorsement-hierarchy">Set a blank authorization policy for endorsement hierarchy</h2><pre><code class="language-bash">tpm2_setprimarypolicy -C e
</code></pre></template><template id="shutdown"><h1 id="name">NAME</h1><p><strong>tpm2_shutdown</strong>(1) - Send a shutdown command to the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_shutdown</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_shutdown</strong>(1) - Send a <strong>TPM2_Shutdown</strong> command with either <strong>TPM_SU_CLEAR</strong> or <strong>TPM_SU_STATE</strong>.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--clear</strong>:<p>Shutdown type sent will be <strong>TPM_SU_CLEAR</strong> instead of <strong>TPM2_SU_STATE</strong>.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="send-a-tpm-shutdown-command-with-flags-tpm2_su_state">Send a TPM Shutdown Command with flags TPM2_SU_STATE</h2><pre><code class="language-bash">tpm2_shutdown
</code></pre><h2 id="send-a-tpm-shutdown-command-with-flags-tpm2_su_clear">Send a TPM Shutdown Command with flags TPM2_SU_CLEAR</h2><pre><code class="language-bash">tpm2_shutdown -c
</code></pre><h1 id="notes">NOTES</h1><p>Typically a Resource Manager (like <a href="https://github.com/tpm2-software/tpm2-abrmd">tpm2-abrmd</a>) or low-level/boot software will have already sent this command.</template><template id="sign"><h1 id="name">NAME</h1><p><strong>tpm2_sign</strong>(1) - Sign a hash or message using the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_sign</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_sign</strong>(1) - Generates signature of specified message or message-digest using the specified symmetric or asymmetric signing key.<p>When signing a message, <strong>tpm2_sign</strong> utility first calculates the digest of the message similar to the <strong>tpm2_hash</strong> command. It also generates a validation ticket under TPM2_RH_NULL or TPM2_RH_OWNER hierarchies respectively for unrestricted or the restricted signing keys.<p>While signing messages is a provision in this tool it is recommended to use the <strong>tpm2_hash</strong> tool first and pass the digest and validation ticket.<p>NOTE: If the signing key is a restricted signing key, then validation and digest must be provided via the <strong>-t</strong> input. The ticket indicates that the TPM performed the hash of the message.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>Context object pointing to the the key used for signing. Either a file or a handle number. See section &quot;Context Object Format&quot;.<li><p><strong>-p</strong>, <strong>--auth</strong><em>AUTH</em>:<p>Optional authorization value to use the key specified by <strong>-c</strong>. Authorization values should follow the &quot;authorization formatting standards&quot;, see section &quot;Authorization Formatting&quot;.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm used to digest the message. Algorithms should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;. Also, see section &quot;Supported Hash Algorithms&quot; for a list of supported hash algorithms.<li><p><strong>-s</strong>, <strong>--scheme</strong>=<em>ALGORITHM</em>:<p>The signing scheme used to sign the message. Optional.<p>Signing schemes should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;.<p>If specified, the signature scheme must match the key type. If left unspecified, a default signature scheme for the key type will be used.<li><p><strong>-d</strong>, <strong>--digest</strong>:<p>Indicate that <em>FILE</em> is a file containing the digest of the message. When this option and <strong>-t</strong> is specified, a warning is generated and the <strong>validation ticket (-t) is ignored</strong>. You cannot use this option to sign a digest against a restricted signing key.<li><p><strong>-t</strong>, <strong>--ticket</strong>=<em>FILE</em>:<p>The ticket file, containing the validation structure, optional.<li><p><strong>-o</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>The signature file, records the signature structure.<li><p><strong>-f</strong>, <strong>--format</strong>=<em>FORMAT</em>:<p>Format selection for the signature output file. See section &quot;Signature Format Specifiers&quot;.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>--commit-index</strong>=<em>NATURALNUMBER</em><p>The commit counter value to determine the key index to use in an ECDAA signing scheme. The default counter value is 0.<li><p><strong>ARGUMENT</strong> the command line argument specifies the file data for sign.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<p><a href="./common/signature.html">signature format specifiers</a><h1 id="examples">EXAMPLES</h1><h2 id="sign-and-verify-with-the-tpm-using-the-endorsement-hierarchy">Sign and verify with the TPM using the <em>endorsement</em> hierarchy</h2><pre><code class="language-bash">tpm2_createprimary -C e -c primary.ctx

tpm2_create -G rsa -u rsa.pub -r rsa.priv -C primary.ctx

tpm2_load -C primary.ctx -u rsa.pub -r rsa.priv -c rsa.ctx

echo &quot;my message&quot; &gt; message.dat

tpm2_sign -c rsa.ctx -g sha256 -o sig.rssa message.dat

tpm2_verifysignature -c rsa.ctx -g sha256 -s sig.rssa -m message.dat
</code></pre><h2 id="sign-with-the-tpm-and-verify-with-ossl">Sign with the TPM and verify with OSSL</h2><pre><code class="language-bash">openssl ecparam -name prime256v1 -genkey -noout -out private.ecc.pem

openssl ec -in private.ecc.pem -out public.ecc.pem -pubout

# Generate a hash to sign
echo &quot;data to sign&quot; &gt; data.in.raw

sha256sum data.in.raw | awk &#39;{ print &quot;000000 &quot; $1 }&#39; | \
xxd -r -c 32 &gt; data.in.digest

# Load the private key for signing
tpm2_loadexternal -Q -G ecc -r private.ecc.pem -c key.ctx

# Sign in the TPM and verify with OSSL
tpm2_sign -Q -c key.ctx -g sha256 -d -f plain -o data.out.signed data.in.digest

openssl dgst -verify public.ecc.pem -keyform pem -sha256 \
-signature data.out.signed data.in.raw
</code></pre></template><template id="startauthsession"><h1 id="name">NAME</h1><p><strong>tpm2_startauthsession</strong>(1) - Start a session with the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_startauthsession</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_startauthsession</strong>(1) - Starts a session with the TPM. The default is to start a <em>trial</em> session unless the <strong>-a</strong> option is specified. Saves the policy session data to a file. This file can then be used in subsequent tools that can use a policy file for authorization or policy events.<p>This will not work with resource managers (RMs) outside of [tpm2-abrmd](https:// github.com/tpm2-software/tpm2-abrmd), as most RMs will flush session handles when a client disconnects from the IPC channel.<p>This will work with direct TPM access, but note that internally this calls a <em>ContextSave</em> and a <em>ContextLoad</em> on the session handle, thus the session <strong>cannot</strong> be saved/loaded again.<h1 id="options">OPTIONS</h1><ul><li><p><strong>--policy-session</strong>:<p>Start a policy session of type <strong>TPM_SE_POLICY</strong>. Default without this option is <strong>TPM_SE_TRIAL</strong>.<p><strong>NOTE</strong>: A <em>trial</em> session is used when building a policy and a <em>policy</em> session is used when authenticating with a policy.<li><p><strong>--audit-session</strong>:<p>Start an HMAC session to be used as an audit session. Default without this option is <strong>TPM2_SE_TRIAL</strong>.<li><p><strong>--hmac-session</strong>:<p>Start an HMAC session of type <strong>TPM_SE_HMAC</strong>. Default without this option is <strong>TPM2_SE_TRIAL</strong>.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm used in computation of the policy digest.<li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>Set the tpmkey and bind objects to be the same. Session parameter encryption is turned on. Session parameter decryption is turned on. Parameter encryption/decryption symmetric-key set to AES-CFB.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The name of the policy session file, required.<li><p><strong>--bind-context</strong>=<em>FILE</em>:<p>Set the bind object. Session parameter encryption is off. Use <strong>tpm2_sessionconfig</strong> to turn on. Session parameter decryption is off. Use <strong>tpm2_sessionconfig</strong> to turn on. Parameter encryption/decryption symmetric-key set to AES-CFB.<li><p><strong>--bind-auth</strong>=<em>AUTH</em>:<p>Set the authorization value for the bind object.<li><p><strong>--tpmkey-context</strong>=<em>FILE</em>:<p>Set the tpmkey object. Session parameter encryption is off. Use <strong>tpm2_sessionconfig</strong> to turn on. Session parameter decryption is off. Use <strong>tpm2_sessionconfig</strong> to turn on. Parameter encryption/decryption symmetric-key set to AES-CFB.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="start-a-trial-session-and-save-the-session-data-to-a-file">Start a <em>trial</em> session and save the session data to a file</h2><pre><code class="language-bash">tpm2_startauthsession -S mysession.ctx
</code></pre><h2 id="start-a-policy-session-and-save-the-session-data-to-a-file">Start a <em>policy</em> session and save the session data to a file</h2><pre><code class="language-bash">tpm2_startauthsession --policy-session -S mysession.ctx
</code></pre><h2 id="start-an-encrypted-and-bound-policy-session-and-save-the-session-data-to-a-file">Start an encrypted and bound <em>policy</em> session and save the session data to a file</h2><pre><code class="language-bash">tpm2_createprimary -c primary.ctx
tpm2_startauthsession --policy-session -c primary.ctx -S mysession.ctx
</code></pre></template><template id="startup"><h1 id="name">NAME</h1><p><strong>tpm2_startup</strong>(1) - Send a startup command to the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_startup</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_startup</strong>(1) - Send a <strong>TPM2_Startup</strong> command with either <strong>TPM_SU_CLEAR</strong> or <strong>TPM_SU_STATE</strong>.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--clear</strong>:<p>Startup type sent will be <strong>TPM_SU_CLEAR</strong> instead of <strong>TPM2_SU_STATE</strong>.</ul><h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><h2 id="send-a-tpm-startup-command-with-flags-tpm2_su_state">Send a TPM Startup Command with flags TPM2_SU_STATE</h2><pre><code class="language-bash">tpm2_startup
</code></pre><h2 id="send-a-tpm-startup-command-with-flags-tpm2_su_clear">Send a TPM Startup Command with flags TPM2_SU_CLEAR</h2><pre><code class="language-bash">tpm2_startup -c
</code></pre><h1 id="notes">NOTES</h1><p>Typically a Resource Manager (like <a href="https://github.com/tpm2-software/tpm2-abrmd">tpm2-abrmd</a>) or low-level/boot software will have already sent this command.</template><template id="stirrandom"><h1 id="name">NAME</h1><p><strong>tpm2_stirrandom</strong>(1) - Add &quot;additional information&quot; into TPM RNG state.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_stirrandom</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_stirrandom</strong>(1) - Inject &quot;additional information&quot; as bytes into TPM entropy Protected Capability pool.<p>&quot;Additional information&quot; can be extracted from file specified as argument or being read from <em>STDIN</em> if argument is not specified.<p>Up to 128 bytes can be injected at once through standard input to <strong>tpm2_stirrandom</strong>(1).<p>If input file is larger than 128 bytes, <strong>tpm2_stirrandom</strong>(1) will fail.<p>Adding data through <strong>tpm2_stirrandom</strong>(1) will trigger a reseeding of TPM DRBG Protected Capability. It is used when performing any sensitive action on a shielded location such as loading a persistent key or acting on a Protected Capability like updating TPM firmware.<h1 id="options">OPTIONS</h1><p>This command has no option<h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.)<h1 id="examples">EXAMPLES</h1><h2 id="inject-from-stdin-using-echo">Inject from stdin using echo</h2><pre><code class="language-bash">echo -n &quot;myrandomdata&quot; | tpm2_stirrandom
</code></pre><h2 id="inject-64-bytes-from-stdin-using-a-file">Inject 64 bytes from stdin using a file</h2><pre><code class="language-bash">dd if=/dev/urandom bs=1 count=64 &gt; myrandom.bin

tpm2_stirrandom &lt; ./myrandom.bin
</code></pre><h2 id="inject-bytes-from-a-file-and-reading-up-to-128-bytes">Inject bytes from a file and reading up to 128 bytes</h2><pre><code class="language-bash">dd if=/dev/urandom of=./myrandom.bin bs=1 count=42

tpm2_stirrandom ./myrandom.bin
</code></pre><h1 id="notes">NOTES</h1><p>Please be aware that even if the &quot;additional information&quot; added by <strong>tpm2_stirrandom</strong>(1) can be entropy gathered from other DRBG sources, the TPM has no way of determining if the value has any entropy or not. As a consequence, it will just be considered as &quot;additional input&quot;.<p>The &quot;additional input&quot; is as defined in <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-90.pdf">NIST SP800-90A</a></template><template id="testparms"><h1 id="name">NAME</h1><p><strong>tpm2_testparms</strong>(1) - Verify that specified algorithm suite is supported by TPM<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_testparms</strong> [<em>OPTIONS</em>] [<em>ARGUMENT</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_testparms</strong>(1) - Checks that the suite specified by <em>ALG_SPEC</em> is available for usage per <em>ALGORITHM</em>.<p>Algorithms should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;.<p>Also, see section &quot;Supported Signing Schemes&quot; for a list of supported hash algorithms.<h1 id="options">OPTIONS</h1><p>This tool accepts no tool specific options.<h2 id="references">References</h2><p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/signature.html">signature format specifiers</a><h1 id="examples">EXAMPLES</h1><h2 id="check-whether-if-rsa-is-supported">Check whether if &quot;rsa&quot; is supported</h2><pre><code class="language-bash">tpm2_testparms rsa
</code></pre><h2 id="check-that-ecdsa-using-p-256-with-aes-128-ctr-mode-is-available">Check that ECDSA using P-256 with AES-128 CTR mode is available</h2><pre><code class="language-bash">tpm2_testparms ecc256:ecdsa:aes128ctr
</code></pre></template><template id="unseal"><h1 id="name">NAME</h1><p><strong>tpm2_unseal</strong>(1) - Returns a data blob in a loaded TPM object. The data blob is returned in clear.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_unseal</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_unseal</strong>(1) - Returns a data blob in a loaded TPM object. The data blob is returned in clear. The data is sealed at the time of the object creation using the <strong>tpm2_create</strong> tool. Such an object intended for sealing data has to be of the type <em>TPM_ALG_KEYEDHASH</em>.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--object-context</strong>=<em>OBJECT</em>:<p>Object context for the loaded object.<li><p><strong>-p</strong>, <strong>--auth</strong>=<em>AUTH</em>:<p>Optional auth value to use for the key specified by <strong>-c</strong>.<li><p><strong>-o</strong>, <strong>--output</strong>=<em>FILE</em>:<p>Output file name containing the unsealed data. Defaults to <em>STDOUT</em> if not specified.<li><p><strong>--cphash</strong>=<em>FILE</em><p>File path to record the hash of the command parameters. This is commonly termed as cpHash. NOTE: When this option is selected, The tool will not actually execute the command, it simply returns a cpHash.<li><p><strong>-S</strong>, <strong>--session</strong>=<em>FILE</em>:<p>The session created using <strong>tpm2_startauthsession</strong>. Multiple of these can be specified. For example, you can have one session for auditing and another for encryption/decryption of the parameters.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/authorizations.html">authorization formatting</a> details the methods for specifying <em>AUTH</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_createprimary -c primary.ctx -Q

tpm2_pcrread -Q -o pcr.bin sha256:0,1,2,3

tpm2_createpolicy -Q --policy-pcr -l sha256:0,1,2,3 -f pcr.bin -L pcr.policy

echo &#39;secret&#39; | tpm2_create -C primary.ctx -L pcr.policy -i-\
-u seal.pub -r seal.priv -c seal.ctx -Q

tpm2_unseal -c seal.ctx -p pcr:sha256:0,1,2,3
</code></pre></template><template id="verifysignature"><h1 id="name">NAME</h1><p><strong>tpm2_verifysignature</strong>(1) - Validates a signature using the TPM.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_verifysignature</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_verifysignature</strong>(1) - Uses loaded keys to validate a signature on a message with the message digest passed to the TPM. If the signature check succeeds, then the TPM will produce a <strong>TPMT_TK_VERIFIED</strong>. Otherwise, the TPM shall return <strong>TPM_RC_SIGNATURE</strong>. If object references an asymmetric key, only the public portion of the key needs to be loaded. If object references a symmetric key, both the public and private portions need to be loaded.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>OBJECT</em>:<p>Context object for the key context used for the operation. Either a file or a handle number. See section &quot;Context Object Format&quot;.<li><p><strong>-g</strong>, <strong>--hash-algorithm</strong>=<em>ALGORITHM</em>:<p>The hash algorithm used to digest the message. Algorithms should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;. Also, see section &quot;Supported Hash Algorithms&quot; for a list of supported hash algorithms.<li><p><strong>-m</strong>, <strong>--message</strong>=<em>FILE</em>:<p>The message file, containing the content to be digested.<li><p><strong>-d</strong>, <strong>--digest</strong>=<em>FILE</em>:<p>The input hash file, containing the hash of the message. If this option is selected, then the message (<strong>-m</strong>) and algorithm (<strong>-g</strong>) options do not need to be specified.<li><p><strong>-s</strong>, <strong>--signature</strong>=<em>FILE</em>:<p>The input signature file of the signature to be validated.<li><p><strong>-f</strong>, <strong>--scheme</strong>=<em>SCHEME</em>:<p>The signing scheme that was used to sign the message. This option should only be specified if the signature comes in from a non <em>tss</em> standard, like openssl. See &quot;Signature format specifiers&quot; for more details. The <em>tss</em> format contains the signature metadata required to understand it&#39;s signature scheme.<p>Signing schemes should follow the &quot;formatting standards&quot;, see section &quot;Algorithm Specifiers&quot;.<li><p><strong>--format</strong>=<em>SCHEME</em>:<p>Deprecated. Same as <strong>--scheme</strong>.<li><p><strong>-t</strong>, <strong>--ticket</strong>=<em>FILE</em>:<p>The ticket file to record the validation structure.</ul><h2 id="references">References</h2><p><a href="./common/ctxobj.html">context object format</a> details the methods for specifying <em>OBJECT</em>.<p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<p><a href="./common/signature.html">signature format specifiers</a><h1 id="examples">EXAMPLES</h1><h2 id="sign-and-verify-with-the-tpm-using-the-endorsement-hierarchy">Sign and verify with the TPM using the <em>endorsement</em> hierarchy</h2><pre><code class="language-bash">tpm2_createprimary -C e -c primary.ctx

tpm2_create -G rsa -u rsa.pub -r rsa.priv -C primary.ctx

tpm2_load -C primary.ctx -u rsa.pub -r rsa.priv -c rsa.ctx

echo &quot;my message &gt; message.dat

tpm2_sign -c rsa.ctx -g sha256 -m message.dat -s sig.rssa

tpm2_verifysignature -c rsa.ctx -g sha256 -m message.dat -s sig.rssa
</code></pre><h2 id="sign-with-openssl-and-verify-with-the-tpm">Sign with openssl and verify with the TPM</h2><pre><code class="language-bash"># Generate an ECC key
openssl ecparam -name prime256v1 -genkey -noout -out private.ecc.pem

openssl ec -in private.ecc.pem -out public.ecc.pem -pubout

# Generate a hash to sign (OSSL needs the hash of the message)
echo &quot;data to sign&quot; &gt; data.in.raw

sha256sum data.in.raw | awk &#39;{ print &quot;000000 &quot; $1 }&#39; | \
xxd -r -c 32 &gt; data.in.digest

# Load the private key for signing
tpm2_loadexternal -Q -G ecc -r private.ecc.pem -c key.ctx

# Sign in the TPM and verify with OSSL
tpm2_sign -Q -c key.ctx -g sha256 -d data.in.digest -f plain -s data.out.signed

openssl dgst -verify public.ecc.pem -keyform pem -sha256 \
-signature data.out.signed data.in.raw

# Sign with openssl and verify with TPM
openssl dgst -sha256 -sign private.ecc.pem -out data.out.signed data.in.raw

tpm2_verifysignature -Q -c key.ctx -g sha256 -m data.in.raw -f ecdsa \
-s data.out.signed
</code></pre></template><template id="zgen2phase"><h1 id="name">NAME</h1><p><strong>tpm2_zgen2phase</strong>(1) - Command to enable the TPM to combine data from the other party with the ephemeral key generated in the first phase of two-phase key exchange protocols.<h1 id="synopsis">SYNOPSIS</h1><p><strong>tpm2_zgen2phase</strong> [<em>OPTIONS</em>]<h1 id="description">DESCRIPTION</h1><p><strong>tpm2_zgen2phase</strong>(1) - Command to enable the TPM to combine data from the other party with the ephemeral key generated in the first phase of two-phase key exchange protocols.<h1 id="options">OPTIONS</h1><ul><li><p><strong>-c</strong>, <strong>--key-context</strong>=<em>FILE</em>:<p>Context object pointing to ECC key. Either a file or a handle number. See section &quot;Context Object Format&quot;.<li><p><strong>-p</strong>, <strong>--key-auth</strong>=<em>AUTH</em>:<p>The authorization value for the ECC key object.<li><p><strong>-s</strong>, <strong>--scheme</strong>=<em>ALGORITHM</em>:<p>The key exchange scheme. Optional. Valid options are ecdh or sm2.<li><p><strong>-t</strong>, <strong>--counter</strong>=<em>NATURALNUMBER</em>:<p>The commit count to determine the key index to use.<li><p><strong>--static-public</strong>=<em>FILE</em>:<p>The static public key input of the other party.<li><p><strong>--ephemeral-public</strong>=<em>FILE</em>:<p>The ephemeral public key input of the other party.<li><p><strong>--output-Z1</strong>=<em>FILE</em><p>Specify file path to save the calculated ecdh secret Z1 point.<li><p><strong>--output-Z2</strong>=<em>FILE</em><p>Specify file path to save the calculated ecdh secret Z2 point.</ul><h2 id="references">References</h2><p><a href="./common/alg.html">algorithm specifiers</a> details the options for specifying cryptographic algorithms <em>ALGORITHM</em>.<p><a href="./common/options.html">common options</a> collection of common options that provide information many users may expect.<p><a href="./common/tcti.html">common tcti options</a> collection of options used to configure the various known TCTI modules.<h1 id="examples">EXAMPLES</h1><pre><code class="language-bash">tpm2_createprimary -C o -c prim.ctx -Q

tpm2_create -C prim.ctx -c key.ctx -u key.pub -r key.priv -G ecc256:ecdh -Q

tpm2_ecephemeral -u ecc.q -t ecc.ctr ecc256

tpm2_ecdhkeygen -u ecdh.pub -o ecdh.priv -c key.ctx

tpm2_zgen2phase -c key.ctx --static-public ecdh.pub --ephemeral-public ecc.q \
-t 0 --output-Z1 z1.bin --output-Z2 z2.bin
</code></pre></template><div class="theme-switch"id="themeswitch"></div><script>var cmds=["activatecredential","certify","certifyX509certutil","certifycreation","changeauth","changeeps","changepps","checkquote","clear","clearcontrol","clockrateadjust","commit","create","createak","createek","createpolicy","createprimary","dictionarylockout","duplicate","ecdhkeygen","ecdhzgen","ecephemeral","encryptdecrypt","eventlog","evictcontrol","flushcontext","getcap","getcommandauditdigest","geteccparameters","getekcertificate","getrandom","getsessionauditdigest","gettestresult","gettime","hash","hierarchycontrol","hmac","import","incrementalselftest","load","loadexternal","makecredential","nvcertify","nvdefine","nvextend","nvincrement","nvread","nvreadlock","nvreadpublic","nvsetbits","nvundefine","nvwrite","nvwritelock","pcrallocate","pcrevent","pcrextend","pcrread","pcrreset","policyauthorize","policyauthorizenv","policyauthvalue","policycommandcode","policycountertimer","policycphash","policyduplicationselect","policylocality","policynamehash","policynv","policynvwritten","policyor","policypassword","policypcr","policyrestart","policysecret","policysigned","policytemplate","policyticket","print","quote","rc","readclock","readpublic","rsadecrypt","rsaencrypt","selftest","send","sessionconfig","setclock","setcommandauditstatus","setprimarypolicy","shutdown","sign","startauthsession","startup","stirrandom","testparms","unseal","verifysignature","zgen2phase"]</script><script src="./dist/index.js"></script>